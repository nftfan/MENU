<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Personal Delivery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="https://raw.githubusercontent.com/nftfan/delivery/main/Untitled%20design%20(22).png" type="image/png">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Personal Delivery">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/nftfan/delivery/main/Untitled%20design%20(23)929292.png">
  <link rel="apple-touch-startup-image" href="https://raw.githubusercontent.com/nftfan/delivery/main/Untitled%20design%20(22).png">
  <link rel="manifest" href="https://raw.githubusercontent.com/nftfan/delivery/main/d2.json">
  <meta charset="UTF-8">
  <title>MATIC Bank - Digital Wallet Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
  <style>
    html, body {
      background: #fff;
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      padding: 0;
      font-size: 10px;
      color: #222;
      min-height: 100vh;
    }
    .wrapper {
      max-width: 480px;
      margin: 0 auto;
      padding: 10px 0 30px 0;
    }
    /* Total sum card */
    .total-card {
      background: #f8f7ff;
      border-radius: 10px;
      border: 1px solid #ececec;
      margin: 10px 10px 22px 10px;
      padding: 18px 14px 15px 14px;
      text-align: left;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: none;
    }
    .total-label {
      font-size: 10px;
      font-weight: bold;
      color: #888;
      margin-bottom: 7px;
      letter-spacing: 0.4px;
    }
    .total-sum {
      font-size: 18px;
      font-weight: bold;
      color: #7a3cff;
      letter-spacing: 0.3px;
    }
    /* Section headers */
    .section-label {
      font-weight: bold;
      margin: 18px 0 8px 16px;
      letter-spacing: 0.1px;
      font-size: 10px;
    }
    /* Account card */
    .account-card {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      border: 1px solid #ececec;
      border-radius: 9px;
      background: #fff;
      margin: 0 10px 12px 10px;
      padding: 14px 14px 10px 14px;
      box-shadow: none;
      transition: box-shadow 0.2s;
    }
    .account-info {
      flex: 1;
      min-width: 0;
    }
    .account-title {
      font-weight: bold;
      font-size: 10px;
      letter-spacing: 0.05px;
      margin-bottom: 2px;
      color: #222;
      white-space: pre-line;
    }
    .account-iban,
    .account-owner {
      font-size: 10px;
      color: #999;
      margin-bottom: 0;
      line-height: 1.5;
      letter-spacing: 0.05px;
    }
    .account-owner {
      margin-top: 1px;
    }
    .account-balance {
      font-size: 12px;
      font-weight: bold;
      color: #7a3cff;
      align-self: flex-start;
      margin-left: 10px;
      letter-spacing: 0.15px;
      white-space: nowrap;
    }
    .account-balance.positive {
      color: #7a3cff;
    }
    .account-balance.negative {
      color: #E53E3E;
    }
    .loading-spinner {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 1px solid #bbb;
      border-radius: 50%;
      border-top-color: #7a3cff;
      animation: spin 0.8s linear infinite;
      margin-left: 3px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .error-message {
      color: #E53E3E;
      font-size: 10px;
      margin-top: 4px;
    }
    /* Mobile responsiveness */
    @media (max-width: 575px) {
      .wrapper {
        max-width: 100vw;
        padding: 2vw 0 12vw 0;
      }
      .total-card, .account-card {
        margin-left: 2vw;
        margin-right: 2vw;
      }
      .section-label {
        margin-left: 4vw;
      }
    }
    /* Make touch targets a little bigger */
    .account-card {
      min-height: 48px;
    }
    /* Subtle tap effect */
    .account-card:active {
      background: #f1ecfc;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="total-card">
      <div class="total-label">Total balance</div>
      <div class="total-sum" id="total-sum">
        <span class="loading-spinner"></span>
      </div>
    </div>

    <div class="section-label">Payment accounts</div>
    <div class="account-card" id="account-1">
      <div class="account-info">
        <div class="account-title">NFTFAN SALE</div>
        <div class="account-iban">0xaf2d132c8773bca3821c24ecf64e844e202a12e8</div>
        <div class="account-owner">Trading</div>
      </div>
      <div class="account-balance positive" id="balance-1"><span class="loading-spinner"></span></div>
    </div>

    <div class="account-card" id="account-2">
      <div class="account-info">
        <div class="account-title">POLDOG SALE</div>
        <div class="account-iban">0xB1A37c277986E13Aa6c4f0763c2F06C4E9527D54</div>
        <div class="account-owner">Investment</div>
      </div>
      <div class="account-balance positive" id="balance-2"><span class="loading-spinner"></span></div>
    </div>

    <div class="section-label">Savings accounts</div>
    <div class="account-card" id="account-0">
      <div class="account-info">
        <div class="account-title">MY WALLET</div>
        <div class="account-iban">0x92d550cdBc234211957Bd1B579d962c885A127Ba</div>
        <div class="account-owner">Personal</div>
      </div>
      <div class="account-balance positive" id="balance-0"><span class="loading-spinner"></span></div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
  <script>
    // Polygon wallet addresses
    const POLYGON_RPC = "https://polygon-rpc.com/";
    const WALLETS = [
      { address: "0x92d550cdBc234211957Bd1B579d962c885A127Ba", label: "MY WALLET", owner: "Personal", idx: 0 },
      { address: "0xaf2d132c8773bca3821c24ecf64e844e202a12e8", label: "NFTFAN SALE", owner: "Trading", idx: 1 },
      { address: "0xB1A37c277986E13Aa6c4f0763c2F06C4E9527D54", label: "POLDOG SALE", owner: "Investment", idx: 2 }
    ];
    // UI order: Payment accounts (1,2), Savings (0)
    const DISPLAY_ORDER = [1, 2, 0];

    // Show balances and total sum
    async function fetchAndShowBalance(wallet, idx) {
      try {
        document.getElementById("balance-" + idx).innerHTML = '<span class="loading-spinner"></span>';
        const web3 = new Web3(POLYGON_RPC);
        const balanceWei = await web3.eth.getBalance(wallet.address);
        const balance = web3.utils.fromWei(balanceWei, "ether");
        const formatted = parseFloat(balance).toLocaleString(undefined, {maximumFractionDigits: 4});
        document.getElementById("balance-" + idx).textContent = "+ " + formatted + " MATIC";
        return parseFloat(balance);
      } catch (err) {
        document.getElementById("balance-" + idx).innerHTML = "--";
        return 0;
      }
    }

    async function refreshAllBalances() {
      // Show loading spinner on total
      document.getElementById("total-sum").innerHTML = '<span class="loading-spinner"></span>';
      let sum = 0;
      // Call and sum balances in UI order
      for (let i = 0; i < DISPLAY_ORDER.length; i++) {
        const idx = DISPLAY_ORDER[i];
        const balance = await fetchAndShowBalance(WALLETS[idx], idx);
        sum += balance;
      }
      // Show total sum
      document.getElementById("total-sum").textContent = "+ " + sum.toLocaleString(undefined, {maximumFractionDigits: 4}) + " MATIC";
    }

    window.addEventListener("DOMContentLoaded", () => {
      refreshAllBalances();
      setInterval(refreshAllBalances, 30000);
    });
  </script>
</body>
</html>
