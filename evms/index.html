<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Fans Neon Airdrop</title>
    <!-- Google Fonts for Cyberpunk/Neon look -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #39ff14;
            --neon-cyan: #00ffe7;
            --neon-pink: #ff0099;
            --neon-purple: #a259f7;
            --neon-bg: #15181b;
            --neon-card: rgba(28, 255, 188, 0.10);
            --glass-green: rgba(57,255,20,0.13);
            --border-glow: 0 0 8px #39ff14, 0 0 16px #00ffe7;
            --text-glow: 0 0 3px #39ff14, 0 0 8px #00ffe7, 0 0 12px #39ff14;
            --input-glass: rgba(0, 255, 231, 0.11);
            --btn-glass: rgba(255, 0, 153, 0.08);
            --radius: 15px;
            --shadow: 0 0 32px 0 #00ffe7;
            --score-glow: 0 0 4px #39ff14;
            --font-main: 'Orbitron', 'Share Tech Mono', Arial, sans-serif;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: var(--neon-bg);
            font-family: var(--font-main);
            color: #fff;
            font-size: 10px;
            min-height: 100vh;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .neon-title {
            font-size: 2.2em;
            margin-top: 32px;
            margin-bottom: 18px;
            letter-spacing: 0.015em;
            color: var(--neon-green);
            text-shadow: 0 0 18px var(--neon-green), 0 0 4px var(--neon-cyan), 0 0 2px #fff;
            text-align: center;
            font-family: var(--font-main);
            user-select: none;
        }
        .glass-box {
            width: 97vw;
            max-width: 430px;
            background: var(--glass-green);
            border-radius: var(--radius);
            box-shadow: var(--border-glow), var(--shadow);
            border: 2px solid var(--neon-green);
            padding: 18px 16px 18px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
            backdrop-filter: blur(6px);
            animation: cyber-float-in 1s cubic-bezier(.62,-0.29,.41,1.45);
        }
        @keyframes cyber-float-in {
            0% { opacity: 0; transform: translateY(60px) scale(0.96);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        .wallets-scroll {
            width: 100%;
            min-height: 54px;
            max-height: 100px;
            overflow-y: auto;
            background: var(--input-glass);
            border-radius: 8px;
            border: 1.5px solid var(--neon-cyan);
            margin: 0 0 8px 0;
            box-shadow: 0 0 7px #00ffe7;
            padding: 7px 9px 5px 9px;
            font-size: 8px;
            font-family: 'Share Tech Mono', monospace;
            word-break: break-all;
            color: var(--neon-cyan);
            text-shadow: 0 0 3px var(--neon-cyan);
            letter-spacing: 0.015em;
        }
        .data-form {
            display: flex;
            width: 100%;
            gap: 6px;
            margin: 0 0 12px 0;
        }
        .data-form textarea {
            flex: 1;
            height: 44px;
            background: var(--input-glass);
            border: 1.5px solid var(--neon-purple);
            color: #fff;
            font-size: 10px;
            font-family: 'Share Tech Mono', monospace;
            border-radius: 7px;
            padding: 7px 7px;
            resize: none;
            box-shadow: 0 0 8px var(--neon-purple);
            outline: none;
            transition: border 0.18s;
        }
        .data-form textarea:focus { border: 1.5px solid var(--neon-green);}
        .data-form button {
            background: linear-gradient(110deg,var(--neon-cyan) 37%,var(--neon-pink) 98%);
            color: #fff;
            border: none;
            border-radius: 7px;
            font-size: 10px;
            font-family: var(--font-main);
            font-weight: 800;
            letter-spacing: 0.02em;
            cursor: pointer;
            padding: 0 13px;
            box-shadow: 0 0 10px var(--neon-cyan);
            height: 44px;
            transition: background 0.13s, box-shadow 0.18s;
            outline: none;
        }
        .data-form button:active { transform: scale(0.97);}
        .btn-distribute {
            margin-left: 0;
            margin-top: 7px;
            width: 100%;
            background: linear-gradient(90deg,var(--neon-green) 34%, var(--neon-pink) 100%);
            color: #fff;
            font-size: 13px;
            padding: 9px 0;
            border-radius: 8px;
            font-family: var(--font-main);
            font-weight: 700;
            letter-spacing: 0.02em;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 12px 2px var(--neon-green);
            transition: background 0.15s, box-shadow 0.19s;
        }
        .btn-distribute:active { transform: scale(0.97);}
        .scores-row {
            width: 100%;
            margin: 10px 0 0 0;
            display: flex;
            justify-content: space-evenly;
            gap: 6px;
            font-size: 10px;
            color: var(--neon-green);
            font-family: var(--font-main);
            text-shadow: var(--score-glow);
            font-weight: 700;
        }
        .scores-row span {
            background: rgba(0,255,231,0.13);
            padding: 3px 10px;
            border-radius: 9px;
            border: 1.5px solid var(--neon-purple);
            min-width: 60px;
            text-align: center;
        }
        .wallet-info {
            font-size: 10px;
            color: var(--neon-pink);
            font-family: var(--font-main);
            text-align: center;
            word-break: break-all;
            margin: 8px 0 0 0;
            letter-spacing: 0.015em;
            font-weight: 800;
            text-shadow: 0 0 8px var(--neon-pink);
        }
        .btn-connect {
            width: 100%;
            margin-top: 7px;
            font-size: 12px;
            background: linear-gradient(90deg,var(--neon-cyan) 37%,var(--neon-pink) 98%);
            color: #fff;
            border: none;
            padding: 11px 0;
            border-radius: 8px;
            font-family: var(--font-main);
            font-weight: 800;
            letter-spacing: 0.02em;
            box-shadow: 0 0 10px var(--neon-cyan);
            cursor: pointer;
            transition: background 0.13s, box-shadow 0.18s;
        }
        .btn-connect:active { transform: scale(0.97);}
        #notification {
            position: fixed;
            top: 9px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            min-width: 158px;
            max-width: 95vw;
            background: rgba(0,0,0,0.85);
            color: var(--neon-cyan);
            border-radius: 8px;
            box-shadow: 0 0 18px var(--neon-pink), 0 0 6px #00ffe7;
            padding: 7px 17px;
            font-size: 9px;
            font-family: var(--font-main);
            font-weight: 800;
            letter-spacing: 0.01em;
            display: none;
            border: 2px solid var(--neon-pink);
            animation: neonFadeInOut 3s forwards;
            text-align: center;
            text-shadow: 0 0 3px var(--neon-cyan), 0 0 2px var(--neon-pink);
            pointer-events: none;
        }
        #notification.done { color: var(--neon-green); border-color: var(--neon-green);}
        #notification.error { color: #ff4444; border-color: #ff4444; text-shadow: 0 0 3px #ff4444;}
        #notification.pending { color: var(--neon-cyan); border-color: var(--neon-cyan);}
        #notification.info { color: var(--neon-purple); border-color: var(--neon-purple);}
        @keyframes neonFadeInOut {
            0% { opacity: 0;}
            15% { opacity: 1;}
            85% { opacity: 1;}
            100% { opacity: 0;}
        }
        .notif-table {
            width: 100%;
            margin: 8px 0 0 0;
            border-collapse: collapse;
            font-size: 9px;
            font-family: var(--font-main);
        }
        .notif-table th, .notif-table td {
            padding: 3px 2px;
            text-align: center;
        }
        .notif-table th {
            background: var(--neon-pink);
            color: #fff;
            font-weight: 900;
            border-radius: 7px 7px 0 0;
            letter-spacing: 0.01em;
            font-size: 9px;
        }
        .notif-table tr { background: transparent;}
        .notif-table td {
            border-bottom: 1px solid #a259f766;
            font-size: 9px;
            color: var(--neon-cyan);
        }
        .notif-status-done { background: rgba(57,255,20,0.09);}
        .notif-status-pending { background: rgba(0,255,231,0.08);}
        .notif-status-error { background: rgba(255,68,68,0.14);}
        .notif-status-info { background: rgba(162,89,247,0.10);}
        .notif-table tr:last-child td { border-bottom: none; }
        @media (max-width: 600px) {
            .glass-box { max-width: 99vw; padding: 9px 3px 12px 3px;}
            .neon-title { font-size: 1.3em;}
            .wallets-scroll { max-height: 70px; padding: 4px 4px;}
            .data-form textarea { font-size: 9px; padding: 4px 4px;}
            .scores-row span { min-width: 40px;}
            .btn-distribute, .btn-connect { font-size: 10px; padding: 7px 0;}
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <div class="neon-title">NFT FANS <span style="color:var(--neon-pink);text-shadow:0 0 16px var(--neon-pink);">NEON AIRDROP</span></div>
    <div class="glass-box">
        <form class="data-form" onsubmit="event.preventDefault(); handleSubmitData();">
            <textarea id="inputText" placeholder="Paste your X (Twitter) airdrop comments or wallets..."></textarea>
            <button type="submit" id="submitDataBtn" title="Submit Data">→</button>
        </form>
        <div class="wallets-scroll" id="walletsScrollBox"></div>
        <button class="btn-distribute" id="distributeButton" style="margin-top:6px;" onclick="distributeTokens()" disabled>DISTRIBUTE TOKENS</button>
        <div class="scores-row">
            <span id="totalWallets">Total: 0</span>
            <span id="doneWallets">Sent: 0</span>
            <span id="remainingWallets">Remain: 0</span>
        </div>
        <button class="btn-connect" id="connectButton" onclick="connectMetamask()">CONNECT WALLET</button>
        <div id="walletAddress" class="wallet-info"></div>
        <table class="notif-table" id="notifTable">
            <thead>
                <tr>
                    <th>STEP</th>
                    <th>STATUS</th>
                </tr>
            </thead>
            <tbody id="notifRows"></tbody>
        </table>
    </div>
    <div id="notification"></div>
    <script>
        const contractAddress = "0xdb82ac0c24Cd9D6C831e6Bd310e0c8BFa5670363";
        let web3;
        let contract;
        let userAccount;
        let extractedWallets = [];
        let currentBatchIndex = 0;
        const walletsPerBatch = 50;
        let walletsSent = 0;

        function updateWalletStats() {
            document.getElementById('totalWallets').textContent = "Total: " + extractedWallets.length;
            document.getElementById('doneWallets').textContent = "Sent: " + walletsSent;
            document.getElementById('remainingWallets').textContent = "Remain: " + (extractedWallets.length - walletsSent);
        }

        function showWalletsInBox() {
            const box = document.getElementById('walletsScrollBox');
            if (extractedWallets.length === 0) {
                box.textContent = '';
                document.getElementById('distributeButton').disabled = true;
                return;
            }
            box.innerHTML = extractedWallets.map(w => `<span>${w}</span>`).join(' ');
            document.getElementById('distributeButton').disabled = false;
        }

        function handleSubmitData() {
            let text = document.getElementById("inputText").value;
            let regex = /0x[a-fA-F0-9]{40}/g;
            let matches = text.match(regex);
            if (matches) {
                extractedWallets = [...new Set(matches)];
                currentBatchIndex = 0;
                walletsSent = 0;
                updateWalletStats();
                showWalletsInBox();
                showNotification(`Extracted ${extractedWallets.length} wallet${extractedWallets.length > 1 ? 's':''}.`, "done");
            } else {
                extractedWallets = [];
                walletsSent = 0;
                showWalletsInBox();
                updateWalletStats();
                showNotification("No wallets found. Please check your input!", "error");
            }
        }

        // Connect to MetaMask and Polygon network
        async function connectMetamask() {
            showNotification("Connecting wallet...", "pending");
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    document.getElementById('walletAddress').innerText = `CONNECTED: ${userAccount}`;
                    document.getElementById('connectButton').style.display = 'none';
                    await switchToPolygon();
                    showNotification("Wallet connected! Ready to distribute.", "done");
                    setupContract();
                } catch (err) {
                    showNotification("Connection denied!", "error");
                }
            } else {
                showNotification("Please install MetaMask!", "error");
            }
        }
        // Switch to Polygon network
        async function switchToPolygon() {
            if (!window.ethereum) return;
            const polygonChainId = "0x89";
            try {
                await window.ethereum.request({
                    method: "wallet_switchEthereumChain",
                    params: [{ chainId: polygonChainId }],
                });
                showNotification("Switched to Polygon!", "done");
            } catch (switchError) {
                if (switchError.code === 4902 || (switchError.data && switchError.data.originalError && switchError.data.originalError.code === 4902)) {
                    try {
                        await window.ethereum.request({
                            method: "wallet_addEthereumChain",
                            params: [{
                                chainId: polygonChainId,
                                chainName: "Polygon Mainnet",
                                nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                                rpcUrls: ["https://polygon-rpc.com/"],
                                blockExplorerUrls: ["https://polygonscan.com/"]
                            }]
                        });
                        showNotification("Polygon network added!", "done");
                    } catch (addError) {
                        showNotification("Failed to add Polygon network.", "error");
                    }
                } else {
                    showNotification("Failed to switch to Polygon.", "error");
                }
            }
        }
        // Setup smart contract
        function setupContract() {
            const abi = [
                {
                    "inputs": [
                        {"internalType": "address", "name": "_tokenAddress", "type": "address"}
                    ], "stateMutability": "nonpayable", "type": "constructor"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {"indexed": true, "internalType": "address", "name": "recipient", "type": "address"},
                        {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "TokensDistributed",
                    "type": "event"
                },
                {
                    "inputs": [
                        {"internalType": "address[]", "name": "recipients", "type": "address[]"}
                    ],
                    "name": "distributeTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {"internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "withdrawTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ];
            contract = new web3.eth.Contract(abi, contractAddress);
        }
        // Distribute tokens
        async function distributeTokens() {
            if (!userAccount || !contract) {
                showNotification("Connect your wallet first!", "error");
                return;
            }
            const wallets = extractedWallets.slice(currentBatchIndex, currentBatchIndex + walletsPerBatch);
            if (wallets.length === 0) {
                showNotification("No wallets to distribute.", "error");
                return;
            }
            showNotification("Processing transaction...", "pending");
            try {
                const tx = await contract.methods.distributeTokens(wallets).send({
                    from: userAccount,
                    gas: 2000000 // Adjust as needed
                });
                showNotification('Successfully distributed tokens!', 'done');
                walletsSent += wallets.length;
                currentBatchIndex += walletsPerBatch;
                updateWalletStats();
                showWalletsInBox();
            } catch (error) {
                showNotification('Distribution failed. Try again.', 'error');
            }
        }

        // Show notification with animated style
        function showNotification(message, status) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = status;
            notification.style.display = "block";
            setTimeout(function () {
                notification.style.display = "none";
            }, 2500);
            addNotificationToTable(message, status);
        }
        // Add notification to table (animated, 9px font)
        function addNotificationToTable(message, status) {
            const notifRows = document.getElementById('notifRows');
            const statusText = status === 'done' ? 'SUCCESS' : status.charAt(0).toUpperCase() + status.slice(1);
            const row = document.createElement('tr');
            row.className = `notif-status-${status}`;
            row.innerHTML = `<td>${message}</td><td>${statusText}</td>`;
            notifRows.appendChild(row);
            if (notifRows.childNodes.length > 7) {
                notifRows.removeChild(notifRows.childNodes[0]);
            }
        }

        // Listen for wallet disconnect
        window.addEventListener('load', function() {
            document.getElementById('inputText').addEventListener('paste', () => {
                // No extract button, but show cyberpunk highlight
                document.getElementById('inputText').style.border = '2px solid var(--neon-green)';
                setTimeout(() => {
                    document.getElementById('inputText').style.border = '1.5px solid var(--neon-purple)';
                }, 700);
            });
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        userAccount = null;
                        document.getElementById('walletAddress').innerText = '';
                        document.getElementById('connectButton').style.display = '';
                        showNotification("Wallet disconnected", "info");
                    }
                });
            }
        });
    </script>
</body>
</html>
