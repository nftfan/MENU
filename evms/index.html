<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Fans Neon Airdrop</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #39ff14;
            --neon-cyan: #00ffe7;
            --neon-pink: #ff0099;
            --neon-purple: #a259f7;
            --neon-bg: #15181b;
            --glass-green: rgba(57,255,20,0.13);
            --input-glass: rgba(0, 255, 231, 0.11);
            --radius: 15px;
            --font-main: 'Orbitron', 'Share Tech Mono', Arial, sans-serif;
            --score-bg: #262932;
            --score-border: #b8c0ff;
            --score-text: #f3f5fa;
            --score-accent1: #71f5c6;
            --score-accent2: #5b84e8;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: var(--neon-bg);
            font-family: var(--font-main);
            color: #fff;
            font-size: 10px;
            min-height: 100vh;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .neon-title {
            font-size: 2.2em;
            margin-top: 32px;
            margin-bottom: 10px;
            letter-spacing: 0.015em;
            color: var(--neon-green);
            text-align: center;
            font-family: var(--font-main);
            user-select: none;
        }
        .wallet-info {
            font-size: 11px;
            color: #fff;
            background: #23252a;
            font-family: var(--font-main);
            text-align: center;
            word-break: break-all;
            margin: 8px 0 12px 0;
            padding: 6px 10px;
            border-radius: 8px;
            font-weight: 700;
            border: 1.5px solid var(--neon-cyan);
            display: none;
        }
        .wallet-info.connected {
            display: block;
        }
        .btn-connect {
            margin-bottom: 10px;
            padding: 6px 16px;
            font-size: 11px;
            background: linear-gradient(90deg,var(--neon-cyan) 37%,var(--neon-pink) 98%);
            color: #fff;
            border: none;
            border-radius: 7px;
            font-family: var(--font-main);
            font-weight: 800;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: background 0.13s, box-shadow 0.18s;
            min-width: 0;
            width: auto;
            display: inline-block;
        }
        .btn-connect:active { transform: scale(0.98);}
        .glass-box {
            width: 97vw;
            max-width: 430px;
            background: var(--glass-green);
            border-radius: var(--radius);
            /* REMOVE box-shadow and border-glow */
            border: 2px solid var(--neon-green);
            padding: 18px 16px 18px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
            backdrop-filter: blur(6px);
        }
        .wallets-scroll {
            width: 100%;
            min-height: 54px;
            max-height: 100px;
            overflow-y: auto;
            background: var(--input-glass);
            border-radius: 8px;
            border: 1.5px solid var(--neon-cyan);
            margin: 0 0 8px 0;
            padding: 7px 9px 5px 9px;
            font-size: 8px;
            font-family: 'Share Tech Mono', monospace;
            word-break: break-all;
            color: var(--neon-cyan);
            letter-spacing: 0.015em;
        }
        .btn-paste {
            background: linear-gradient(110deg,var(--neon-cyan) 37%,var(--neon-pink) 98%);
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 13px;
            font-family: var(--font-main);
            font-weight: 800;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.13s, box-shadow 0.18s, transform 0.12s;
            outline: none;
            margin-bottom: 15px;
            padding: 0 18px;
            gap: 10px;
        }
        .btn-paste:active { transform: scale(0.95);}
        .btn-paste img {
            width: 26px;
            height: 26px;
            margin-right: 0px;
            display: inline-block;
        }
        .btn-paste span {
            font-size: 13px;
            font-weight: 700;
            font-family: var(--font-main);
            color: #fff;
            letter-spacing: 0.02em;
            margin-left: 1px;
        }
        .extract-bar-container {
            width: 100%;
            height: 7px;
            margin: 6px 0 9px 0;
            background: #222b;
            border-radius: 5px;
            overflow: hidden;
            display: none;
        }
        .extract-bar, .send-bar {
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-pink));
            border-radius: 5px;
            animation: extractBarAnim 1.3s linear forwards;
        }
        .send-bar {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan));
            animation: sendBarAnim 2s linear forwards;
        }
        @keyframes extractBarAnim {
            from { width: 0; }
            to { width: 100%; }
        }
        @keyframes sendBarAnim {
            from { width: 0; }
            to { width: 100%; }
        }
        .send-bar-container {
            width: 100%;
            height: 7px;
            margin: 10px 0 11px 0;
            background: #222b;
            border-radius: 5px;
            overflow: hidden;
            display: none;
        }
        .btn-distribute {
            margin-top: 9px;
            min-width: 0;
            width: auto;
            height: 48px;
            border-radius: 30px;
            background: linear-gradient(90deg,var(--neon-green) 15%, var(--neon-pink) 94%);
            border: none;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 18px;
            cursor: pointer;
            transition: box-shadow 0.17s, filter 0.14s, background 0.13s;
            gap: 11px;
        }
        .btn-distribute:active { filter: brightness(1.2);}
        .btn-distribute img {
            width: 28px;
            height: 28px;
            display: inline-block;
            margin-right: 0;
        }
        .btn-distribute span {
            font-size: 13px;
            font-weight: 700;
            font-family: var(--font-main);
            color: #fff;
            letter-spacing: 0.02em;
            margin-left: 1px;
        }
        .next-batch-label {
            font-size: 10px;
            color: var(--score-accent2);
            font-family: var(--font-main);
            font-weight: 900;
            text-shadow: 0 1px 2px #0008;
            letter-spacing: 0.02em;
            margin-top: 5px;
            margin-bottom: 5px;
            display: none;
        }
        .scores-row {
            width: 100%;
            margin: 14px 0 0 0;
            display: flex;
            justify-content: space-evenly;
            gap: 6px;
            font-size: 1.1em;
            color: var(--score-text);
            font-family: var(--font-main);
            font-weight: 700;
        }
        .scores-row span {
            background: var(--score-bg);
            color: var(--score-text);
            padding: 7px 15px 7px 15px;
            border-radius: 10px;
            border: 1.5px solid var(--score-border);
            min-width: 70px;
            text-align: center;
            font-size: 1em;
            font-weight: 800;
            letter-spacing: 0.02em;
            margin: 0 3px;
            transition: background 0.16s, color 0.16s, border 0.16s;
        }
        .scores-row span#totalWallets { color: var(--score-accent1); border-color: var(--score-accent1);}
        .scores-row span#doneWallets { color: var(--score-accent2); border-color: var(--score-accent2);}
        .scores-row span#remainingWallets { color: #e67e22; border-color: #e67e22;}
        #notification {
            position: fixed;
            top: 9px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            min-width: 158px;
            max-width: 95vw;
            background: rgba(0,0,0,0.85);
            color: var(--neon-cyan);
            border-radius: 8px;
            box-shadow: none;
            padding: 7px 17px;
            font-size: 9px;
            font-family: var(--font-main);
            font-weight: 800;
            letter-spacing: 0.01em;
            display: none;
            border: 2px solid var(--neon-pink);
            animation: neonFadeInOut 3s forwards;
            text-align: center;
            pointer-events: none;
        }
        #notification.done { color: var(--neon-green); border-color: var(--neon-green);}
        #notification.error { color: #ff4444; border-color: #ff4444;}
        #notification.pending { color: var(--neon-cyan); border-color: var(--neon-cyan);}
        #notification.info { color: var(--neon-purple); border-color: var(--neon-purple);}
        @keyframes neonFadeInOut {
            0% { opacity: 0;}
            15% { opacity: 1;}
            85% { opacity: 1;}
            100% { opacity: 0;}
        }
        .notif-table {
            width: 100%;
            margin: 8px 0 0 0;
            border-collapse: collapse;
            font-size: 9px;
            font-family: var(--font-main);
        }
        .notif-table th, .notif-table td {
            padding: 3px 2px;
            text-align: center;
        }
        .notif-table th {
            background: var(--neon-pink);
            color: #fff;
            font-weight: 900;
            border-radius: 7px 7px 0 0;
            letter-spacing: 0.01em;
            font-size: 9px;
        }
        .notif-table tr { background: transparent;}
        .notif-table td {
            border-bottom: 1px solid #a259f766;
            font-size: 9px;
            color: var(--neon-cyan);
        }
        .notif-status-done { background: rgba(57,255,20,0.09);}
        .notif-status-pending { background: rgba(0,255,231,0.08);}
        .notif-status-error { background: rgba(255,68,68,0.14);}
        .notif-status-info { background: rgba(162,89,247,0.10);}
        .notif-table tr:last-child td { border-bottom: none; }
        @media (max-width: 600px) {
            .glass-box { max-width: 99vw; padding: 9px 3px 12px 3px;}
            .neon-title { font-size: 1.3em;}
            .wallets-scroll { max-height: 70px; padding: 4px 4px;}
            .scores-row span { min-width: 40px;}
            .btn-distribute img { width: 24px; height: 24px;}
            .btn-paste img { width: 22px; height: 22px;}
            .btn-connect { font-size: 10px; padding: 4px 8px;}
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <div class="neon-title">NFT FANS <span style="color:var(--neon-pink);">NEON AIRDROP</span></div>
    <button class="btn-connect" id="connectButton" onclick="connectMetamask()">CONNECT</button>
    <div id="walletAddress" class="wallet-info"></div>
    <div class="glass-box">
        <button type="button" class="btn-paste" id="pasteBtn" title="Paste" tabindex="0">
            <img src="https://i.imgur.com/o8INLVb.png" alt="Paste Icon"/>
            <span>Paste Text</span>
        </button>
        <div class="extract-bar-container" id="extractBarContainer">
            <div class="extract-bar" id="extractBar"></div>
        </div>
        <div class="wallets-scroll" id="walletsScrollBox"></div>
        <span class="next-batch-label" id="nextBatchLabel">Next 50</span>
        <button class="btn-distribute" id="distributeButton" title="Distribute Next 50" onclick="distributeTokens()" style="display:none;">
            <img src="https://i.imgur.com/OsyqysE.png" alt="Send Icon"/>
            <span>Send Tokens</span>
        </button>
        <div class="send-bar-container" id="sendBarContainer">
            <div class="send-bar" id="sendBar"></div>
        </div>
        <div class="scores-row">
            <span id="totalWallets">Total: 0</span>
            <span id="doneWallets">Sent: 0</span>
            <span id="remainingWallets">Remain: 0</span>
        </div>
        <table class="notif-table" id="notifTable">
            <thead>
                <tr>
                    <th>STEP</th>
                    <th>STATUS</th>
                </tr>
            </thead>
            <tbody id="notifRows"></tbody>
        </table>
    </div>
    <div id="notification"></div>
    <script>
        const contractAddress = "0xdb82ac0c24Cd9D6C831e6Bd310e0c8BFa5670363";
        let web3;
        let contract;
        let userAccount;
        let extractedWallets = []; // global wallet set
        let currentBatchIndex = 0;
        const walletsPerBatch = 50;
        let walletsSent = 0;

        function updateWalletStats() {
            document.getElementById('totalWallets').textContent = "Total: " + extractedWallets.length;
            document.getElementById('doneWallets').textContent = "Sent: " + walletsSent;
            document.getElementById('remainingWallets').textContent = "Remain: " + (extractedWallets.length - walletsSent);
        }

        function showWalletsInBox() {
            const box = document.getElementById('walletsScrollBox');
            if (extractedWallets.length === 0) {
                box.textContent = '';
                document.getElementById('distributeButton').style.display = 'none';
                document.getElementById('nextBatchLabel').style.display = 'none';
                return;
            }
            const batch = extractedWallets.slice(currentBatchIndex, currentBatchIndex + walletsPerBatch);
            box.innerHTML = batch.map(w => `<span>${w}</span>`).join(' ');
            if (batch.length > 0) {
                document.getElementById('distributeButton').style.display = '';
            } else {
                document.getElementById('distributeButton').style.display = 'none';
            }
            // Show next 50 *after* first batch is sent and more wallets remain
            if (walletsSent >= walletsPerBatch && currentBatchIndex < extractedWallets.length) {
                document.getElementById('nextBatchLabel').style.display = '';
            } else {
                document.getElementById('nextBatchLabel').style.display = 'none';
            }
        }

        // Paste button logic (append new wallets, keep previous)
        document.getElementById('pasteBtn').addEventListener('click', async () => {
            if (!navigator.clipboard) {
                showNotification("Clipboard API not supported", "error");
                return;
            }
            try {
                const text = await navigator.clipboard.readText();
                startExtractAnimation();
                setTimeout(() => {
                    extractAndAppendWallets(text);
                }, 900); // Show animation bar for 0.9s before extracting
            } catch (e) {
                showNotification("Paste failed", "error");
            }
        });

        function startExtractAnimation() {
            const barCont = document.getElementById('extractBarContainer');
            const bar = document.getElementById('extractBar');
            barCont.style.display = 'block';
            bar.style.width = '0';
            bar.style.animation = 'none';
            void bar.offsetWidth;
            bar.style.animation = 'extractBarAnim 1.3s linear forwards';
            setTimeout(() => {
                barCont.style.display = 'none';
            }, 1300);
        }

        // Show animation bar for sending tokens
        function startSendAnimation() {
            const sendBarCont = document.getElementById('sendBarContainer');
            const sendBar = document.getElementById('sendBar');
            sendBarCont.style.display = 'block';
            sendBar.style.width = '0';
            sendBar.style.animation = 'none';
            void sendBar.offsetWidth;
            sendBar.style.animation = 'sendBarAnim 2s linear forwards';
            setTimeout(() => {
                sendBarCont.style.display = 'none';
            }, 2000);
        }

        // Append new wallets, keep previous, update scores
        function extractAndAppendWallets(text) {
            let regex = /0x[a-fA-F0-9]{40}/g;
            let matches = text.match(regex);
            let oldCount = extractedWallets.length;
            if (matches) {
                // Add to existing set, preserving order
                let set = new Set(extractedWallets);
                let added = 0;
                for (let w of matches) {
                    if (!set.has(w)) {
                        set.add(w);
                        added++;
                    }
                }
                extractedWallets = Array.from(set);
                // Reset batch only if we were at the start (not in the middle of multi-batch send)
                if (walletsSent === 0) {
                    currentBatchIndex = 0;
                }
                updateWalletStats();
                showWalletsInBox();
                if (added > 0) {
                    showNotification(`Added ${added} new wallet${added > 1 ? 's':''}.`, "done");
                } else {
                    showNotification("No new wallets found.", "info");
                }
            } else {
                showNotification("No wallets found in pasted text.", "error");
            }
        }

        // Connect to MetaMask and Polygon network
        async function connectMetamask() {
            showNotification("Connecting wallet...", "pending");
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    document.getElementById('walletAddress').innerText = `Connected: ${userAccount}`;
                    document.getElementById('walletAddress').classList.add('connected');
                    document.getElementById('connectButton').style.display = 'none';
                    await switchToPolygon();
                    showNotification("Wallet connected! Ready to distribute.", "done");
                    setupContract();
                } catch (err) {
                    showNotification("Connection denied!", "error");
                }
            } else {
                showNotification("Please install MetaMask!", "error");
            }
        }
        // Switch to Polygon network
        async function switchToPolygon() {
            if (!window.ethereum) return;
            const polygonChainId = "0x89";
            try {
                await window.ethereum.request({
                    method: "wallet_switchEthereumChain",
                    params: [{ chainId: polygonChainId }],
                });
                showNotification("Switched to Polygon!", "done");
            } catch (switchError) {
                if (switchError.code === 4902 || (switchError.data && switchError.data.originalError && switchError.data.originalError.code === 4902)) {
                    try {
                        await window.ethereum.request({
                            method: "wallet_addEthereumChain",
                            params: [{
                                chainId: polygonChainId,
                                chainName: "Polygon Mainnet",
                                nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                                rpcUrls: ["https://polygon-rpc.com/"],
                                blockExplorerUrls: ["https://polygonscan.com/"]
                            }]
                        });
                        showNotification("Polygon network added!", "done");
                    } catch (addError) {
                        showNotification("Failed to add Polygon network.", "error");
                    }
                } else {
                    showNotification("Failed to switch to Polygon.", "error");
                }
            }
        }
        // Setup smart contract
        function setupContract() {
            const abi = [
                {
                    "inputs": [
                        {"internalType": "address", "name": "_tokenAddress", "type": "address"}
                    ], "stateMutability": "nonpayable", "type": "constructor"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {"indexed": true, "internalType": "address", "name": "recipient", "type": "address"},
                        {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "TokensDistributed",
                    "type": "event"
                },
                {
                    "inputs": [
                        {"internalType": "address[]", "name": "recipients", "type": "address[]"}
                    ],
                    "name": "distributeTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {"internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "withdrawTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ];
            contract = new web3.eth.Contract(abi, contractAddress);
        }
        // Distribute tokens
        async function distributeTokens() {
            if (!userAccount || !contract) {
                showNotification("Connect your wallet first!", "error");
                return;
            }
            const wallets = extractedWallets.slice(currentBatchIndex, currentBatchIndex + walletsPerBatch);
            if (wallets.length === 0) {
                showNotification("No wallets to distribute.", "error");
                return;
            }
            showNotification("Processing transaction...", "pending");
            startSendAnimation();
            try {
                const tx = await contract.methods.distributeTokens(wallets).send({
                    from: userAccount,
                    gas: 2000000 // Adjust as needed
                });
                showNotification('Successfully distributed tokens!', 'done');
                walletsSent += wallets.length;
                currentBatchIndex += walletsPerBatch;
                updateWalletStats();
                showWalletsInBox();
            } catch (error) {
                showNotification('Distribution failed. Try again.', 'error');
            }
        }

        // Show notification with animated style
        function showNotification(message, status) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = status;
            notification.style.display = "block";
            setTimeout(function () {
                notification.style.display = "none";
            }, 2500);
            addNotificationToTable(message, status);
        }
        // Add notification to table (animated, 9px font)
        function addNotificationToTable(message, status) {
            const notifRows = document.getElementById('notifRows');
            const statusText = status === 'done' ? 'SUCCESS' : status.charAt(0).toUpperCase() + status.slice(1);
            const row = document.createElement('tr');
            row.className = `notif-status-${status}`;
            row.innerHTML = `<td>${message}</td><td>${statusText}</td>`;
            notifRows.appendChild(row);
            if (notifRows.childNodes.length > 7) {
                notifRows.removeChild(notifRows.childNodes[0]);
            }
        }

        // Listen for wallet disconnect
        window.addEventListener('load', function() {
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        userAccount = null;
                        document.getElementById('walletAddress').innerText = '';
                        document.getElementById('walletAddress').classList.remove('connected');
                        document.getElementById('connectButton').style.display = '';
                        showNotification("Wallet disconnected", "info");
                    }
                });
            }
        });
    </script>
</body>
</html>
