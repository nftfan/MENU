<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>$NFTFANS Professional Buyer Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="icon" href="https://i.imgur.com/ODP45iQ.png" type="image/png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root {
  --bg-primary: #0a0a0f;
  --bg-secondary: #131318;
  --bg-card: #1a1a22;
  --bg-card-hover: #20202a;
  --bg-input: #25253a;
  --accent-primary: #00d4ff;
  --accent-secondary: #ff0080;
  --accent-success: #00ff88;
  --accent-warning: #ffaa00;
  --accent-error: #ff4757;
  --text-primary: #ffffff;
  --text-secondary: #b8b9c7;
  --text-muted: #6c6d7a;
  --border-color: #2d2d3f;
  --border-glow: rgba(0, 212, 255, 0.3);
  --shadow-neon: 0 0 20px rgba(0, 212, 255, 0.3);
  --shadow-neon-hover: 0 0 30px rgba(0, 212, 255, 0.5);
  --radius: 12px;
  --radius-lg: 20px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --font-primary: 'Orbitron', monospace;
  --font-secondary: 'Rajdhani', sans-serif;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-secondary);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  background-image: 
    radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 0, 128, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.03) 0%, transparent 50%);
  background-attachment: fixed;
}

.container {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* changed from center to flex-start */
}


.main-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-neon);
  overflow: hidden;
  position: relative;
}

.main-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-success));
  animation: shimmer 3s infinite linear;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.header {
  text-align: center;
  padding: 40px 30px 30px;
  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
  border-bottom: 1px solid var(--border-color);
}

.logo {
  width: 60px;
  height: 60px;
  margin: 0 auto 20px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-neon);
  animation: logoGlow 2s ease-in-out infinite alternate;
}

@keyframes logoGlow {
  from { box-shadow: var(--shadow-neon); }
  to { box-shadow: var(--shadow-neon-hover); }
}

.logo img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

h1 {
  font-family: var(--font-primary);
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
  letter-spacing: 2px;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  font-weight: 400;
}

.content {
  padding: 30px;
}

.progress-bar {
  background: var(--bg-secondary);
  height: 6px;
  border-radius: 3px;
  margin-bottom: 30px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: progressShimmer 2s infinite;
}

@keyframes progressShimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.step {
  display: none;
  animation: fadeInUp 0.6s ease-out;
}

.step.active {
  display: block;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.step-header {
  text-align: center;
  margin-bottom: 30px;
}

.step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-radius: 50%;
  font-family: var(--font-primary);
  font-weight: 700;
  font-size: 18px;
  margin-bottom: 15px;
  box-shadow: var(--shadow-neon);
}

.step-title {
  font-family: var(--font-primary);
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.step-description {
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1.6;
}

.form-group {
  margin-bottom: 25px;
}

.form-label {
  display: block;
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 14px;
}

.input-group {
  position: relative;
}

.input-field {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: 15px 20px;
  color: var(--text-primary);
  font-size: 16px;
  font-family: inherit;
  transition: var(--transition);
  outline: none;
}

.input-field:focus {
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
}

.input-field::placeholder {
  color: var(--text-muted);
}

.input-icon {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--accent-primary);
  font-size: 20px;
}

.btn {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: var(--text-primary);
  border: none;
  border-radius: var(--radius);
  padding: 15px 30px;
  font-family: var(--font-primary);
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: var(--shadow-neon);
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-neon-hover);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  box-shadow: none;
}

.btn-secondary:hover {
  background: var(--bg-card-hover);
  color: var(--text-primary);
}

.notification {
  padding: 15px 20px;
  border-radius: var(--radius);
  margin-bottom: 20px;
  border-left: 4px solid;
  background: var(--bg-secondary);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideInRight 0.5s ease-out;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.notification.success {
  border-color: var(--accent-success);
  background: rgba(0, 255, 136, 0.1);
}

.notification.error {
  border-color: var(--accent-error);
  background: rgba(255, 71, 87, 0.1);
}

.notification.warning {
  border-color: var(--accent-warning);
  background: rgba(255, 170, 0, 0.1);
}

.notification.info {
  border-color: var(--accent-primary);
  background: rgba(0, 212, 255, 0.1);
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--bg-secondary);
  border-top: 3px solid var(--accent-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.contract-address {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: 15px;
  margin: 15px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
}

.contract-text {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  color: var(--accent-primary);
  word-break: break-all;
  flex: 1;
}

.copy-btn {
  background: var(--accent-primary);
  color: var(--bg-primary);
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  cursor: pointer;
  transition: var(--transition);
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.copy-btn:hover {
  background: var(--accent-secondary);
  transform: scale(1.05);
}

.balance-display {
  background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 25px;
  text-align: center;
  margin: 20px 0;
  position: relative;
  overflow: hidden;
}

.balance-display::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
  animation: scan 3s infinite;
}

@keyframes scan {
  0% { left: -100%; }
  100% { left: 100%; }
}

.balance-label {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.balance-amount {
  font-family: var(--font-primary);
  font-size: 32px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-success));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 5px;
}

.balance-currency {
  color: var(--text-muted);
  font-size: 16px;
  font-weight: 500;
}

.step-buttons {
  display: flex;
  gap: 15px;
  margin-top: 30px;
}

.step-buttons .btn {
  flex: 1;
}

.pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.7;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.success-animation {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  text-align: center;
}

.success-icon {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-success), var(--accent-primary));
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  animation: successPop 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes successPop {
  0% {
    transform: scale(0);
    rotate: -180deg;
  }
  100% {
    transform: scale(1);
    rotate: 0deg;
  }
}

.success-icon .material-icons {
  font-size: 40px;
  color: var(--text-primary);
}

.countdown {
  background: var(--bg-secondary);
  border-radius: var(--radius);
  padding: 15px;
  text-align: center;
  margin: 20px 0;
  border: 1px solid var(--border-color);
}

.countdown-timer {
  font-family: var(--font-primary);
  font-size: 24px;
  color: var(--accent-warning);
  font-weight: 700;
}

.countdown-label {
  color: var(--text-secondary);
  font-size: 12px;
  margin-top: 5px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .header {
    padding: 30px 20px 20px;
  }
  
  h1 {
    font-size: 20px;
  }
  
  .content {
    padding: 20px;
  }
  
  .step-buttons {
    flex-direction: column;
  }
  
  .balance-amount {
    font-size: 24px;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <div class="main-card">
      <div class="header">
        <div class="logo">
          <img src="https://i.imgur.com/ODP45iQ.png" alt="NFTFAN Logo" />
        </div>
        <h1>$NFTFAN PURCHASE PORTAL</h1>
        <p class="subtitle">Professional Token Acquisition Platform</p>
      </div>

      <div class="content">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>

        <div id="notifications"></div>

        <!-- Step 1: Welcome & Overview -->
        <div class="step active" id="step1">
          <div class="step-header">
            <div class="step-number">1</div>
            <h2 class="step-title">Welcome to $NFTFAN</h2>
            <p class="step-description">Start your journey to acquire $NFTFAN tokens through our secure automated system.</p>
          </div>
          
          <div class="notification info">
            <span class="material-icons">info</span>
            <div>
              <strong>Important:</strong> This process will automatically distribute $NFTFAN tokens to your wallet after payment confirmation.
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn" onclick="nextStep()">
              <span class="material-icons">rocket_launch</span>
              Start Purchase Process
            </button>
          </div>
        </div>

        <!-- Step 2: Wallet Address -->
        <div class="step" id="step2">
          <div class="step-header">
            <div class="step-number">2</div>
            <h2 class="step-title">Enter Wallet Address</h2>
            <p class="step-description">Provide your Polygon (EVM) wallet address where you'll receive your $NFTFAN tokens.</p>
          </div>

          <div class="form-group">
            <label class="form-label">Polygon Wallet Address</label>
            <div class="input-group">
              <input 
                type="text" 
                class="input-field" 
                id="walletAddress" 
                placeholder="0x..." 
                maxlength="42"
                autocomplete="off"
              />
              <span class="input-icon material-icons">account_balance_wallet</span>
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="validateWallet()">
              <span class="material-icons">check_circle</span>
              Validate Address
            </button>
          </div>
        </div>

        <!-- Step 3: Purchase Amount -->
        <div class="step" id="step3">
          <div class="step-header">
            <div class="step-number">3</div>
            <h2 class="step-title">Select Purchase Amount</h2>
            <p class="step-description">Choose how much $POL (MATIC) you want to spend on $NFTFAN tokens.</p>
          </div>

          <div class="form-group">
            <label class="form-label">Amount in $POL (MATIC)</label>
            <div class="input-group">
              <input 
                type="number" 
                class="input-field" 
                id="purchaseAmount" 
                placeholder="1.5" 
                min="0.01" 
                max="100" 
                step="0.01"
              />
              <span class="input-icon material-icons">payments</span>
            </div>
          </div>

          <div class="notification warning">
            <span class="material-icons">warning</span>
            <div>
              <strong>Range:</strong> Minimum 0.01 $POL - Maximum 100 $POL per transaction
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="validateAmount()">
              <span class="material-icons">calculate</span>
              Confirm Amount
            </button>
          </div>
        </div>

        <!-- Step 4: Payment Instructions -->
        <div class="step" id="step4">
          <div class="step-header">
            <div class="step-number">4</div>
            <h2 class="step-title">Send Payment</h2>
            <p class="step-description">Send the exact amount to our smart contract address below.</p>
          </div>

          <div class="contract-address">
            <div class="contract-text" id="contractAddress">0xaf2d132C8773bca3821C24EcF64e844E202A12e8</div>
            <button class="copy-btn" onclick="copyContract()">
              <span class="material-icons">content_copy</span>
              Copy
            </button>
          </div>

          <div class="notification info">
            <span class="material-icons">account_balance</span>
            <div>
              <strong>Send exactly:</strong> <span id="exactAmount">0</span> $POL<br>
              <strong>From your wallet:</strong> <span id="displayWallet">Your wallet</span>
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="confirmPayment()">
              <span class="material-icons">send</span>
              I've Sent Payment
            </button>
          </div>
        </div>

        <!-- Step 5: Processing -->
        <div class="step" id="step5">
          <div class="step-header">
            <div class="step-number">5</div>
            <h2 class="step-title">Processing Transaction</h2>
            <p class="step-description">Please wait while we confirm your payment and process the token distribution.</p>
          </div>

          <div class="countdown">
            <div class="countdown-timer" id="countdownTimer">30</div>
            <div class="countdown-label">Seconds remaining</div>
          </div>

          <div class="notification info">
            <div class="loading-spinner"></div>
            <div>
              <strong>Processing...</strong> Confirming your transaction on the blockchain. This may take a few moments.
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="checkStatus()" id="checkStatusBtn" disabled>
              <span class="material-icons">refresh</span>
              Check Status
            </button>
          </div>
        </div>

        <!-- Step 6: Success & Balance -->
        <div class="step" id="step6">
          <div class="step-header">
            <div class="step-number">6</div>
            <h2 class="step-title">Transaction Complete!</h2>
            <p class="step-description">Your $NFTFAN tokens have been successfully transferred to your wallet.</p>
          </div>

          <div class="success-animation">
            <div class="success-icon">
              <span class="material-icons">check</span>
            </div>
          </div>

          <div class="balance-display">
            <div class="balance-label">Your $NFTFAN Balance</div>
            <div class="balance-amount" id="finalBalance">0</div>
            <div class="balance-currency">$NFTFAN</div>
          </div>

          <div class="notification success">
            <span class="material-icons">celebration</span>
            <div>
              <strong>Success!</strong> Your tokens are now available in your wallet. Transaction completed successfully.
            </div>
          </div>

          <div class="step-buttons">
            <button class="btn" onclick="buyMore()">
              <span class="material-icons">add_shopping_cart</span>
              Purchase More
            </button>
            <button class="btn btn-secondary" onclick="viewOnExplorer()">
              <span class="material-icons">open_in_new</span>
              View on Explorer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      tokenAddress: "0x2017Fcaea540d2925430586DC92818035Bfc2F50",
      apiKey: "3AFN3ZU4ANK3XEUJQ6BRJCBCITAFHKFVTV",
      airdropContract: "0xaf2d132C8773bca3821C24EcF64e844E202A12e8"
    };

    // State management
    let currentStep = 1;
    let userWallet = '';
    let purchaseAmount = 0;
    let processingTimer = null;
    let countdownTimer = null;

    // Utility functions
    function validateEthAddress(addr) {
      return /^0x[a-fA-F0-9]{40}$/.test(addr);
    }

    function formatNumber(num) {
      return new Intl.NumberFormat().format(num);
    }

    function showNotification(type, message, duration = 5000) {
      const notifications = document.getElementById('notifications');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const icon = type === 'success' ? 'check_circle' : 
                   type === 'error' ? 'error' : 
                   type === 'warning' ? 'warning' : 'info';
      
      notification.innerHTML = `
        <span class="material-icons">${icon}</span>
        <div>${message}</div>
      `;
      
      notifications.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.5s ease-out forwards';
        setTimeout(() => notification.remove(), 500);
      }, duration);
    }

    function updateProgress() {
      const progress = (currentStep / 6) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
    }

    function showStep(stepNumber) {
      document.querySelectorAll('.step').forEach(step => {
        step.classList.remove('active');
      });
      document.getElementById(`step${stepNumber}`).classList.add('active');
      currentStep = stepNumber;
      updateProgress();
    }

    function nextStep() {
      if (currentStep < 6) {
        showStep(currentStep + 1);
      }
    }

    function previousStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // Step-specific functions
    function validateWallet() {
      const wallet = document.getElementById('walletAddress').value.trim();
      
      if (!wallet) {
        showNotification('error', 'Please enter a wallet address.');
        return;
      }
      
      if (!validateEthAddress(wallet)) {
        showNotification('error', 'Invalid wallet address. Please enter a valid Polygon (EVM) address starting with 0x.');
        return;
      }
      
      userWallet = wallet;
      showNotification('success', 'Wallet address validated successfully!');
      
      setTimeout(() => {
        nextStep();
      }, 1500);
    }

    function validateAmount() {
      const amount = parseFloat(document.getElementById('purchaseAmount').value);
      
      if (!amount || isNaN(amount)) {
        showNotification('error', 'Please enter a valid amount.');
        return;
      }
      
      if (amount < 0.01 || amount > 100) {
        showNotification('error', 'Amount must be between 0.01 and 100 $POL.');
        return;
      }
      
      purchaseAmount = amount;
      showNotification('success', `Purchase amount set to ${amount} $POL`);
      
      // Update payment instructions
      document.getElementById('exactAmount').textContent = amount;
      document.getElementById('displayWallet').textContent = `${userWallet.substring(0, 6)}...${userWallet.substring(userWallet.length - 4)}`;
      
      setTimeout(() => {
        nextStep();
      }, 1500);
    }

    function copyContract() {
      const contractAddress = document.getElementById('contractAddress').textContent;
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(contractAddress).then(() => {
          showNotification('success', 'Contract address copied to clipboard!');
        });
      } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = contractAddress;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showNotification('success', 'Contract address copied to clipboard!');
      }
    }

    function confirmPayment() {
      showNotification('info', 'Payment confirmation received. Starting processing...');
      
      setTimeout(() => {
        nextStep();
        startProcessing();
      }, 1500);
    }

    function startProcessing() {
      let countdown = 30;
      const countdownElement = document.getElementById('countdownTimer');
      const checkStatusBtn = document.getElementById('checkStatusBtn');
      
      countdownTimer = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownTimer);
          checkStatusBtn.disabled = false;
          checkStatusBtn.textContent = 'Processing Complete';
          
          setTimeout(() => {
            completeTransaction();
          }, 2000);
        }
      }, 1000);
    }

    async function completeTransaction() {
      showNotification('success', 'Transaction processed successfully!');
      
      // Fetch actual balance
      await fetchBalance();
      
      setTimeout(() => {
        nextStep();
      }, 2000);
    }

    async function fetchBalance() {
      try {
        const url = `https://api.polygonscan.com/api?module=account&action=tokenbalance&contractaddress=${CONFIG.tokenAddress}&address=${userWallet}&tag=latest&apikey=${CONFIG.apiKey}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === "1") {
          const decimals = 18;
          const balance = Number(data.result) / 10 ** decimals;
          document.getElementById('finalBalance').textContent = formatNumber(Math.floor(balance));
        } else {
          document.getElementById('finalBalance').textContent = 'Error loading balance';
        }
      } catch (error) {
        console.error('Error fetching balance:', error);
        document.getElementById('finalBalance').textContent = 'Error loading balance';
      }
    }

    function checkStatus() {
      showNotification('info', 'Checking transaction status...');
      // This would typically check the actual blockchain status
      setTimeout(() => {
        completeTransaction();
      }, 2000);
    }

    function buyMore() {
      // Reset to step 2 for another purchase
      userWallet = '';
      purchaseAmount = 0;
      document.getElementById('walletAddress').value = '';
      document.getElementById('purchaseAmount').value = '';
      showStep(2);
      showNotification('info', 'Starting new purchase process...');
    }

    function viewOnExplorer() {
      window.open(`https://polygonscan.com/address/${userWallet}`, '_blank');
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
      
      // Add Enter key support for input fields
      document.getElementById('walletAddress').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          validateWallet();
        }
      });
      
      document.getElementById('purchaseAmount').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          validateAmount();
        }
      });
      
      showNotification('info', 'Welcome to the $NFTFAN Purchase Portal. Follow the steps to complete your purchase.', 3000);
    });

    // Cleanup timers when page is unloaded
    window.addEventListener('beforeunload', function() {
      if (processingTimer) clearInterval(processingTimer);
      if (countdownTimer) clearInterval(countdownTimer);
    });
  </script>
</body>
</html>
