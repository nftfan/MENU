<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>$NFTFANS Professional Buyer Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="icon" href="https://i.imgur.com/ODP45iQ.png" type="image/png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root {
  --bg-primary: #060613;
  --bg-secondary: #10101a;
  --bg-card: #171729;
  --bg-card-hover: #222236;
  --bg-input: #1c1c31;
  --accent-primary: #00ffd0;
  --accent-secondary: #ff00e2;
  --accent-success: #00ffae;
  --accent-warning: #ffd900;
  --accent-error: #ff3569;
  --text-primary: #fff;
  --text-secondary: #b8b9c7;
  --text-muted: #5a5b6b;
  --border-color: #282840;
  --border-glow: 0 0 12px #00ffd0;
  --shadow-neon: 0 0 8px #00ffd0, 0 0 14px #ff00e2;
  --shadow-neon-hover: 0 0 18px #ff00e2, 0 0 7px #00ffd0;
  --radius: 8px;
  --radius-lg: 16px;
  --transition: all 0.2s cubic-bezier(.57,1.54,.51,.9);
  --font-primary: 'Orbitron', monospace;
  --font-secondary: 'Rajdhani', sans-serif;
  font-size: 10px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  font-family: var(--font-secondary);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  font-size: 10px;
  background-image:
    repeating-linear-gradient(135deg,rgba(0,255,208,.04) 0 2px,transparent 2px 30px),
    radial-gradient(circle at 20% 70%,rgba(0,255,208,.10) 0 10%,transparent 70%),
    radial-gradient(circle at 80% 10%,rgba(255,0,226,.09) 0 10%,transparent 80%);
  background-attachment: fixed;
  overflow-x: hidden;
}
.container {
  max-width: 380px;
  margin: 0 auto;
  padding: 8px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  font-size: 10px;
}
.main-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  border: 1.2px solid var(--border-color);
  box-shadow: var(--shadow-neon);
  overflow: hidden;
  position: relative;
  animation: floatCard 4s infinite alternate cubic-bezier(.6,1.5,.5,1);
}
@keyframes floatCard {
  0% { box-shadow: var(--shadow-neon); transform: translateY(0);}
  50% { box-shadow: 0 0 32px #ff00e2, 0 0 18px #00ffd0; transform: translateY(-6px) scale(1.01);}
  100% { box-shadow: var(--shadow-neon-hover); transform: translateY(0);}
}
.main-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-success));
  filter: blur(.7px);
  animation: shimmer 1.7s infinite linear;
}
@keyframes shimmer { 0% {transform:translateX(-100%);} 100% {transform:translateX(100%);} }
.header {
  text-align: center;
  padding: 18px 8px 14px;
  background: linear-gradient(135deg,var(--bg-secondary) 0%,var(--bg-card) 100%);
  border-bottom: 1px solid var(--border-color);
  position: relative;
  z-index: 2;
  animation: fadeInHeader 1.2s cubic-bezier(.57,1.54,.51,.9);
}
@keyframes fadeInHeader { from {opacity:0; transform:scale(.93);} to {opacity:1; transform:scale(1);} }
.logo {
  width: 36px;
  height: 36px;
  margin: 0 auto 9px;
  border-radius: 50%;
  background: linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 15px #00ffd0, 0 0 12px #ff00e2;
  animation: logoGlow 2.2s ease-in-out infinite alternate;
}
@keyframes logoGlow {
  from { box-shadow: 0 0 10px #00ffd0, 0 0 8px #ff00e2;}
  to { box-shadow: 0 0 20px #ff00e2, 0 0 16px #00ffd0;}
}
.logo img {
  width: 23px; height: 23px; border-radius: 50%;
  animation: spinlogo 9s linear infinite;
}
@keyframes spinlogo { 100% { transform: rotate(360deg); } }
h1 {
  font-family: var(--font-primary);
  font-size: 11px; font-weight: 900;
  background: linear-gradient(119deg,var(--accent-primary),var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 4px;
  letter-spacing: 1.3px;
  text-shadow: 0 0 4px #ff00e2,0 0 2px #00ffd0;
  animation: bounceTitle 2s infinite alternate;
}
@keyframes bounceTitle { 0% {transform:scale(1);} 60% {transform:scale(1.14) rotate(-2deg);} 100% {transform:scale(1);} }
.subtitle {
  color: var(--text-secondary);
  font-size: 8.5px;
  font-weight: 500;
  letter-spacing: .6px;
  animation: fadeInHeader 1.8s;
}
.content{padding:12px;}
.progress-bar {
  background: var(--bg-secondary);
  height: 5px;
  border-radius: 2.5px;
  margin-bottom: 13px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 8px #00ffd0;
}
.progress-fill {
  background: repeating-linear-gradient(90deg,var(--accent-primary),var(--accent-secondary) 60%,var(--accent-success));
  height: 100%;
  border-radius: 2.5px;
  transition: width 0.5s cubic-bezier(.47,1.64,.41,.91);
  box-shadow: 0 0 8px #00ffd0;
  position: relative;
  animation: flicker 2s infinite alternate;
}
@keyframes flicker { 0%{opacity:.96;} 60%{opacity:1;} 100%{opacity:.94;} }
.progress-fill::after {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg,transparent,rgba(255,255,255,0.22),transparent);
  animation: progressShimmer 1.7s infinite;
}
@keyframes progressShimmer { 0% {transform:translateX(-100%);} 100% {transform:translateX(100%);} }
.step {
  display: none;
  animation: fadeInUp 0.6s cubic-bezier(.57,1.54,.51,.9);
}
.step.active { display: block; }
@keyframes fadeInUp { from{opacity:0;transform:translateY(18px);} to{opacity:1;transform:translateY(0);} }
.step-header {
  text-align: center;
  margin-bottom: 11px;
}
.step-number {
  display: inline-flex;
  align-items: center; justify-content: center;
  width: 21px; height: 21px;
  background: linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));
  border-radius: 50%;
  font-family: var(--font-primary);
  font-weight: 700; font-size: 9px;
  margin-bottom: 7px;
  box-shadow: 0 0 6px #00ffd0;
  border: 1.5px solid var(--bg-card);
}
.step-title {
  font-family: var(--font-primary);
  font-size: 10px; font-weight: 700;
  color: var(--accent-primary);
  margin-bottom: 2px;
  letter-spacing: .7px;
  text-shadow: 0 0 2px #ff00e2;
}
.step-description {
  color: var(--text-secondary);
  font-size: 8px; line-height: 1.2;
  margin-bottom: 2px;
  text-shadow: 0 0 1px #00ffd0;
}
.form-group { margin-bottom: 12px;}
.form-label {
  display: block;
  color: var(--accent-secondary);
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 8.8px;
  letter-spacing: .5px;
}
.input-group { position: relative;}
.input-field {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: 8px 15px 8px 10px;
  color: var(--text-primary);
  font-size: 9.5px;
  font-family: inherit;
  transition: var(--transition);
  outline: none;
  box-shadow: 0 0 4px #00ffd0;
}
.input-field:focus {
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 2px rgba(0,255,208,0.13);
}
.input-field::placeholder { color: var(--text-muted);}
.input-icon {
  position: absolute; right: 7px; top: 50%; transform: translateY(-50%);
  color: var(--accent-primary); font-size: 13px;
}
.btn {
  background: linear-gradient(135deg,var(--accent-primary),var(--accent-secondary));
  color: var(--text-primary);
  border: none;
  border-radius: var(--radius);
  padding: 9px 10px;
  font-family: var(--font-primary);
  font-weight: 600;
  font-size: 9.8px;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: .8px;
  box-shadow: 0 0 6px #00ffd0;
  width: 100%;
  display: flex; align-items: center; justify-content: center; gap: 4.5px;
  animation: pulse 2.2s infinite cubic-bezier(.8,1.2,.7,1.3);
}
.btn:hover { transform: scale(1.03); box-shadow: var(--shadow-neon-hover);}
.btn:disabled { opacity: .47; cursor: not-allowed; transform: none;}
.btn-secondary {
  background: var(--bg-secondary);
  border: 1.2px solid var(--border-color);
  color: var(--text-secondary);
  box-shadow: none;
}
.btn-secondary:hover { background: var(--bg-card-hover); color: var(--text-primary);}
.notification {
  padding: 9px 10px;
  border-radius: var(--radius);
  margin-bottom: 9px;
  border-left: 3px solid;
  background: var(--bg-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
  animation: slideInRight 0.4s cubic-bezier(.57,1.54,.51,.9);
  font-size: 9.4px;
}
@keyframes slideInRight { from{opacity:0;transform:translateX(18px);} to{opacity:1;transform:translateX(0);} }
.notification.success { border-color: var(--accent-success); background:rgba(0,255,174,0.14);}
.notification.error { border-color: var(--accent-error); background:rgba(255,53,105,0.13);}
.notification.warning { border-color: var(--accent-warning); background:rgba(255,217,0,0.11);}
.notification.info { border-color: var(--accent-primary); background:rgba(0,255,208,0.11);}
.loading-spinner {
  width: 13px; height: 13px;
  border: 2.5px solid var(--bg-secondary);
  border-top: 2.5px solid var(--accent-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { 100%{ transform:rotate(360deg);}
}
.contract-address {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: 9px 4px 9px 9px;
  margin: 8px 0; display: flex;
  align-items: center; justify-content: space-between; gap: 10px;
}
.contract-text {
  font-family: 'Courier New', monospace;
  font-size: 8.9px;
  color: var(--accent-primary);
  word-break: break-all;
  flex: 1;
  text-shadow: 0 0 3px #00ffd0;
}
.copy-btn {
  background: var(--accent-primary);
  color: var(--bg-primary);
  border: none;
  border-radius: 5px;
  padding: 4px 7px;
  cursor: pointer;
  transition: var(--transition);
  font-size: 8.4px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: .3px;
}
.copy-btn:hover { background: var(--accent-secondary); transform: scale(1.08);}
.balance-display {
  background: linear-gradient(135deg,var(--bg-secondary),var(--bg-card));
  border: 1.2px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 13px;
  text-align: center;
  margin: 9px 0;
  position: relative;
  overflow: hidden;
  font-size: 9.7px;
  box-shadow: 0 0 6px #ff00e2;
  animation: fadeInUp 1.2s;
}
.balance-display::before {
  content: '';
  position: absolute; top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg,transparent,rgba(0,255,208,0.11),transparent);
  animation: scan 3s infinite;
}
@keyframes scan { 0% { left: -100%;} 100% {left:100%;}}
.balance-label {
  color: var(--text-secondary);
  font-size: 8.4px;
  margin-bottom: 3px;
  text-transform: uppercase;
  letter-spacing: .6px;
}
.balance-amount {
  font-family: var(--font-primary);
  font-size: 13px; font-weight: 800;
  background: linear-gradient(135deg,var(--accent-primary),var(--accent-success));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 2.5px;
  text-shadow: 0 0 3px #ff00e2;
}
.balance-currency { color: var(--text-muted); font-size: 9.4px; font-weight: 600;}
.step-buttons { display: flex; gap: 7px; margin-top: 14px; }
.step-buttons .btn { flex: 1; }
.pulse { animation: pulse 1.8s infinite cubic-bezier(.8,1.2,.7,1.3);}
@keyframes pulse {
  0% { transform: scale(1); opacity: 1;}
  50% { transform: scale(1.05); opacity: .74;}
  100% { transform: scale(1); opacity: 1;}
}
.success-animation {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 17px 6px;
  text-align: center;
  animation: fadeInUp 1.4s cubic-bezier(.57,1.54,.51,.9);
}
.success-icon {
  width: 35px; height: 35px;
  border-radius: 50%;
  background: linear-gradient(135deg,var(--accent-success),var(--accent-primary));
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 7px;
  animation: successPop 0.7s cubic-bezier(.68,-.55,.265,1.55);
  box-shadow: 0 0 16px #00ffd0,0 0 13px #ff00e2;
}
@keyframes successPop { 0% {transform:scale(0) rotate(-180deg);} 100%{transform:scale(1) rotate(0deg);} }
.success-icon .material-icons { font-size: 19px; color: var(--text-primary);}
.countdown {
  background: var(--bg-secondary);
  border-radius: var(--radius);
  padding: 8px;
  text-align: center;
  margin: 9px 0;
  border: 1.2px solid var(--border-color);
  font-size: 9.5px;
  box-shadow: 0 0 8px #00ffd0;
}
.countdown-timer {
  font-family: var(--font-primary);
  font-size: 12px; color: var(--accent-warning); font-weight: 700;
  text-shadow: 0 0 3px #ffd900;
}
.countdown-label {
  color: var(--text-secondary);
  font-size: 7.5px;
  margin-top: 2.2px;
  text-transform: uppercase;
  letter-spacing: .6px;
}
@media (max-width: 480px) {
  :root {font-size: 9px;}
  .container {padding: 2.5vw;}
  .header {padding: 9px 3px 6px;}
  h1 {font-size: 9.4px;}
  .content {padding: 4px;}
  .step-buttons {flex-direction: column;}
  .balance-amount {font-size: 10px;}
}
@media (max-width: 340px) {
  :root {font-size: 7.5px;}
  .container {max-width: 97vw;}
}
  </style>
</head>
<body>
  <div class="container">
    <div class="main-card">
      <div class="header">
        <div class="logo">
          <img src="https://i.imgur.com/ODP45iQ.png" alt="NFTFAN Logo" />
        </div>
        <h1>$NFTFAN PURCHASE PORTAL</h1>
        <p class="subtitle">Professional Token Acquisition Platform</p>
      </div>
      <div class="content">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>
        <div id="notifications"></div>
        <!-- Step 1: Welcome & Overview -->
        <div class="step active" id="step1">
          <div class="step-header">
            <div class="step-number neon-glow">1</div>
            <h2 class="step-title">Welcome to $NFTFAN</h2>
            <p class="step-description">Start your journey to acquire $NFTFAN tokens through our secure automated system.</p>
          </div>
          <div class="notification info pulse">
            <span class="material-icons">info</span>
            <div>
              <strong>Important:</strong> This process auto-distributes $NFTFAN tokens after payment.
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn" onclick="nextStep()">
              <span class="material-icons">rocket_launch</span>
              Start
            </button>
          </div>
        </div>
        <!-- Step 2: Wallet Address -->
        <div class="step" id="step2">
          <div class="step-header">
            <div class="step-number neon-glow">2</div>
            <h2 class="step-title">Enter Wallet Address</h2>
            <p class="step-description">Provide your Polygon (EVM) wallet address.</p>
          </div>
          <div class="form-group">
            <label class="form-label">Polygon Wallet Address</label>
            <div class="input-group">
              <input 
                type="text" 
                class="input-field" 
                id="walletAddress" 
                placeholder="0x..." 
                maxlength="42"
                autocomplete="off"
              />
              <span class="input-icon material-icons">account_balance_wallet</span>
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="validateWallet()">
              <span class="material-icons">check_circle</span>
              Validate
            </button>
          </div>
        </div>
        <!-- Step 3: Purchase Amount -->
        <div class="step" id="step3">
          <div class="step-header">
            <div class="step-number neon-glow">3</div>
            <h2 class="step-title">Select Purchase Amount</h2>
            <p class="step-description">Choose how much $POL (MATIC) you want to spend.</p>
          </div>
          <div class="form-group">
            <label class="form-label">Amount in $POL (MATIC)</label>
            <div class="input-group">
              <input 
                type="number" 
                class="input-field" 
                id="purchaseAmount" 
                placeholder="1.5" 
                min="0.01" 
                max="100" 
                step="0.01"
              />
              <span class="input-icon material-icons">payments</span>
            </div>
          </div>
          <div class="notification warning flicker">
            <span class="material-icons">warning</span>
            <div>
              <strong>Range:</strong> Min 0.01 - Max 100 $POL
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="validateAmount()">
              <span class="material-icons">calculate</span>
              Confirm
            </button>
          </div>
        </div>
        <!-- Step 4: Payment Instructions -->
        <div class="step" id="step4">
          <div class="step-header">
            <div class="step-number neon-glow">4</div>
            <h2 class="step-title">Send Payment</h2>
            <p class="step-description">Send the exact amount to our contract address below.</p>
          </div>
          <div class="contract-address rainbow-flicker">
            <div class="contract-text" id="contractAddress">0xaf2d132C8773bca3821C24EcF64e844E202A12e8</div>
            <button class="copy-btn" onclick="copyContract()">
              <span class="material-icons">content_copy</span>
              Copy
            </button>
          </div>
          <div class="notification info">
            <span class="material-icons">account_balance</span>
            <div>
              <strong>Send exactly:</strong> <span id="exactAmount">0</span> $POL<br>
              <strong>From:</strong> <span id="displayWallet">Your wallet</span>
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="previousStep()">
              <span class="material-icons">arrow_back</span>
              Back
            </button>
            <button class="btn" onclick="confirmPayment()">
              <span class="material-icons">send</span>
              I've Sent
            </button>
          </div>
        </div>
        <!-- Step 5: Processing -->
        <div class="step" id="step5">
          <div class="step-header">
            <div class="step-number neon-glow">5</div>
            <h2 class="step-title">Processing</h2>
            <p class="step-description">Please wait while we confirm your payment.</p>
          </div>
          <div class="countdown">
            <div class="countdown-timer" id="countdownTimer">10</div>
            <div class="countdown-label">Seconds left</div>
          </div>
          <div class="notification info">
            <div class="loading-spinner"></div>
            <div>
              <strong>Processing...</strong> Checking blockchain. Please wait.
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn btn-secondary" onclick="checkStatus()" id="checkStatusBtn" disabled>
              <span class="material-icons">refresh</span>
              Check
            </button>
          </div>
        </div>
        <!-- Step 6: Success & Balance -->
        <div class="step" id="step6">
          <div class="step-header">
            <div class="step-number neon-glow">6</div>
            <h2 class="step-title">Done!</h2>
            <p class="step-description">Your $NFTFAN tokens are now in your wallet.</p>
          </div>
          <div class="success-animation">
            <div class="success-icon">
              <span class="material-icons">check</span>
            </div>
          </div>
          <div class="balance-display rainbow-flicker">
            <div class="balance-label">Your $NFTFAN Balance</div>
            <div class="balance-amount" id="finalBalance">0</div>
            <div class="balance-currency">$NFTFAN</div>
          </div>
          <div class="notification success flicker">
            <span class="material-icons">celebration</span>
            <div>
              <strong>Success!</strong> Tokens are in your wallet. 🎉
            </div>
          </div>
          <div class="step-buttons">
            <button class="btn" onclick="buyMore()">
              <span class="material-icons">add_shopping_cart</span>
              More!
            </button>
            <button class="btn btn-secondary" onclick="viewOnExplorer()">
              <span class="material-icons">open_in_new</span>
              Explorer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Fun animated background bubbles
    for(let i=0;i<16;i++){
      let b=document.createElement('div');
      b.style.position='fixed';
      b.style.zIndex='0';
      b.style.borderRadius='50%';
      b.style.opacity=0.14+Math.random()*0.15;
      b.style.background='radial-gradient(circle,rgba(255,0,226,.28),rgba(0,255,208,.19),transparent 90%)';
      b.style.width=b.style.height=(12+Math.random()*60)+'px';
      b.style.left=(Math.random()*100)+'vw';
      b.style.top=(Math.random()*100)+'vh';
      b.style.pointerEvents='none';
      b.style.transition='2.7s cubic-bezier(.31,1.2,.7,1.2)';
      document.body.appendChild(b);
      setInterval(()=>{
        b.style.left=(Math.random()*100)+'vw';
        b.style.top=(Math.random()*100)+'vh';
      },(2500+Math.random()*8000));
    }

    // Neon flicker class
    const style = document.createElement('style');
    style.innerHTML = `
      .neon-glow {text-shadow:0 0 8px #ff00e2,0 0 7px #00ffd0,0 0 4px #fff;}
      .rainbow-flicker {animation: rainbowflicker 2.5s infinite alternate;}
      @keyframes rainbowflicker {
        0%{box-shadow:0 0 7px #ff00e2;}
        17%{box-shadow:0 0 12px #00ffd0;}
        38%{box-shadow:0 0 8px #ffd900;}
        53%{box-shadow:0 0 14px #00ffae;}
        80%{box-shadow:0 0 13px #00ffd0;}
        100%{box-shadow:0 0 10px #ff00e2;}
      }
      .flicker {animation: flickerAnim .23s infinite alternate;}
      @keyframes flickerAnim{
        0%{opacity:1;}
        45%{opacity:.7;}
        100%{opacity:1;}
      }
    `;
    document.head.appendChild(style);

    // Configuration
    const CONFIG = {
      tokenAddress: "0x2017Fcaea540d2925430586DC92818035Bfc2F50",
      apiKey: "3AFN3ZU4ANK3XEUJQ6BRJCBCITAFHKFVTV",
      airdropContract: "0xaf2d132C8773bca3821C24EcF64e844E202A12e8"
    };

    // State management
    let currentStep = 1;
    let userWallet = '';
    let purchaseAmount = 0;
    let processingTimer = null;
    let countdownTimer = null;

    // Utility functions
    function validateEthAddress(addr) {
      return /^0x[a-fA-F0-9]{40}$/.test(addr);
    }

    function formatNumber(num) {
      return new Intl.NumberFormat().format(num);
    }

    function showNotification(type, message, duration = 2400) {
      const notifications = document.getElementById('notifications');
      const notification = document.createElement('div');
      notification.className = `notification ${type} flicker`;
      const icon = type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
      notification.innerHTML = `<span class="material-icons">${icon}</span><div>${message}</div>`;
      notifications.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.4s cubic-bezier(.57,1.54,.51,.9) forwards';
        setTimeout(() => notification.remove(), 410);
      }, duration);
    }

    function updateProgress() {
      const progress = (currentStep / 6) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
    }
    function showStep(stepNumber) {
      document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
      document.getElementById(`step${stepNumber}`).classList.add('active');
      currentStep = stepNumber;
      updateProgress();
      // Fun: shake the card a bit
      document.querySelector('.main-card').animate([
        {transform:'scale(1.02) rotate(-1deg)'},{transform:'scale(1) rotate(0deg)'}
      ],{duration:260,fill:'forwards'});
    }
    function nextStep() {if (currentStep < 6) showStep(currentStep + 1);}
    function previousStep() {if (currentStep > 1) showStep(currentStep - 1);}
    // Step-specific
    function validateWallet() {
      const wallet = document.getElementById('walletAddress').value.trim();
      if (!wallet) { showNotification('error', 'Enter a wallet address.'); return; }
      if (!validateEthAddress(wallet)) { showNotification('error', 'Invalid address! Needs to start with 0x and be 42 chars.'); return; }
      userWallet = wallet;
      showNotification('success', 'Wallet address is valid!');
      setTimeout(() => { nextStep(); }, 900);
    }
    function validateAmount() {
      const amount = parseFloat(document.getElementById('purchaseAmount').value);
      if (!amount || isNaN(amount)) { showNotification('error', 'Enter a valid amount.'); return; }
      if (amount < 0.01 || amount > 100) { showNotification('error', 'Amount: 0.01 - 100 $POL only!'); return; }
      purchaseAmount = amount;
      showNotification('success', `Amount: ${amount} $POL`);
      document.getElementById('exactAmount').textContent = amount;
      document.getElementById('displayWallet').textContent = `${userWallet.substring(0, 5)}...${userWallet.substring(userWallet.length - 4)}`;
      setTimeout(() => { nextStep(); }, 900);
    }
    function copyContract() {
      const contractAddress = document.getElementById('contractAddress').textContent;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(contractAddress).then(() => {
          showNotification('success', 'Contract copied! 🚀');
        });
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = contractAddress; document.body.appendChild(textarea);
        textarea.select(); document.execCommand('copy');
        document.body.removeChild(textarea);
        showNotification('success', 'Copied!');
      }
    }
    function confirmPayment() {
      showNotification('info', 'Got your confirm. Processing...');
      setTimeout(() => {
        nextStep();
        startProcessing();
      }, 900);
    }
    function startProcessing() {
      let countdown = 10;
      const countdownElement = document.getElementById('countdownTimer');
      const checkStatusBtn = document.getElementById('checkStatusBtn');
      countdownTimer = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        if (countdown <= 0) {
          clearInterval(countdownTimer);
          checkStatusBtn.disabled = false;
          checkStatusBtn.textContent = 'Ready!';
          setTimeout(() => { completeTransaction(); }, 1000);
        }
      }, 1000);
    }
    async function completeTransaction() {
      showNotification('success', 'Transaction processed!');
      await fetchBalance();
      setTimeout(() => { nextStep(); }, 1300);
    }
    async function fetchBalance() {
      try {
        const url = `https://api.polygonscan.com/api?module=account&action=tokenbalance&contractaddress=${CONFIG.tokenAddress}&address=${userWallet}&tag=latest&apikey=${CONFIG.apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        if (data.status === "1") {
          const decimals = 18;
          const balance = Number(data.result) / 10 ** decimals;
          document.getElementById('finalBalance').textContent = formatNumber(Math.floor(balance));
        } else {
          document.getElementById('finalBalance').textContent = 'Error';
        }
      } catch (error) {
        document.getElementById('finalBalance').textContent = 'Error';
      }
    }
    function checkStatus() {
      showNotification('info', 'Checking...');
      setTimeout(() => { completeTransaction(); }, 1000);
    }
    function buyMore() {
      userWallet = '';
      purchaseAmount = 0;
      document.getElementById('walletAddress').value = '';
      document.getElementById('purchaseAmount').value = '';
      showStep(2);
      showNotification('info', 'New purchase process!');
    }
    function viewOnExplorer() {
      window.open(`https://polygonscan.com/address/${userWallet}`, '_blank');
    }
    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
      document.getElementById('walletAddress').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') validateWallet();
      });
      document.getElementById('purchaseAmount').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') validateAmount();
      });
      showNotification('info', 'Welcome to $NFTFAN Portal! 🚀', 1600);
      // Fun: random confetti when step 6 is shown
      const observer = new MutationObserver(function(){
        if(document.getElementById('step6').classList.contains('active')){
          for(let i=0;i<25;i++){
            let c=document.createElement('div');
            c.style.position='fixed';
            c.style.zIndex='12';
            c.style.left=(10+Math.random()*80)+'vw';
            c.style.top='-8px';
            c.style.width=c.style.height=(3+Math.random()*3)+'px';
            c.style.borderRadius='50%';
            c.style.background=`hsl(${Math.random()*360},100%,60%)`;
            c.style.opacity=.8+Math.random()*0.2;
            c.style.transition='top 1.2s cubic-bezier(.57,1.54,.51,.9),opacity .4s';
            document.body.appendChild(c);
            setTimeout(()=>{c.style.top=(35+Math.random()*60)+'vh';c.style.opacity=0;},20);
            setTimeout(()=>{c.remove();},1400+Math.random()*500);
          }
        }
      });
      observer.observe(document.getElementById('step6'),{attributes:true});
    });
    window.addEventListener('beforeunload', function() {
      if (processingTimer) clearInterval(processingTimer);
      if (countdownTimer) clearInterval(countdownTimer);
    });
  </script>
</body>
</html>
