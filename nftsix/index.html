<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NFT FANS 2026 // NETRUNNER</title>
  <style>
    :root {
      --cyber-yellow: #fcee0a;
      --cyber-cyan: #00f0ff;
      --cyber-red: #ff003c;
      --bg: #050505;
      --panel: #111;
      --border: #333;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background-color: var(--bg);
      background-image:
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 2px, 3px 100%;
      color: var(--cyber-yellow);
      min-height: 100vh;
      padding: 10px;
      font-size: 10px;
      text-transform: uppercase;
      display: flex;
      justify-content: center;
    }
    .layout { width: 100%; max-width: 1000px; }
    header {
      display: flex; justify-content: space-between; align-items: flex-end;
      border-bottom: 1px solid var(--cyber-yellow);
      padding-bottom: 8px; margin-bottom: 10px;
      gap: 10px;
    }
    h1 {
      margin: 0; font-size: 10px; line-height: 1;
      text-shadow: 2px 0px var(--cyber-red);
      background: var(--cyber-yellow); color: black;
      padding: 2px 6px;
      display: inline-block;
      clip-path: polygon(0 0, 100% 0, 95% 100%, 0% 100%);
    }
    .status-bar { display: flex; gap: 8px; align-items: center; }
    .addr-display {
      font-size: 9px; color: var(--cyber-cyan);
      border: 1px solid var(--cyber-cyan);
      padding: 4px 8px;
      letter-spacing: 1px;
    }
    .btn {
      font-family: inherit; font-size: 10px; font-weight: 900;
      text-transform: uppercase;
      background: transparent; color: var(--cyber-yellow);
      border: 1px solid var(--cyber-yellow);
      padding: 6px 12px; cursor: pointer; position: relative;
      transition: all 0.1s;
      clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
    }
    .btn:hover:not(:disabled) { background: var(--cyber-yellow); color: black; box-shadow: 0 0 10px var(--cyber-yellow); }
    .btn:active:not(:disabled) { transform: translate(1px, 1px); }
    .btn:disabled { opacity: 0.3; cursor: not-allowed; border-color: #555; color: #555; }
    .btn-mint {
      background: var(--cyber-cyan); color: black; border: none;
      width: 100%; margin-top: 8px; padding: 8px;
    }
    .btn-mint:hover:not(:disabled) { background: white; box-shadow: 0 0 15px var(--cyber-cyan); }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }
    .card {
      background: var(--panel);
      border: 1px solid #333;
      padding: 6px;
      position: relative;
    }
    .card::before {
      content: ""; position: absolute; top: -1px; left: -1px;
      width: 10px; height: 10px;
      border-top: 2px solid var(--cyber-yellow);
      border-left: 2px solid var(--cyber-yellow);
    }
    .card::after {
      content: ""; position: absolute; bottom: -1px; right: -1px;
      width: 10px; height: 10px;
      border-bottom: 2px solid var(--cyber-yellow);
      border-right: 2px solid var(--cyber-yellow);
    }
    .frame {
      width: 100%; aspect-ratio: 1 / 1; background: #000;
      border: 1px solid #222; display: flex; align-items: center; justify-content: center;
      margin-bottom: 6px; position: relative;
    }
    .frame img { width: 100%; height: 100%; object-fit: contain; }
    .frame::after {
      content: "IMG_DATA_LOADED";
      position: absolute; bottom: 2px; right: 2px;
      font-size: 8px; color: rgba(255,255,255,0.3);
      background: rgba(0,0,0,0.7); padding: 0 2px;
    }
    .info-row {
      display: flex; justify-content: space-between; align-items: center;
      border-left: 2px solid var(--cyber-cyan);
      padding-left: 6px; margin-bottom: 4px;
    }
    .title {
      font-weight: bold; color: white;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      max-width: 100px;
    }
    .price { color: var(--cyber-cyan); }
    .status { margin-bottom: 10px; color: var(--cyber-cyan); border-left: 2px solid var(--cyber-cyan); padding-left: 8px; }
    .status.err { color: var(--cyber-red); border-color: var(--cyber-red); }
    .controls { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
    .select {
      background: #0b0b0b; color: var(--cyber-cyan);
      border: 1px solid var(--cyber-cyan);
      padding: 6px 8px; font-size: 10px; text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="layout">
    <header>
      <div style="display:flex; flex-direction:column; gap:4px;">
        <h1>NFT FANS 2026</h1>
        <div style="font-size:9px; color:#555;">// POLYGON MAINNET [137]</div>
      </div>
      <div class="status-bar">
        <div id="addr" class="addr-display">DISCONNECTED</div>
        <button id="connectBtn" class="btn">LINK START</button>
      </div>
    </header>

    <div class="controls">
      <div style="color:var(--cyber-yellow); font-weight:700;">SORT</div>
      <select id="sortSelect" class="select">
        <option value="date_desc">DATE ↓</option>
        <option value="date_asc">DATE ↑</option>
        <option value="price_desc">PRICE ↓</option>
        <option value="price_asc">PRICE ↑</option>
      </select>
    </div>

    <div id="status" class="status">SYSTEM READY...</div>
    <div id="grid" class="grid"></div>
  </div>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <script>
    /* --- CONFIG --- */
    const firebaseConfig = {
      apiKey: "AIzaSyBuBB-Cha7eLG1O7SxOTfFt8e6hVAWjkxI",
      authDomain: "tokentransfer-4a9b3.firebaseapp.com",
      databaseURL: "https://tokentransfer-4a9b3-default-rtdb.firebaseio.com",
      projectId: "tokentransfer-4a9b3",
      storageBucket: "tokentransfer-4a9b3.firebasestorage.app",
      messagingSenderId: "205455490321",
      appId: "1:205455490321:web:9919f5dde059316c9320b0",
      measurementId: "G-Y6CVEDL9XH"
    };

    const CONTRACT_ADDRESS = "0x2585Ba6e04973e9b4675f6dc9e31b67539fb5678";
    const EXPECTED_CHAIN_ID = 137;
    const ABI = [
      "function mint(string tokenURI, uint256 priceWei) payable",
      "function totalMinted() view returns (uint256)"
    ];

    /* --- LOGIC --- */
    let provider, signer, contract, userAddress;
    const db = firebase.initializeApp(firebaseConfig).database();

    const gridEl = document.getElementById('grid');
    const statusEl = document.getElementById('status');
    const addrEl = document.getElementById('addr');
    const connectBtn = document.getElementById('connectBtn');
    const sortSelect = document.getElementById('sortSelect');
    let currentEntries = [];

    function setStatus(msg, cls = "") {
      statusEl.className = `status ${cls}`;
      statusEl.textContent = `>> ${msg.toUpperCase()}`;
    }
    function shorten(addr) {
      return addr ? addr.slice(0, 6) + "..." + addr.slice(-4) : "DISCONNECTED";
    }

    async function ensureWallet() {
      if (!window.ethereum) {
        setStatus("NO WEB3 INTERFACE FOUND", "err");
        throw new Error("No wallet");
      }
      provider = new ethers.BrowserProvider(window.ethereum, "any");
      const network = await provider.getNetwork();
      if (Number(network.chainId) !== EXPECTED_CHAIN_ID) {
        setStatus(`NET_ERR: SWITCH TO POLYGON [137]`, "err");
        throw new Error("Wrong network");
      }
      const accounts = await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      userAddress = accounts[0];
      addrEl.textContent = shorten(userAddress);
      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
    }

    connectBtn.addEventListener('click', async () => {
      connectBtn.disabled = true;
      setStatus("INITIALIZING UPLINK...");
      try {
        await ensureWallet();
        setStatus("CONNECTION ESTABLISHED", "ok");
        connectBtn.textContent = "CONNECTED";
      } catch (e) {
        console.error(e);
      } finally {
        connectBtn.disabled = false;
      }
    });

    async function mint(tokenURI, pricePol) {
      if (!tokenURI) return setStatus("ERR: NULL URI DATA", "err");
      if (!pricePol) return setStatus("ERR: PRICE MISSING", "err");
      let priceWei;
      try { priceWei = ethers.parseEther(pricePol.toString()); }
      catch { return setStatus("ERR: BAD PRICE FORMAT", "err"); }
      setStatus("AWAITING BIO-SIG (WALLET)...");
      try {
        await ensureWallet();
        const tx = await contract.mint(tokenURI, priceWei, { value: priceWei });
        setStatus("TX PENDING... STANDBY");
        await tx.wait();
        setStatus("MINT CONFIRMED. ASSET SECURED.", "ok");
      } catch (err) {
        console.error(err);
        setStatus("TX FAILED / REJECTED", "err");
      }
    }

    function renderCard(id, data) {
      const card = document.createElement('div');
      card.className = 'card';

      const frame = document.createElement('div');
      frame.className = 'frame';
      const img = document.createElement('img');
      img.src = data.imageUrl || '';
      img.alt = 'ASSET';
      frame.appendChild(img);
      card.appendChild(frame);

      const info = document.createElement('div');
      info.className = 'info-row';
      
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = (data.title || 'UNKNOWN').toUpperCase();
      info.appendChild(title);

      const price = document.createElement('div');
      price.className = 'price';
      const displayPrice = data.price ? `${data.price} POL` : "? POL";
      price.textContent = displayPrice;
      info.appendChild(price);

      card.appendChild(info);

      const btn = document.createElement('button');
      btn.className = 'btn btn-mint';
      btn.textContent = 'MINT ASSET';
      btn.onclick = () => mint(data.imageUrl || "", data.price);
      card.appendChild(btn);

      return card;
    }

    function sortEntries(entries, mode) {
      return entries.slice().sort((a, b) => {
        const da = a[1].createdAt || 0;
        const db = b[1].createdAt || 0;
        const pa = parseFloat(a[1].price || "0");
        const pb = parseFloat(b[1].price || "0");
        switch (mode) {
          case "date_asc": return da - db;
          case "price_desc": return pb - pa;
          case "price_asc": return pa - pb;
          case "date_desc":
          default: return db - da;
        }
      });
    }

    function renderList() {
      gridEl.innerHTML = "";
      const mode = sortSelect.value;
      const sorted = sortEntries(currentEntries, mode);
      sorted.forEach(([id, data]) => gridEl.appendChild(renderCard(id, data)));
      setStatus(`DB SYNC COMPLETE: ${sorted.length} RECORDS`, "ok");
    }

    sortSelect.addEventListener('change', renderList);

    db.ref("nfts").orderByChild("createdAt").on("value", (snapshot) => {
      const val = snapshot.val();
      if (!val) {
        currentEntries = [];
        gridEl.innerHTML = "";
        setStatus("DATABASE EMPTY", "");
        return;
      }
      currentEntries = Object.entries(val);
      renderList();
    }, (err) => {
      console.error(err);
      setStatus("DB READ ERROR", "err");
    });
  </script>
</body>
</html>
