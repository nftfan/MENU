<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Fans Token Wallets Extractor & Airdrop</title>
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #4c1d95;
            --accent: #00e6e6;
            --bg: #18181b;
            --card: #23232b;
            --border: #312e81;
            --error: #e94560;
            --success: #22c55e;
            --pending: #fbbf24;
            --info: #38bdf8;
            --radius: 12px;
            --shadow: 0 6px 30px rgba(0,0,0,0.30);
        }
        html, body {
            padding: 0;
            margin: 0;
            background: var(--bg);
            color: #fff;
            font-family: 'Inter', Arial, sans-serif;
            min-height: 100vh;
            font-size: 10px;
            -webkit-text-size-adjust: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            width: 100vw;
            padding: 0;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        .container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            padding: 18px 2vw 24px 2vw;
            box-sizing: border-box;
            background: var(--card);
            border-radius: var(--radius);
            margin-top: 18px;
            box-shadow: var(--shadow);
            animation: float-in 0.7s cubic-bezier(.62,-0.29,.41,1.45);
        }
        @keyframes float-in {
            0% { opacity: 0; transform: translateY(40px) scale(0.95);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        h2, h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1.6em;
            font-weight: 800;
            letter-spacing: 0.01em;
        }
        h3 {
            font-size: 1.15em;
            color: var(--accent);
            margin-top: 18px;
        }
        .wallet-stats {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.08em;
            display: flex;
            justify-content: center;
            gap: 18px;
            flex-wrap: wrap;
        }
        .wallet-stats span {
            font-weight: 600;
            background: #1c1c22;
            border-radius: 7px;
            padding: 4px 10px;
            color: var(--accent);
            font-size: 1em;
            min-width: 70px;
            display: inline-block;
        }
        p {
            text-align: center;
            color: #bdbdbd;
            margin-bottom: 14px;
            font-size: 1em;
            line-height: 1.5em;
        }
        textarea {
            width: 100%;
            height: 84px;
            background: #191920;
            border: 1px solid var(--border);
            color: #fff;
            padding: 8px;
            font-size: 1em;
            border-radius: 7px;
            resize: none;
            margin-bottom: 6px;
            font-family: inherit;
            transition: border 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 12px rgba(70,0,150,0.06);
        }
        textarea:focus {
            outline: none;
            border: 1.5px solid var(--primary);
            box-shadow: 0 0 0 2px var(--primary-dark);
        }
        .btn {
            width: 100%;
            background: linear-gradient(90deg,var(--primary),var(--accent) 85%);
            color: #fff;
            border: none;
            padding: 13px 0;
            margin: 7px 0 0 0;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 0.03em;
            box-shadow: 0 2px 10px rgba(63,0,120,0.13);
            transition: background 0.18s, transform 0.16s, box-shadow 0.2s;
            outline: none;
            position: relative;
        }
        .btn:active { transform: scale(0.97);}
        .btn[disabled] { opacity: 0.5; cursor: not-allowed;}
        /* Animation for buttons */
        .btn.animated {
            box-shadow: 0 0 0 4px var(--accent);
            animation: pulseBtn 0.6s 2;
        }
        @keyframes pulseBtn {
            0% { box-shadow: 0 0 0 0 var(--accent);}
            60% { box-shadow: 0 0 0 14px rgba(0,230,230,0.18);}
            100% { box-shadow: 0 0 0 0 var(--accent);}
        }
        .wallet-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
            max-height: 122px;
            overflow-y: auto;
        }
        .wallet-list li {
            background: #1c1c22;
            margin: 3px 0;
            padding: 7px 8px;
            border-radius: 5px;
            font-size: 0.95em;
            color: #a3e3f3;
            font-family: 'JetBrains Mono', monospace;
            animation: wallet-list-fadein 0.45s;
        }
        @keyframes wallet-list-fadein {
            0% { opacity: 0; transform: translateY(8px);}
            100% { opacity: 1; transform: none;}
        }
        .wallet-info {
            margin: 9px 0 0 0;
            font-size: 1.05em;
            color: var(--accent);
            text-align: center;
            word-break: break-all;
            font-weight: 600;
            letter-spacing: 0.03em;
        }
        .step-table {
            width: 100%;
            margin: 14px 0 0 0;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        .step-table th, .step-table td {
            padding: 7px 3px;
            text-align: center;
        }
        .step-table th {
            background: var(--primary);
            color: #fff;
            font-weight: 800;
            border-radius: 7px 7px 0 0;
            font-size: 1.08em;
            letter-spacing: 0.02em;
        }
        .step-table tr { background: transparent;}
        .step-table td {
            border-bottom: 1px solid #232352;
            font-size: 1em;
        }
        .status-pending { background: rgba(251,191,36,0.08);}
        .status-done { background: rgba(34,197,94,0.12);}
        .status-error { background: rgba(233,69,96,0.14);}
        .status-info { background: rgba(56,189,248,0.10);}
        .step-table tr:last-child td { border-bottom: none; }
        #notification {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            min-width: 220px;
            max-width: 90vw;
            background: #fff;
            color: #1a1a1b;
            border-radius: 8px;
            box-shadow: 0 6px 30px rgba(32,16,96,0.12);
            padding: 13px 18px;
            font-size: 1.05em;
            display: none;
            font-weight: 700;
            letter-spacing: 0.01em;
            animation: fadeInOut 3s forwards;
            border: 2.5px solid var(--primary);
        }
        #notification.done { border-color: var(--success);}
        #notification.error { border-color: var(--error);}
        #notification.pending { border-color: var(--pending);}
        #notification.info { border-color: var(--info);}
        @keyframes fadeInOut {
            0% { opacity: 0;}
            15% { opacity: 1;}
            85% { opacity: 1;}
            100% { opacity: 0;}
        }
        .slide-in {
            animation: slideIn .6s cubic-bezier(0.55, -0.12, 0.43, 1.5);
        }
        @keyframes slideIn {
            0% {opacity:0; transform:translateY(25px) scale(0.93);}
            100% {opacity:1; transform:none;}
        }
        /* Responsive */
        @media (max-width: 600px) {
            .container {
                max-width: 99vw;
                padding: 10px 1vw 10px 1vw;
            }
            .wallet-stats {
                gap: 7px;
                font-size: 0.97em;
            }
            .wallet-stats span {
                padding: 3px 6px;
                font-size: 0.98em;
                min-width: 56px;
            }
            .step-table th, .step-table td {
                padding: 4px 1px;
            }
            .wallet-list li { font-size: 0.92em;}
            textarea {
                font-size: 0.98em;
                padding: 6px;
            }
        }
    </style>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1002.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <div class="container slide-in">
        <h2>
            NFT Fans Token <span style="color:var(--accent);">Airdrop Tool</span>
        </h2>
        <div class="wallet-stats" id="walletStats" style="display:none;">
            <span id="totalWallets">Total: 0</span>
            <span id="doneWallets">Sent: 0</span>
            <span id="remainingWallets">Remain: 0</span>
        </div>
        <p>
            1. Copy all X (Twitter) airdrop post comments with wallets.<br>
            2. Paste below & tap <b>Extract Wallets</b>.<br>
            3. Connect your wallet (Polygon).<br>
            4. Tap <b>Distribute Tokens</b>!<br>
            <span style="color:var(--pending); font-weight:600;">* Use aggressive gas for best results.</span><br>
            <span style="color:var(--info);">Supports EVM addresses only (0x...)</span>
        </p>
        <textarea id="inputText" placeholder="Paste comments or text here..." inputmode="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
        <button class="btn" id="extractBtn" onclick="extractWallets()">Extract Wallets</button>
        <ul id="walletList" class="wallet-list"></ul>
        <h3>Airdrop Distribution</h3>
        <button class="btn" id="connectButton" onclick="connectMetamask()">CONNECT WALLET</button>
        <div id="walletAddress" class="wallet-info"></div>
        <button class="btn" id="distributeButton" style="display:none" onclick="distributeTokens()">DISTRIBUTE TOKENS</button>
        <button class="btn" id="nextButton" style="display:none" onclick="distributeNextTokens()">NEXT 50 WALLETS</button>
        <table class="step-table" id="notificationsTable">
            <thead>
                <tr>
                    <th>STEP</th>
                    <th>STATUS</th>
                </tr>
            </thead>
            <tbody id="notificationRows"></tbody>
        </table>
    </div>
    <div id="notification"></div>
    <script>
        const contractAddress = "0xdb82ac0c24Cd9D6C831e6Bd310e0c8BFa5670363";
        let web3;
        let contract;
        let userAccount;
        let extractedWallets = [];
        let currentBatchIndex = 0;
        const walletsPerBatch = 50;
        let walletsSent = 0;

        function updateWalletStats() {
            const walletStats = document.getElementById('walletStats');
            const total = extractedWallets.length;
            const sent = walletsSent;
            const remaining = total - sent;
            document.getElementById('totalWallets').textContent = "Total: " + total;
            document.getElementById('doneWallets').textContent = "Sent: " + sent;
            document.getElementById('remainingWallets').textContent = "Remain: " + remaining;
            walletStats.style.display = total > 0 ? '' : 'none';
        }

        // Extract wallets from text
        function extractWallets() {
            let text = document.getElementById("inputText").value;
            let regex = /0x[a-fA-F0-9]{40}/g;
            let matches = text.match(regex);
            let walletList = document.getElementById("walletList");
            walletList.innerHTML = "";
            if (matches) {
                extractedWallets = [...new Set(matches)];
                currentBatchIndex = 0;
                walletsSent = 0;
                updateWalletStats();
                extractedWallets.slice(0, walletsPerBatch).forEach(wallet => {
                    let li = document.createElement("li");
                    li.textContent = wallet;
                    li.dataset.wallet = wallet;
                    walletList.appendChild(li);
                });
                showNotification(`Extracted ${extractedWallets.length} wallet${extractedWallets.length > 1 ? 's':''}.`, "done");
                animateButton(document.getElementById('extractBtn'));
                setTimeout(() => {
                    animateButton(document.getElementById('distributeButton'));
                }, 600);
            } else {
                extractedWallets = [];
                walletsSent = 0;
                updateWalletStats();
                showNotification("No wallets found. Please check your input!", "error");
            }
        }

        // Animate button with custom class
        function animateButton(btn) {
            if (!btn) return;
            btn.classList.remove('animated');
            void btn.offsetWidth; // reflow for restart
            btn.classList.add('animated');
            setTimeout(() => btn.classList.remove('animated'), 1200);
        }

        // Connect to MetaMask and switch to Polygon
        async function connectMetamask() {
            showNotification("Connecting wallet...", "pending");
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    document.getElementById('walletAddress').innerText = `CONNECTED: ${userAccount}`;
                    document.getElementById('connectButton').style.display = 'none';
                    document.getElementById('distributeButton').style.display = '';
                    await switchToPolygon();
                    showNotification("Wallet connected! Ready to distribute tokens.", "done");
                    setupContract();
                } catch (err) {
                    showNotification("Connection denied!", "error");
                }
            } else {
                showNotification("Please install MetaMask!", "error");
            }
        }
        // Switch to Polygon network
        async function switchToPolygon() {
            if (!window.ethereum) return;
            const polygonChainId = "0x89";
            try {
                await window.ethereum.request({
                    method: "wallet_switchEthereumChain",
                    params: [{ chainId: polygonChainId }],
                });
                showNotification("Switched to Polygon network!", "done");
            } catch (switchError) {
                if (switchError.code === 4902 || (switchError.data && switchError.data.originalError && switchError.data.originalError.code === 4902)) {
                    try {
                        await window.ethereum.request({
                            method: "wallet_addEthereumChain",
                            params: [{
                                chainId: polygonChainId,
                                chainName: "Polygon Mainnet",
                                nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                                rpcUrls: ["https://polygon-rpc.com/"],
                                blockExplorerUrls: ["https://polygonscan.com/"]
                            }]
                        });
                        showNotification("Polygon network added!", "done");
                    } catch (addError) {
                        showNotification("Failed to add Polygon network.", "error");
                    }
                } else {
                    showNotification("Failed to switch to Polygon.", "error");
                }
            }
        }
        // Setup smart contract
        function setupContract() {
            const abi = [
                {
                    "inputs": [
                        {"internalType": "address", "name": "_tokenAddress", "type": "address"}
                    ], "stateMutability": "nonpayable", "type": "constructor"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {"indexed": true, "internalType": "address", "name": "recipient", "type": "address"},
                        {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "TokensDistributed",
                    "type": "event"
                },
                {
                    "inputs": [
                        {"internalType": "address[]", "name": "recipients", "type": "address[]"}
                    ],
                    "name": "distributeTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {"internalType": "uint256", "name": "amount", "type": "uint256"}
                    ],
                    "name": "withdrawTokens",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ];
            contract = new web3.eth.Contract(abi, contractAddress);
        }
        // Distribute tokens function
        async function distributeTokens() {
            if (!userAccount || !contract) {
                showNotification("Connect your wallet first!", "error");
                return;
            }
            const wallets = extractedWallets.slice(currentBatchIndex, currentBatchIndex + walletsPerBatch);
            if (wallets.length === 0) {
                showNotification("No wallets extracted.", "error");
                return;
            }
            showNotification("Processing your transaction...", "pending");
            try {
                animateButton(document.getElementById('distributeButton'));
                const tx = await contract.methods.distributeTokens(wallets).send({
                    from: userAccount,
                    gas: 2000000 // Adjust as needed
                });
                showNotification('Successfully distributed tokens!', 'done');
                walletsSent += wallets.length;
                currentBatchIndex += walletsPerBatch;
                updateWalletStats();
                if (currentBatchIndex < extractedWallets.length) {
                    document.getElementById('nextButton').style.display = '';
                } else {
                    document.getElementById('nextButton').style.display = 'none';
                }
                // Update wallet list for next batch
                updateWalletList();
            } catch (error) {
                showNotification('Distribution failed. Please try again.', 'error');
            }
        }
        // Distribute next batch of tokens
        async function distributeNextTokens() {
            await distributeTokens();
        }
        // Update wallet list for current batch
        function updateWalletList() {
            const walletList = document.getElementById("walletList");
            walletList.innerHTML = "";
            extractedWallets.slice(currentBatchIndex, currentBatchIndex + walletsPerBatch).forEach(wallet => {
                let li = document.createElement("li");
                li.textContent = wallet;
                li.dataset.wallet = wallet;
                walletList.appendChild(li);
            });
        }
        // Show notification
        function showNotification(message, status) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = status;
            notification.style.display = "block";
            setTimeout(function () {
                notification.style.display = "none";
            }, 2700);
            addNotificationToTable(message, status);
        }
        // Add notification to table
        function addNotificationToTable(message, status) {
            const notificationRows = document.getElementById('notificationRows');
            const statusText = status === 'done' ? 'SUCCESS' : status.charAt(0).toUpperCase() + status.slice(1);
            const row = document.createElement('tr');
            row.className = `status-${status}`;
            row.innerHTML = `<td>${message}</td><td>${statusText}</td>`;
            notificationRows.appendChild(row);
            if (notificationRows.childNodes.length > 7) {
                notificationRows.removeChild(notificationRows.childNodes[0]);
            }
        }
        // Handle wallet disconnection
        window.addEventListener('load', function() {
            // Prevent zoom on input for mobile
            document.getElementById('inputText').addEventListener('touchstart', function (e) {
                this.style.fontSize = '16px';
            });
            document.getElementById('inputText').addEventListener('paste', function(){
                animateButton(document.getElementById('extractBtn'));
            });
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        userAccount = null;
                        document.getElementById('walletAddress').innerText = '';
                        document.getElementById('connectButton').style.display = '';
                        document.getElementById('distributeButton').style.display = 'none';
                        document.getElementById('nextButton').style.display = 'none';
                        showNotification("Wallet disconnected", "info");
                    }
                });
            }
        });
    </script>
</body>
</html>
