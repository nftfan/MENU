<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint NFT FANS ARTS</title>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
</head>
<body>

    <h1>Mint NFT FANS ARTS</h1>

    <p id="status">Connect to MetaMask to start</p>

    <button id="connectWalletBtn">Connect Wallet</button>

    <div id="mintingSection" style="display:none;">
        <div>
            <label for="tokenId">Token ID:</label>
            <input type="number" id="tokenId" required />
        </div>

        <div>
            <label for="amount">Amount:</label>
            <input type="number" id="amount" value="1" required />
        </div>

        <button id="mintBtn">Buy NFT</button>
    </div>

    <script type="text/javascript">
        const contractAddress = "0x3e6E1F0e21A6521eE69baceEBA22e7CeCe42eb1c";
        
        // Correct ABI in JSON format
        const contractABI = [
            {
                "constant": false,
                "inputs": [
                    {
                        "name": "_tokenId",
                        "type": "uint256"
                    },
                    {
                        "name": "_amount",
                        "type": "uint256"
                    }
                ],
                "name": "buyNFT",
                "outputs": [],
                "payable": true,
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "tokenPrice",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            }
        ];

        let web3;
        let nftContract;
        let userAddress;

        // Load Web3 instance and connect wallet
        document.getElementById('connectWalletBtn').addEventListener('click', async () => {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await window.ethereum.enable();

                    // Load user account
                    const accounts = await web3.eth.getAccounts();
                    userAddress = accounts[0];
                    document.getElementById("status").innerHTML = "Connected to MetaMask: " + userAddress;

                    // Initialize contract
                    nftContract = new web3.eth.Contract(contractABI, contractAddress);

                    // Show minting section
                    document.getElementById("mintingSection").style.display = 'block';
                } catch (error) {
                    document.getElementById("status").innerHTML = "Error connecting to MetaMask: " + error.message;
                }
            } else {
                document.getElementById("status").innerHTML = "MetaMask is not available. Please install it.";
            }
        });

        // Buy NFT Function
        document.getElementById("mintBtn").addEventListener("click", async () => {
            const tokenId = document.getElementById("tokenId").value;
            const amount = document.getElementById("amount").value;

            if (tokenId && amount) {
                try {
                    // Fetch the token price from the contract
                    const tokenPrice = await nftContract.methods.tokenPrice().call();
                    const totalPrice = tokenPrice * amount;

                    const result = await nftContract.methods.buyNFT(tokenId, amount).send({
                        from: userAddress,
                        value: totalPrice // MATIC value sent for the NFTs
                    });

                    document.getElementById("status").innerHTML = `Bought ${amount} NFT(s) with Token ID ${tokenId}`;
                    console.log(result);
                } catch (error) {
                    console.error("Buying error:", error);
                    document.getElementById("status").innerHTML = "Error buying NFT: " + error.message;
                }
            } else {
                document.getElementById("status").innerHTML = "Please fill out all fields.";
            }
        });
    </script>

</body>
</html>
