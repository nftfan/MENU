<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Username Winner Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="icon" href="https://i.imgur.com/ODP45iQ.png" type="image/png">
  <style>
    :root {
      --background: #181B22;
      --card-bg: #222630;
      --input-bg: #232733;
      --accent: #86A8E7;
      --accent2: #91EAE4;
      --accent3: #4F5B77;
      --text: #F3F6FB;
      --muted: #A2A9B7;
      --radius: 16px;
      --shadow: 0 2px 12px 0 rgba(20,24,36,0.15);
      --progress-height: 4px;
      --gradient-bg: linear-gradient(135deg, #232733 0%, #232f3e 100%);
      --text-section-bg: linear-gradient(120deg, #242a36 60%, #1a1f27 100%);
      --text-section-glow: 0 2px 16px 0 rgba(145,234,228,0.10), 0 1.5px 4px 0 rgba(134,168,231,0.08);
      --text-section-border: 1.5px solid #232f3e;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--background);
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      font-size: 10px;
    }
    .container {
      background: var(--card-bg);
      border-radius: 1px;
      box-shadow: var(--shadow);
      padding: 1em 0.9em 1.2em 0.9em;
      max-width: 370px;
      width: 100vw;
      box-sizing: border-box;
      text-align: center;
      margin: 0.7em auto 0 auto;
      position: relative;
      display: block;
    }
    .logo {
      width: 24px;
      height: 24px;
      display: block;
      margin: 0 auto 7px auto;
      border-radius: 50%;
      background: transparent;
      box-shadow: 0 2px 8px 0 rgba(134,168,231,0.11);
    }
    h1 {
      font-size: 0.95em;
      font-weight: 700;
      margin: 0 0 1.0em 0;
      letter-spacing: 0.02em;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .input-section {
      margin-bottom: 1.1em;
    }
    textarea {
      width: 100%;
      min-height: 50px;
      max-height: 130px;
      background: var(--input-bg);
      border: none;
      border-radius: 8px;
      padding: 0.5em 0.6em;
      color: var(--text);
      font-size: 10px;
      outline: none;
      resize: vertical;
      transition: background 0.2s;
      margin-bottom: 0.6em;
      box-sizing: border-box;
    }
    textarea:focus {
      background: #262b3a;
    }
    button, .winner-btn {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color: #181B22;
      border: none;
      border-radius: 8px;
      padding: 0.38em 0.65em;
      font-weight: 700;
      font-size: 10px;
      letter-spacing: 0.03em;
      cursor: pointer;
      transition: filter 0.18s, background 0.18s;
      box-shadow: 0 2px 4px 0 rgba(134,168,231,0.10);
      margin-left: 0.5em;
      display: inline-flex;
      align-items: center;
      gap: 0.18em;
      position: relative;
    }
    button:active, .winner-btn:active {
      filter: brightness(0.95);
    }
    .searchbar-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 1.3em 0 0.4em 0;
      width: 100%;
    }
    .searchbar {
      width: 80%;
      max-width: 210px;
      padding: 0.45em 0.7em;
      border-radius: 20px;
      border: none;
      background: var(--input-bg);
      color: var(--text);
      font-size: 11px;
      outline: none;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px 0 rgba(134,168,231,0.08);
    }
    .searchbar:focus {
      background: #262b3a;
      box-shadow: 0 2px 8px 0 rgba(134,168,231,0.16);
    }
    .search-icon {
      margin-left: -2em;
      pointer-events: none;
      font-size: 1.1em;
      color: #91EAE4;
      opacity: 0.9;
    }
    .text-section {
      margin-top: 1.1em;
      margin-bottom: 1.2em;
      border-radius: 18px;
      background: var(--text-section-bg);
      box-shadow: var(--text-section-glow);
      border: var(--text-section-border);
      padding: 1.15em 0.85em 1.15em 0.85em;
      font-size: 9.7px;
      font-weight: 500;
      color: #E1F5FC;
      line-height: 1.55em;
      position: relative;
      text-align: left;
      transition: box-shadow 0.25s;
      overflow: hidden;
    }
    .text-section .congrats {
      font-size: 11.5px;
      font-weight: bold;
      color: #81FFC6;
      margin-bottom: 0.6em;
      letter-spacing: 0.01em;
      text-align: center;
      display: block;
      background: linear-gradient(92deg, #91EAE4 20%, #86A8E7 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .claim-info {
      margin-top: 0.7em;
      color: #DAF6FB;
      font-size: 9.2px;
      background: rgba(145,234,228,0.08);
      border-radius: 7px;
      padding: 0.65em 0.65em 0.65em 1em;
      line-height: 1.5em;
      box-shadow: 0 1px 8px 0 rgba(134,168,231,0.05);
      border-left: 2.5px solid #8bebff44;
      margin-bottom: 0.1em;
    }
    .dm-link {
      color: #91EAE4;
      text-decoration: underline;
      font-weight: 600;
      transition: color .2s;
    }
    .dm-link:hover {
      color: #fff;
    }
    #usernamesList {
      margin-top: 1.1em;
      text-align: left;
      width: 100%;
      min-height: 50px;
      max-height: 350px;
      overflow-y: auto;
      border-radius: 7px;
      box-shadow: 0 2px 8px 0 rgba(134,168,231,0.07);
      background: none;
      scrollbar-width: thin;
      scrollbar-color: #91EAE4 #232733;
    }
    #usernamesList::-webkit-scrollbar {
      width: 6px;
    }
    #usernamesList::-webkit-scrollbar-thumb {
      background: #91eae4cc;
      border-radius: 6px;
    }
    #usernamesList::-webkit-scrollbar-track {
      background: #232733;
    }
    .username-row {
      display: flex;
      align-items: center;
      gap: 0.6em;
      margin-bottom: 0.5em;
      background: #212a37;
      border-radius: 6px;
      padding: 0.32em 0.5em;
      font-size: 10px;
      font-weight: 600;
      color: #91EAE4;
      box-shadow: 0 2px 8px 0 rgba(145,234,228,0.05);
      justify-content: space-between;
      word-break: break-all;
    }
    .username {
      color: #DAF6FB;
      font-size: 10px;
      font-weight: bold;
    }
    .winner-btn {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color: #181B22;
      font-size: 10px;
      padding: 0.13em 0.5em;
      border-radius: 6px;
      transition: background 0.14s;
      box-shadow: none;
      font-weight: 700;
      margin-left: 0.1em;
      gap: 0.2em;
    }
    .winner-btn:active {
      background: #232733;
      color: #86A8E7;
    }
    .muted {
      color: var(--muted);
      font-size: 9px;
      margin-top: 1em;
      letter-spacing: 0.01em;
      text-align: center;
    }
    .total-row {
      margin: 0.5em 0 0.2em 0;
      font-size: 9.5px;
      font-weight: bold;
      color: #91EAE4;
      letter-spacing: 0.01em;
      text-align: left;
    }
    .progress-bar-container {
      width: 100%;
      height: var(--progress-height);
      background: #222733;
      border-radius: 7px;
      overflow: hidden;
      margin: 0.4em 0 0.7em 0;
      box-shadow: 0 2px 8px 0 rgba(145,234,228,0.08);
      display: none;
    }
    .progress-bar {
      height: var(--progress-height);
      width: 0%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      border-radius: 7px;
      transition: width 0.45s cubic-bezier(0.4, 0.6, 0.2, 1);
      box-shadow: 0 1px 3px 0 rgba(134,168,231,0.12);
    }
    .progress-bar.animated {
      animation: progressbar-stripes 1.4s linear infinite;
      background-size: 40px 40px;
      background-image: repeating-linear-gradient(
        135deg,
        var(--accent2),
        var(--accent2) 12px,
        var(--accent) 12px,
        var(--accent) 24px
      );
    }
    @keyframes progressbar-stripes {
      0% { background-position: 0 0; }
      100% { background-position: 40px 0; }
    }
    @media (max-width: 480px) {
      html, body {
        font-size: 9px;
      }
      .container {
        padding: 0.6em 0.2em 0.9em 0.2em;
        max-width: 100vw;
      }
      .logo {
        width: 18px;
        height: 18px;
      }
      h1 {
        font-size: 0.86em;
      }
      textarea, button, .winner-btn, .searchbar {
        font-size: 9px;
        border-radius: 6px;
      }
      .username-row, .username {
        font-size: 9px;
      }
      .muted {
        font-size: 8px;
      }
      .total-row {
        font-size: 8.5px;
      }
      #usernamesList {
        max-height: 200px;
      }
      .text-section {
        font-size: 9px;
        padding: 0.7em 0.4em 0.7em 0.5em;
      }
      .text-section .congrats {
        font-size: 10px;
      }
      .claim-info {
        font-size: 8.3px;
        padding: 0.45em 0.45em 0.45em 0.7em;
      }
      .searchbar {
        max-width: 150px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="logo" src="https://i.imgur.com/ODP45iQ.png" alt="Logo" />
    <h1>Usernames List & Winner Picker</h1>
    <div class="input-section">
      <textarea id="inputText" placeholder="Paste text containing @usernames here..."></textarea>
      <button onclick="extractUsernames()">Extract Usernames</button>
    </div>
    <div class="text-section">
      <span class="congrats">ðŸŽŠ Congratulations! ðŸŽŠ</span>
      You have won free <b>$NFTFAN tokens</b>! DM us at
      <a class="dm-link" href="https://x.com/nftfanstoken" target="_blank">@nftfanstoken</a>
      to claim your airdrop.<br>
      <div class="claim-info">
        <b>How to claim:</b>
        <ol style="margin: 0.3em 0 0 1.1em; text-align:left; font-size: 9px;">
          <li>Take a screenshot of this page as proof.</li>
          <li>DM us your X (Twitter) username and wallet address at <a class="dm-link" href="https://x.com/nftfanstoken" target="_blank">@nftfanstoken</a>.</li>
        </ol>
        <b>Note:</b> This airdrop is only for genuine participants. Multiple entries or bots will be disqualified.<br>
        <br>
        Thank you for supporting the NFTFAN community! ðŸš€
      </div>
    </div>
    <div class="searchbar-container">
      <input type="text" id="searchbar" class="searchbar" placeholder="Search username..." oninput="searchUsernames()" autocomplete="off">
      <span class="search-icon">
        <svg xmlns="http://www.w3.org/2000/svg" style="height:1.2em;width:1.2em;vertical-align:middle;" fill="none" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke="#91EAE4" stroke-width="2"/><path stroke="#91EAE4" stroke-width="2" stroke-linecap="round" d="M20 20l-3-3"/></svg>
      </span>
    </div>
    <div class="progress-bar-container" id="progressContainer">
      <div class="progress-bar animated" id="progressBar"></div>
    </div>
    <div class="total-row" id="totalUsernames" style="display:none;"></div>
    <div id="usernamesList"></div>
  </div>
  <script>
    const PANTRY_URL =
      "https://getpantry.cloud/apiv1/pantry/ac2eb037-b72e-4e18-8d14-f6a497abed1a/basket/newBasket88";

    // Paging settings
    const PAGE_SIZE = 32;
    let allUsernames = [];
    let totalUsernamesCount = 0;
    let renderedCount = 0;
    let isLoadingPage = false;

    // For search
    let filteredUsernames = null;
    let searchActive = false;
    let searchRenderedCount = 0;

    // Fisher-Yates shuffle for randomizing the array
    function shuffle(array) {
      let m = array.length, t, i;
      while (m) {
        i = Math.floor(Math.random() * m--);
        t = array[m];
        array[m] = array[i];
        array[i] = t;
      }
      return array;
    }

    // Show total usernames count
    function showTotal(count) {
      const totalDiv = document.getElementById('totalUsernames');
      if (count !== undefined && count !== null) {
        totalDiv.textContent = `Total Usernames: ${count}`;
        totalDiv.style.display = '';
      } else {
        totalDiv.style.display = 'none';
      }
    }

    // Progress bar controls
    function showProgressBar() {
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      progressBar.classList.add('animated');
      progressBar.style.width = '0%';
      progressContainer.style.display = 'block';
      setTimeout(() => progressBar.style.width = '85%', 80); // animate to 85%
    }
    function finishProgressBar() {
      const progressBar = document.getElementById('progressBar');
      progressBar.classList.remove('animated');
      progressBar.style.width = '100%';
      setTimeout(() => {
        document.getElementById('progressContainer').style.display = 'none';
        progressBar.style.width = '0%';
      }, 500);
    }

    // Render more usernames on scroll
    function renderMoreUsernames() {
      if (isLoadingPage) return;
      isLoadingPage = true;
      let source = searchActive ? filteredUsernames : allUsernames;
      let renderStart = searchActive ? searchRenderedCount : renderedCount;
      let next = source.slice(renderStart, renderStart + PAGE_SIZE);
      if (!next.length) {
        isLoadingPage = false;
        return;
      }
      const listDiv = document.getElementById('usernamesList');
      next.forEach(u => {
        const row = document.createElement('div');
        row.className = 'username-row';
        // Remove @ for link
        const xProfile = u.replace(/^@/, "");
        row.innerHTML = `
          <span class="username">${u}</span>
          <button class="winner-btn" onclick="goToProfile('${xProfile}')">
            Winner ðŸŽ‰
          </button>
        `;
        listDiv.appendChild(row);
      });
      if (searchActive) searchRenderedCount += next.length;
      else renderedCount += next.length;
      isLoadingPage = false;
    }

    // Infinite scroll handler
    function usernamesListScrollHandler(e) {
      const el = e.target;
      if (el.scrollTop + el.clientHeight >= el.scrollHeight - 32) { // near end
        renderMoreUsernames();
      }
    }

    // Set up scroll event for usernamesList
    function setupInfiniteScroll() {
      const listDiv = document.getElementById('usernamesList');
      listDiv.removeEventListener('scroll', usernamesListScrollHandler);
      listDiv.addEventListener('scroll', usernamesListScrollHandler);
    }

    // Fetch and display usernames on page load
    async function fetchAndShowUsernames() {
      const listDiv = document.getElementById('usernamesList');
      showTotal(null);
      listDiv.innerHTML = '<div class="muted">Loading...</div>';
      allUsernames = [];
      renderedCount = 0;
      totalUsernamesCount = 0;
      filteredUsernames = null;
      searchActive = false;
      searchRenderedCount = 0;
      document.getElementById('searchbar').value = '';

      try {
        const res = await fetch(PANTRY_URL);
        if (!res.ok) throw new Error('Error fetching');
        const data = await res.json();
        let usernames = Array.isArray(data.usernames) ? data.usernames : [];
        totalUsernamesCount = usernames.length;
        if (!usernames.length) {
          listDiv.innerHTML = '<div class="muted">No usernames saved yet.</div>';
          showTotal(0);
          return;
        }
        allUsernames = shuffle([...usernames]);
        listDiv.innerHTML = ''; // clear
        renderMoreUsernames();
        showTotal(totalUsernamesCount);
        setupInfiniteScroll();
      } catch (err) {
        listDiv.innerHTML = '<div class="muted">Error loading usernames.</div>';
        showTotal(null);
      }
    }

    // Render usernames as list with winner buttons (replace all)
    function renderUsernames(usernames) {
      allUsernames = usernames;
      renderedCount = 0;
      filteredUsernames = null;
      searchActive = false;
      searchRenderedCount = 0;
      document.getElementById('searchbar').value = '';
      const listDiv = document.getElementById('usernamesList');
      listDiv.innerHTML = '';
      renderMoreUsernames();
      showTotal(usernames.length);
      setupInfiniteScroll();
    }

    // Extract usernames, merge, and update API
    async function extractUsernames() {
      const text = document.getElementById('inputText').value;
      // Regex: @ followed by 2-32 allowed chars (letters, numbers, underscores, dots)
      const matches = text.match(/@[a-zA-Z0-9_\.]{2,32}/g) || [];
      const newUsernames = Array.from(new Set(matches));
      if (newUsernames.length === 0) {
        document.getElementById('usernamesList').innerHTML = '<div class="muted">No usernames found.</div>';
        showTotal(0);
        return;
      }
      showProgressBar();
      // Fetch current usernames from API
      let currentUsernames = [];
      try {
        const res = await fetch(PANTRY_URL);
        if (res.ok) {
          const data = await res.json();
          currentUsernames = Array.isArray(data.usernames) ? data.usernames : [];
        }
      } catch (err) {}
      // Merge and deduplicate
      const merged = Array.from(new Set([...currentUsernames, ...newUsernames]));
      // Save back to API
      try {
        await fetch(PANTRY_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ usernames: merged })
        });
      } catch (err) {
        // ignore for now, still show locally
      }
      setTimeout(() => {
        renderUsernames(shuffle([...merged]));
        finishProgressBar();
      }, 650); // give a little time for animation to look nice
    }

    // Go to X profile
    function goToProfile(xUsername) {
      window.open(`https://x.com/${xUsername}`, '_blank');
    }

    // Sleek searchbar to filter usernames
    function searchUsernames() {
      const searchbar = document.getElementById('searchbar');
      const searchTerm = searchbar.value.trim().toLowerCase();
      const listDiv = document.getElementById('usernamesList');
      searchActive = !!searchTerm;
      searchRenderedCount = 0;

      if (!searchActive) {
        listDiv.innerHTML = "";
        renderedCount = 0;
        renderMoreUsernames();
        showTotal(allUsernames.length);
        return;
      }

      // Filter usernames
      filteredUsernames = allUsernames.filter(u => u.toLowerCase().includes(searchTerm));
      listDiv.innerHTML = "";
      // Show message if none found
      if (filteredUsernames.length === 0) {
        listDiv.innerHTML = '<div class="muted">No usernames found.</div>';
        showTotal(0);
        return;
      }
      renderMoreUsernames();
      showTotal(filteredUsernames.length);
    }

    // On load, fetch usernames and set up scroll
    fetchAndShowUsernames();
    // Expose goToProfile globally for button onclicks
    window.goToProfile = goToProfile;
  </script>
</body>
</html>
