<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NFTFAN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f0f12;
      --surface:#17171c;
      --surface-2:#1d1d23;
      --card:#16161b;
      --text:#e6e6ea;
      --muted:#8e8e98;
      --border:#2a2a33;
      --accent:#e4ae64;
      --success:#74c690;
      --danger:#f06d6d;
      --radius:14px;
      --shadow:0 6px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Inter, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg, #0d0d10 0%, #0f0f12 60%) fixed;
      color:var(--text);
      font:400 13px/1.5 var(--font);
    }
    /* Topbar: ONLY the text "NFTFAN" */
    .topbar{
      position:sticky;
      top:0;
      z-index:40;
      display:flex;
      align-items:center;
      justify-content:center;
      height:48px;
      padding:0 16px;
      background:rgba(15,15,18,.9);
      backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid var(--border);
    }
    .topbar__title{
      font-weight:800;
      letter-spacing:.4px;
      font-size:16px;
      color:var(--text);
      user-select:none;
    }
    /* Layout */
    .container{max-width:1100px; margin:18px auto; padding:0 14px}
    .grid{display:grid; grid-template-columns:1.6fr .9fr; gap:16px}
    .col--main{display:grid; gap:16px}
    .col--side{display:grid; gap:16px}
    /* Cards */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }

    /* Hero */
    .hero{
      display:flex;
      align-items:center;
      gap:14px;
      padding:16px;
      background:linear-gradient(135deg, #2f281b 0%, #e4ae64 35%, #43321c 100%);
      color:#1b130a;
      border-color:#d6a055;
    }
    .hero__icon .square{
      width:36px;
      height:36px;
      border-radius:8px;
      background:#fff2db;
      display:grid; place-items:center;
    }
    .square__bar{display:block; width:14px; height:4px; background:#1b130a; border-radius:2px}
    .hero__title{font-weight:800; font-size:16px}
    .hero__caption{color:#2a2116}

    .hero__button {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:16px;
      padding:10px 22px;
      background:#16161b;
      color:#fff;
      font-weight:600;
      font-size:13px;
      border-radius:999px;
      text-decoration:none;
      transition:background .2s ease, transform .15s ease, box-shadow .15s ease, opacity .15s ease;
      box-shadow:0 4px 14px rgba(0,0,0,0.45);
      border:1px solid rgba(255,255,255,.08);
    }
    .hero__button:hover {
      background:#1f1f27;
      transform:translateY(-1px);
      box-shadow:0 8px 22px rgba(0,0,0,0.6);
    }
    .hero__button:active{
      transform:translateY(0);
      box-shadow:0 3px 10px rgba(0,0,0,0.6);
      opacity:.95;
    }

    /* Section header */
    .section-header{display:flex; align-items:center; justify-content:space-between; padding:0 2px}
    .section-title{margin:0; font-size:14px}
    .section-actions{display:flex; align-items:center; gap:10px}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .divider{width:1px; height:18px; background:var(--border)}

    /* Switch */
    .switch{position:relative; display:inline-block; width:38px; height:22px}
    .switch input{opacity:0; width:0; height:0}
    .switch__slider{
      position:absolute; inset:0;
      background:var(--surface-2);
      border:1px solid var(--border);
      border-radius:999px;
      transition:all .2s ease;
    }
    .switch__slider:before{
      content:"";
      position:absolute; height:16px; width:16px; left:3px; top:2px;
      background:#fff; border-radius:50%; transition:.2s ease;
    }
    .switch input:checked + .switch__slider{background:#2b2b34; border-color:#3a3a44}
    .switch input:checked + .switch__slider:before{transform:translateX(16px)}

    /* Opportunity card base */
    .op{
      padding:14px;
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .op::before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.16;
      pointer-events:none;
    }

    /* Different background color per task */
    /* Program 1: Tweet Promotion */
    .op--tweet{
      background:radial-gradient(circle at top left, #1c2635 0, #15151c 50%, #111117 100%);
      border-color:#28354b;
    }
    .op--tweet::before{
      background:radial-gradient(circle at top right, rgba(66,153,225,.45), transparent 55%);
    }

    /* Program 2: X Community */
    .op--community{
      background:radial-gradient(circle at top left, #271b3a 0, #181320 50%, #111017 100%);
      border-color:#3c2b5a;
    }
    .op--community::before{
      background:radial-gradient(circle at top right, rgba(160,110,255,.45), transparent 55%);
    }

    /* Program 3: Mention Task */
    .op--mention{
      background:radial-gradient(circle at top left, #123132 0, #131c1d 50%, #0f1515 100%);
      border-color:#234848;
    }
    .op--mention::before{
      background:radial-gradient(circle at top right, rgba(56,178,172,.45), transparent 55%);
    }

    .op__header{display:grid; gap:12px; position:relative; z-index:1;}
    .op__title{display:flex; align-items:center; gap:10px}
    .op__icon{width:26px; height:26px; border-radius:7px; display:grid; place-items:center; color:#111}
    .op__icon--tw{background:#e6f2ff; color:#1e7bdc}
    .op__name{margin:0; font-size:14px}
    .op__meta{display:flex; align-items:center; gap:12px; flex-wrap:wrap; padding:6px 0}
    .meta{display:grid; gap:4px}
    .meta__label{color:var(--muted); font-size:11px; letter-spacing:.3px}
    .meta__value{display:inline-flex; align-items:center; gap:6px; font-weight:700}
    .sep{width:1px; height:28px; background:var(--border)}
    .op__body{
      margin-top:10px;
      display:grid; grid-template-columns:1.1fr .9fr; gap:14px;
      position:relative;
      z-index:1;
    }
    .op__left{display:grid; gap:10px}

    /* Professional buttons */
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(18,18,23,0.95);
      color:var(--text);
      padding:8px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      font-size:12px;
      letter-spacing:.02em;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      transition:
        background .18s ease,
        border-color .18s ease,
        color .18s ease,
        transform .1s ease,
        box-shadow .1s ease,
        opacity .15s ease;
      box-shadow:0 4px 10px rgba(0,0,0,0.45);
    }
    .btn:hover:not(:disabled){
      background:#20202a;
      border-color:rgba(255,255,255,0.12);
      transform:translateY(-1px);
      box-shadow:0 7px 18px rgba(0,0,0,0.6);
    }
    .btn:active:not(:disabled){
      transform:translateY(0);
      box-shadow:0 3px 9px rgba(0,0,0,0.6);
      opacity:.95;
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      box-shadow:none;
    }

    .btn--primary{
      background:linear-gradient(135deg, #f6c977, #e4ae64);
      color:#16120d;
      border-color:#f6c977;
      box-shadow:0 6px 16px rgba(228,174,100,0.45);
    }
    .btn--primary:hover:not(:disabled){
      background:linear-gradient(135deg, #ffd789, #f0b96f);
      box-shadow:0 8px 22px rgba(228,174,100,0.6);
    }
    .btn--primary:active:not(:disabled){
      box-shadow:0 3px 10px rgba(228,174,100,0.6);
    }

    .btn--ghost{
      background:transparent;
      border-color:rgba(255,255,255,0.09);
      color:var(--text);
      box-shadow:none;
    }
    .btn--ghost:hover:not(:disabled){
      background:rgba(255,255,255,0.03);
      border-color:rgba(255,255,255,0.18);
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }

    .btn--accent{
      background:linear-gradient(135deg, #353545, #272734);
      border-color:#46465a;
      color:#f7f7ff;
    }
    .btn--accent:hover:not(:disabled){
      background:linear-gradient(135deg, #44445a, #303042);
      border-color:#5b5b75;
    }

    .editor{display:grid; gap:8px}
    textarea{
      width:100%; min-height:120px; resize:vertical;
      padding:10px 12px;
      background:var(--surface); color:var(--text);
      border:1px solid var(--border); border-radius:10px; outline:none;
      font-family:inherit;
      font-size:12px;
    }
    textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(228,174,100,.35);
    }
    .note{color:var(--muted); font-size:12px}
    .hidden{display:none}
    .op__right{display:grid; gap:8px; align-content:start}
    .sub-title{margin:0; font-size:13px}
    .input{
      width:100%; padding:10px 12px; border-radius:10px;
      background:var(--surface); border:1px solid var(--border);
      color:var(--text); outline:none;
      font-size:12px;
      font-family:inherit;
    }
    .input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(228,174,100,.35);
    }

    /* Stats */
    .stats{display:grid; gap:12px}
    .stat{display:flex; gap:10px; padding:12px}
    .stat__icon{
      width:36px; height:36px; border-radius:10px;
      display:grid; place-items:center;
      background:var(--surface-2); color:var(--accent);
      border:1px solid var(--border);
    }
    .stat__content{display:grid; gap:4px}
    .stat__label{color:var(--muted); font-size:11px}
    .stat__value{font-weight:800; font-size:16px}
    .stat__sub{color:var(--muted); font-size:11px}

    /* Recent */
    .recent{padding:12px}
    .recent__header{display:flex; align-items:center; justify-content:space-between}
    .recent__title{margin:0; font-size:14px}
    .recent__list{list-style:none; margin:8px 0 0; padding:0; display:grid; gap:8px}
    .item{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:var(--surface); border:1px solid var(--border);
      border-radius:10px; padding:10px;
    }
    .item__link{color:var(--text); text-decoration:none; word-break:break-all}
    .item__link:hover{text-decoration:underline}
    .badge{
      padding:3px 8px; border-radius:999px; border:1px solid currentColor; font-size:11px; white-space:nowrap;
    }
    .badge--accepted{color:var(--success)}
    .badge--rejected{color:var(--danger)}
    .badge--verifying{color:var(--accent)}

    /* Mention task specific */
    .cooldown{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px dashed var(--border); border-radius:10px;
      background:rgba(0,0,0,.25);
    }
    .cooldown__time{
      font-weight:800;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .op__body{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <!-- Title bar shows ONLY "NFTFAN" -->
  <header class="topbar">
    <div class="topbar__title">NFTFAN</div>
  </header>

  <main class="container">
    <div class="grid">
      <div class="col col--main">
        <!-- Welcome / hero -->
        <section class="hero card">
          <div class="hero__icon">
            <div class="square"><span class="square__bar"></span></div>
          </div>

          <div class="hero__content">
            <div class="hero__title">Welcome, creator!</div>
            <div class="hero__caption">Earn tokens by promoting NFTFAN and submitting proof.</div>

            <!-- New Button -->
            <a href="https://www.nftfanstoken.com/rewardx/" class="hero__button">
              View Results
            </a>
          </div>
        </section>

        <!-- Section header with actions -->
        <div class="section-header">
          <h2 class="section-title">Funding Opportunities</h2>
          <div class="section-actions">
            <label class="switch" title="Toggle USD display for earnings">
              <input id="toggleUSD" type="checkbox" />
              <span class="switch__slider"></span>
            </label>
            <span class="muted">Display in USD</span>
            <div class="divider"></div>
            <button class="btn btn--ghost" disabled>Sort by</button>
          </div>
        </div>

        <!-- Program 1: Tweet Promotion Program -->
        <article class="op op--tweet">
          <div class="op__header">
            <div class="op__title">
              <div class="op__icon op__icon--tw">
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22 5.92c-.77.34-1.6.56-2.46.66a4.27 4.27 0 0 0 1.87-2.36 8.53 8.53 0 0 1-2.7 1.04 4.26 4.26 0 0 0-7.25 3.88A12.09 12.09 0 0 1 3.15 4.6a4.26 4.26 0 0 0 1.32 5.68 4.2 4.2 0 0 1-1.93-.53v.05a4.26 4.26 0 0 0 3.42 4.17 4.28 4.28 0 0 1-1.92.07 4.27 4.27 0 0 0 3.98 2.96A8.55 8.55 0 0 1 2 18.58a12.05 12.05 0 0 0 6.53 1.92c7.85 0 12.14-6.5 12.14-12.13l-.01-.55A8.66 8.66 0 0 0 22 5.92z"/></svg>
              </div>
              <h3 class="op__name">Tweet Promotion Program</h3>
            </div>
            <div class="op__meta">
              <div class="meta">
                <span class="meta__label">SUBMISSION DEADLINE</span>
                <span class="meta__value">
                  <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 11h10M7 15h10M7 7h10M4 5h16v14H4z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <span id="deadline">Dec 31, 2025</span>
                </span>
              </div>
              <div class="sep"></div>
              <div class="meta">
                <span class="meta__label">EARN UP TO</span>
                <span class="meta__value">
                  <span id="earnUpTo">5,000,000,000</span>
                  <span id="earnUnit">NFTFAN</span>
                </span>
              </div>
              <div class="sep"></div>
              <div class="meta">
                <span class="meta__label">APPLICANTS</span>
                <span class="meta__value" id="applicantsCount">0</span>
              </div>
            </div>
          </div>
          <div class="op__body">
            <div class="op__left">
              <div class="controls">
                <button id="generateBtn" type="button" class="btn btn--primary">Generate Tweet</button>
                <button id="copyBtn" type="button" class="btn btn--ghost" disabled>Copy Tweet</button>
              </div>
              <div id="tweetBlock" class="editor hidden">
                <textarea id="tweetText" readonly></textarea>
                <div id="status" class="muted small"></div>
                <div class="note">Post this on X to earn 10 Billion NFTFAN tokens. Your tweet must have at least 100 views before submitting proof.</div>
              </div>
            </div>
            <div class="op__right">
              <h4 class="sub-title">Submit Proof</h4>
              <p class="muted small">Paste the URL of your tweet after it reaches 100+ views.</p>
              <div class="proof">
                <input id="proofUrl" type="url" class="input" placeholder="https://x.com/yourhandle/status/1234567890" />
                <button id="submitProofBtn" type="button" class="btn btn--accent">Submit</button>
              </div>
              <div id="proofStatus" class="muted small" role="status"></div>
            </div>
          </div>
        </article>

        <!-- Program 2: X Community Posting Program -->
        <article class="op op--community">
          <div class="op__header">
            <div class="op__title">
              <div class="op__icon op__icon--tw">
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22 5.92c-.77.34-1.6.56-2.46.66a4.27 4.27 0 0 0 1.87-2.36 8.53 8.53 0 0 1-2.7 1.04 4.26 4.26 0 0 0-7.25 3.88A12.09 12.09 0 0 1 3.15 4.6a4.26 4.26 0 0 0 1.32 5.68 4.2 4.2 0 0 1-1.93-.53v.05a4.26 4.26 0 0 0 3.42 4.17 4.28 4.28 0 0 1-1.92.07 4.27 4.27 0 0 0 3.98 2.96A8.55 8.55 0 0 1 2 18.58a12.05 12.05 0 0 0 6.53 1.92c7.85 0 12.14-6.5 12.14-12.13l-.01-.55A8.66 8.66 0 0 0 22 5.92z"/></svg>
              </div>
              <h3 class="op__name">X Community Posting Program</h3>
            </div>
            <div class="op__meta">
              <div class="meta">
                <span class="meta__label">SUBMISSION DEADLINE</span>
                <span class="meta__value">
                  <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 11h10M7 15h10M7 7h10M4 5h16v14H4z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <span id="deadlineCommunity">Dec 31, 2025</span>
                </span>
              </div>
              <div class="sep"></div>
              <div class="meta">
                <span class="meta__label">EARN UP TO</span>
                <span class="meta__value">
                  <span id="earnUpToCommunity">100,000,000,000</span>
                  <span id="earnUnitCommunity">NFTFAN</span>
                </span>
              </div>
              <div class="sep"></div>
              <div class="meta">
                <span class="meta__label">APPLICANTS</span>
                <span class="meta__value" id="applicantsCountCommunity">0</span>
              </div>
            </div>
          </div>
          <div class="op__body">
            <div class="op__left">
              <div class="controls">
                <button id="generateCommunityBtn" type="button" class="btn btn--primary">Generate Community Tweet</button>
                <button id="copyCommunityBtn" type="button" class="btn btn--ghost" disabled>Copy Tweet</button>
              </div>
              <div id="tweetBlockCommunity" class="editor hidden">
                <textarea id="tweetTextCommunity" readonly></textarea>
                <div id="statusCommunity" class="muted small"></div>
                <div class="note">
                  Copy the tweet and post it inside our official X Community to qualify:
                  <a href="https://x.com/i/communities/1648665563332263936" target="_blank" rel="noopener noreferrer">NFTFAN X Community</a>
                </div>
              </div>
            </div>
            <div class="op__right">
              <h4 class="sub-title">Submit Proof</h4>
              <p class="muted small">Paste the URL of your post inside the community after posting.</p>
              <div class="proof">
                <input id="proofUrlCommunity" type="url" class="input" placeholder="https://x.com/yourhandle/status/1234567890" />
                <button id="submitProofCommunityBtn" type="button" class="btn btn--accent">Submit</button>
              </div>
              <div id="proofStatusCommunity" class="muted small" role="status"></div>
            </div>
          </div>
        </article>

        <!-- Program 3: $NFTFAN Mention Task -->
        <article class="op op--mention" id="mentionTask">
          <div class="op__header">
            <div class="op__title">
              <div class="op__icon op__icon--tw">
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22 5.92c-.77.34-1.6.56-2.46.66a4.27 4.27 0 0 0 1.87-2.36 8.53 8.53 0 0 1-2.7 1.04 4.26 4.26 0 0 0-7.25 3.88A12.09 12.09 0 0 1 3.15 4.6a4.26 4.26 0 0 0 1.32 5.68 4.2 4.2 0 0 1-1.93-.53v.05a4.26 4.26 0 0 0 3.42 4.17 4.28 4.28 0 0 1-1.92.07 4.27 4.27 0 0 0 3.98 2.96A8.55 8.55 0 0 1 2 18.58a12.05 12.05 0 0 0 6.53 1.92c7.85 0 12.14-6.5 12.14-12.13l-.01-.55A8.66 8.66 0 0 0 22 5.92z"/></svg>
              </div>
              <h3 class="op__name">$NFTFAN Mention Task</h3>
            </div>
            <div class="op__meta">
              <div class="meta">
                <span class="meta__label">COOLDOWN</span>
                <span class="meta__value"><span id="mentionCooldownLabel">20 min</span></span>
              </div>
              <div class="sep"></div>
              <div class="meta">
                <span class="meta__label">REWARD</span>
                <span class="meta__value">5,000,000,000 <span>NFTFAN</span></span>
              </div>
            </div>
          </div>
          <div class="op__body">
            <div class="op__left">
              <div id="mentionCooldownWrap" class="cooldown hidden" role="status" aria-live="polite">
                <span class="muted small">Please wait</span>
                <span class="cooldown__time" id="mentionCooldownTimer">20:00</span>
                <span class="muted small">before generating another tweet.</span>
              </div>

              <div class="controls">
                <button id="generateMentionBtn" type="button" class="btn btn--primary">Generate Mentions</button>
                <button id="copyMentionBtn" type="button" class="btn btn--ghost" disabled>Copy Text</button>
                <button id="postMentionBtn" type="button" class="btn btn--accent" disabled>Post on X</button>
              </div>

              <div id="tweetBlockMention" class="editor hidden">
                <textarea id="tweetTextMention" readonly></textarea>
                <div id="statusMention" class="muted small"></div>
                <div class="note">This uses two pending user groups from the queue and mentions them. Cooldown starts after generation.</div>
              </div>
            </div>

            <div class="op__right">
              <h4 class="sub-title">How it works</h4>
              <ul class="muted small" style="margin:0 0 6px 16px">
                <li>Claims two pending groups from the queue.</li>
                <li>Generates a tweet with all usernames mentioned.</li>
                <li>20-minute cooldown between generations per browser.</li>
              </ul>
              <div class="note">No login required. No graphs.</div>
            </div>
          </div>
        </article>
      </div>

      <aside class="col col--side">
        <!-- Stat cards -->
        <div class="stats">
          <div class="stat card">
            <div class="stat__icon stat__icon--wallet">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 7h16a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H3V7z" stroke="currentColor" stroke-width="1.6" fill="none"/><path d="M3 7V6a2 2 0 0 1 2-2h11" stroke="currentColor" stroke-width="1.6" fill="none"/></svg>
            </div>
            <div class="stat__content">
              <div class="stat__label">Funding Available Today</div>
              <div class="stat__value" id="fundsAvailable">$0</div>
              <div class="stat__sub" id="fundsAvailableToken">= 0 NFTFAN</div>
            </div>
          </div>

          <div class="stat card">
            <div class="stat__icon stat__icon--pool">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16M4 10h16M4 14h16M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
            </div>
            <div class="stat__content">
              <div class="stat__label">Active Funding Pools</div>
              <div class="stat__value" id="activePools">0</div>
            </div>
          </div>
        </div>

        <!-- Recent Submissions -->
        <section class="recent card">
          <div class="recent__header">
            <h3 class="recent__title">Recent Submissions</h3>
          </div>
          <ul id="submissionsList" class="recent__list"></ul>
        </section>
      </aside>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, update, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    /* Realtime Database (example expected):
      - stats/
          funds_token_available: number
          token_to_usd_rate: number
          active_pools: number (optional; or derive from pools/)
      - campaign/
          deadline: ISO string
          earn_up_to_tokens: number
      - campaign_community/
          deadline: ISO string
          earn_up_to_tokens: number
      - groups/
          group_1: { status: "pending", usernames: ["alice", "bob"] }
      - submissions/
          autoId: { url, status, submitted_at }
      - submissions_community/
          autoId: { url, status, submitted_at }
    */

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyC6wYBu-KOXkDmB-84_7OPtY71zBX4FzRY",
      authDomain: "newnft-47bd7.firebaseapp.com",
      databaseURL: "https://newnft-47bd7-default-rtdb.firebaseio.com",
      projectId: "newnft-47bd7",
      storageBucket: "newnft-47bd7.firebasestorage.app",
      messagingSenderId: "172043823738",
      appId: "1:172043823738:web:daf1fcfb7862d7d8f029c3",
      measurementId: "G-8VB3DYRNXR"
    };

    const FALLBACK = {
      FUNDS_TOKEN_AVAILABLE: 100_000_000_000,
      TOKEN_TO_USD: 0.00000012843068,
      EARN_UP_TO_TOKENS: 5_000_000_000,
      EARN_UP_TO_TOKENS_COMMUNITY: 100_000_000_000,
      ACTIVE_POOLS: 10,
      DEADLINE_ISO: "2025-12-31T23:59:59.000Z",
      DEADLINE_COMMUNITY_ISO: "2025-12-31T23:59:59.000Z"
    };

    // App + DB
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // DOM helpers
    const $ = (sel) => document.querySelector(sel);

    const statusEl = $("#status");
    const generateBtn = $("#generateBtn");
    const copyBtn = $("#copyBtn");
    const tweetBlock = $("#tweetBlock");
    const tweetText = $("#tweetText");
    const proofUrlInput = $("#proofUrl");
    const submitProofBtn = $("#submitProofBtn");
    const proofStatusEl = $("#proofStatus");
    const submissionsListEl = $("#submissionsList");
    const applicantsCountEl = $("#applicantsCount");

    // Community DOM
    const statusCommunityEl = $("#statusCommunity");
    const generateCommunityBtn = $("#generateCommunityBtn");
    const copyCommunityBtn = $("#copyCommunityBtn");
    const tweetBlockCommunity = $("#tweetBlockCommunity");
    const tweetTextCommunity = $("#tweetTextCommunity");
    const proofUrlCommunityInput = $("#proofUrlCommunity");
    const submitProofCommunityBtn = $("#submitProofCommunityBtn");
    const proofStatusCommunityEl = $("#proofStatusCommunity");
    const applicantsCountCommunityEl = $("#applicantsCountCommunity");

    // Mention Task DOM
    const generateMentionBtn = $("#generateMentionBtn");
    const copyMentionBtn = $("#copyMentionBtn");
    const postMentionBtn = $("#postMentionBtn");
    const tweetBlockMention = $("#tweetBlockMention");
    const tweetTextMention = $("#tweetTextMention");
    const statusMentionEl = $("#statusMention");
    const mentionCooldownWrap = $("#mentionCooldownWrap");
    const mentionCooldownTimer = $("#mentionCooldownTimer");

    function setText(sel, text){
      const el = typeof sel === "string" ? $(sel) : sel;
      if (el) el.textContent = text ?? "";
    }
    function numberOrFallback(v, fb){
      const n = typeof v === "string" ? Number(v) : v;
      return Number.isFinite(n) ? n : fb;
    }
    function formatNumber(n){
      try { return Number(n).toLocaleString(); } catch { return String(n); }
    }
    function formatMoney(n){
      try { return Number(n).toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 }); }
      catch { return `$${n}`; }
    }
    function isLikelyUrl(str){
      try { const u = new URL(str); return u.protocol === "http:" || u.protocol === "https:"; }
      catch { return false; }
    }
    function setStatus(msg){ if (statusEl) statusEl.textContent = msg || ""; }
    function setStatusCommunity(msg){ if (statusCommunityEl) statusCommunityEl.textContent = msg || ""; }

    // Global state for conversion
    let state = {
      tokenToUsd: FALLBACK.TOKEN_TO_USD,
      fundsToken: FALLBACK.FUNDS_TOKEN_AVAILABLE,
      earnUpToTokens: FALLBACK.EARN_UP_TO_TOKENS,
      earnUpToTokensCommunity: FALLBACK.EARN_UP_TO_TOKENS_COMMUNITY
    };

    function renderFunds(){
      const usd = state.fundsToken * state.tokenToUsd;
      setText("#fundsAvailable", formatMoney(usd));
      setText("#fundsAvailableToken", `= ${formatNumber(state.fundsToken)} NFTFAN`);
    }
    function renderCampaignHeader(){
      setText("#earnUpTo", formatNumber(state.earnUpToTokens));
      setText("#earnUnit", "NFTFAN");
    }
    function renderCommunityHeader(){
      setText("#earnUpToCommunity", formatNumber(state.earnUpToTokensCommunity));
      setText("#earnUnitCommunity", "NFTFAN");
    }

    // Subscribe to stats/
    onValue(ref(db, "stats"), (snap) => {
      const v = snap.val() || {};
      state.tokenToUsd = numberOrFallback(v.token_to_usd_rate, state.tokenToUsd);
      state.fundsToken = numberOrFallback(v.funds_token_available, state.fundsToken);
      const activePools = numberOrFallback(v.active_pools, undefined);
      if (Number.isFinite(activePools)) setText("#activePools", formatNumber(activePools));
      renderFunds();
    });

    // Derive active pools if pools/ exists
    onValue(ref(db, "pools"), (snap) => {
      const val = snap.val();
      if (val && typeof val === "object") {
        setText("#activePools", formatNumber(Object.keys(val).length));
      } else {
        setText("#activePools", formatNumber(FALLBACK.ACTIVE_POOLS));
      }
    });

    // Campaign 1 details
    onValue(ref(db, "campaign"), (snap) => {
      const v = snap.val() || {};
      const earn = numberOrFallback(v.earn_up_to_tokens, undefined);
      if (Number.isFinite(earn)) {
        state.earnUpToTokens = earn;
        renderCampaignHeader();
      }
      const deadlineISO = v.deadline || FALLBACK.DEADLINE_ISO;
      try {
        const d = new Date(deadlineISO);
        const pretty = d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
        setText("#deadline", pretty);
      } catch {
        setText("#deadline", "—");
      }
    });

    // Campaign 2 (community) details
    onValue(ref(db, "campaign_community"), (snap) => {
      const v = snap.val() || {};
      const earn = numberOrFallback(v.earn_up_to_tokens, undefined);
      if (Number.isFinite(earn)) {
        state.earnUpToTokensCommunity = earn;
        renderCommunityHeader();
      }
      const deadlineISO = v.deadline || FALLBACK.DEADLINE_COMMUNITY_ISO;
      try {
        const d = new Date(deadlineISO);
        const pretty = d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
        setText("#deadlineCommunity", pretty);
      } catch {
        setText("#deadlineCommunity", "—");
      }
    });

    // Toggle USD for "EARN UP TO" (program 1 only per UI)
    const toggle = $("#toggleUSD");
    toggle?.addEventListener("change", () => {
      const useUSD = toggle.checked;
      if (useUSD){
        setText("#earnUpTo", formatMoney(state.earnUpToTokens * state.tokenToUsd));
        setText("#earnUnit", "USD");
      } else {
        setText("#earnUpTo", formatNumber(state.earnUpToTokens));
        setText("#earnUnit", "NFTFAN");
      }
    });

    // Helpers for tweet generation
    async function fetchAndClaimTwoGroups(claimer = "dashboard"){
      try{
        const groupsRef = ref(db, "groups");
        const snapshot = await get(groupsRef);
        if (!snapshot.exists()) return [];
        const groupsObj = snapshot.val();
        const pending = [];
        for (const key in groupsObj){
          const g = groupsObj[key];
          if (g && g.status === "pending"){
            pending.push({ key, data: g });
          }
        }
        pending.sort((a, b) => {
          const na = parseInt(String(a.key).replace(/\D+/g, "")) || 0;
          const nb = parseInt(String(b.key).replace(/\D+/g, "")) || 0;
          return na - nb;
        });
        const toClaim = pending.slice(0, 2);
        if (toClaim.length === 0) return [];
        const updates = {};
        const nowISO = new Date().toISOString();
        for (const g of toClaim){
          updates[`/groups/${g.key}/status`] = "claimed";
          updates[`/groups/${g.key}/claimed_by`] = claimer;
          updates[`/groups/${g.key}/claimed_at`] = nowISO;
        }
        await update(ref(db), updates);
        return toClaim;
      }catch(e){
        console.error("fetchAndClaimTwoGroups error:", e);
        return [];
      }
    }
    function formatUsernames(groups){
      const all = [];
      for (const g of groups){
        const arr = Array.isArray(g.data.usernames) ? g.data.usernames : [];
        for (const u of arr){
          if (!u) continue;
          all.push(u.startsWith("@") ? u : `@${u}`);
        }
      }
      return all.join(" ");
    }
    function typeText(element, fullText, speedMs = 12){
      return new Promise(resolve => {
        element.value = "";
        let i = 0;
        const timer = setInterval(() => {
          element.value += fullText[i] ?? "";
          element.scrollTop = element.scrollHeight;
          i++;
          if (i >= fullText.length){
            clearInterval(timer);
            resolve();
          }
        }, speedMs);
      });
    }

    // Program 1: generate/copy
    generateBtn?.addEventListener("click", async () => {
      setStatus("Fetching usernames...");
      generateBtn.disabled = true;
      copyBtn.disabled = true;
      tweetBlock.classList.remove("hidden");
      tweetText.value = "";

      const claimed = await fetchAndClaimTwoGroups("dashboard");
      if (claimed.length === 0){
        setStatus("Not enough available groups right now. Please try again later.");
        generateBtn.disabled = false;
        return;
      }

      const mentionList = formatUsernames(claimed);
      const fallback = "user1 user2 user3";
      const tweet = `Hi ${mentionList || fallback} you are eligible for 5 Billion free NFTFAN tokens from @nftfanstoken — submit your wallet here: https://www.nftfanstoken.com/smt/`;

      setStatus("Generating tweet...");
      await typeText(tweetText, tweet, 12);
      setStatus("");
      copyBtn.disabled = false;
      generateBtn.disabled = false;
    });

    copyBtn?.addEventListener("click", async () => {
      if (!tweetText.value) return;
      try{
        await navigator.clipboard.writeText(tweetText.value);
        copyBtn.textContent = "Copied!";
        setTimeout(()=> copyBtn.textContent = "Copy Tweet", 1200);
      }catch{
        tweetText.select();
        document.execCommand("copy");
        copyBtn.textContent = "Copied!";
        setTimeout(()=> copyBtn.textContent = "Copy Tweet", 1200);
      }
    });

    // Program 1: submit proof and live list
    submitProofBtn?.addEventListener("click", async () => {
      const url = (proofUrlInput.value || "").trim();
      if (!isLikelyUrl(url)){
        proofStatusEl.textContent = "Please enter a valid URL.";
        return;
      }
      submitProofBtn.disabled = true;
      proofStatusEl.textContent = "Verifying";
      try{
        const listRef = ref(db, "submissions");
        const newRef = push(listRef);
        const payload = { url, status: "Verifying", submitted_at: new Date().toISOString() };
        await set(newRef, payload);
        proofStatusEl.textContent = "Verifying";
        proofUrlInput.value = "";
      }catch(e){
        console.error("Submit proof error:", e);
        proofStatusEl.textContent = "Failed to submit. Please try again.";
      }finally{
        submitProofBtn.disabled = false;
      }
    });

    function renderSubmissions(valObj){
      const items = Object.entries(valObj || {}).map(([id, v]) => ({ id, ...(v || {}) }));
      items.sort((a, b) => Date.parse(b.submitted_at || 0) - Date.parse(a.submitted_at || 0));

      if (applicantsCountEl) applicantsCountEl.textContent = String(items.length);

      if (items.length === 0){
        submissionsListEl.innerHTML = `
          <li class="item">
            <span class="item__link" style="color:var(--muted)">No submissions yet.</span>
          </li>`;
        return;
      }
      const html = items.slice(0, 10).map(item => {
        const url = item.url || "";
        const rawStatus = item.status || "Verifying";
        const st = String(rawStatus).toLowerCase();
        const cls = st === "accepted" ? "accepted" : st === "rejected" ? "rejected" : "verifying";
        const safe = url.replace(/"/g, "&quot;");
        return `
          <li class="item">
            <a class="item__link" href="${safe}" target="_blank" rel="noopener noreferrer">${safe}</a>
            <span class="badge badge--${cls}">${rawStatus}</span>
          </li>
        `;
      }).join("");
      submissionsListEl.innerHTML = html;
    }
    onValue(ref(db, "submissions"), (snap) => renderSubmissions(snap.val()));

    // Program 2 (Community): generate/copy
    generateCommunityBtn?.addEventListener("click", async () => {
      setStatusCommunity("Fetching usernames...");
      generateCommunityBtn.disabled = true;
      copyCommunityBtn.disabled = true;
      tweetBlockCommunity.classList.remove("hidden");
      tweetTextCommunity.value = "";

      const claimed = await fetchAndClaimTwoGroups("dashboard_community");
      if (claimed.length === 0){
        setStatusCommunity("Not enough available groups right now. Please try again later.");
        generateCommunityBtn.disabled = false;
        return;
      }

      const mentionList = formatUsernames(claimed);
      const fallback = "friends";
      const tweet = `Hi ${mentionList || fallback} Go to this link: https://www.nftfanstoken.com/tasks , Complete a task and win 100 Billion Free $NFTFAN tokens`;

      setStatusCommunity("Generating tweet...");
      await typeText(tweetTextCommunity, tweet, 12);
      setStatusCommunity("");
      copyCommunityBtn.disabled = false;
      generateCommunityBtn.disabled = false;
    });

    copyCommunityBtn?.addEventListener("click", async () => {
      if (!tweetTextCommunity.value) return;
      try{
        await navigator.clipboard.writeText(tweetTextCommunity.value);
        copyCommunityBtn.textContent = "Copied!";
        setTimeout(()=> copyCommunityBtn.textContent = "Copy Tweet", 1200);
      }catch{
        tweetTextCommunity.select();
        document.execCommand("copy");
        copyCommunityBtn.textContent = "Copied!";
        setTimeout(()=> copyCommunityBtn.textContent = "Copy Tweet", 1200);
      }
    });

    // Program 2 (Community): submit proof and count
    submitProofCommunityBtn?.addEventListener("click", async () => {
      const url = (proofUrlCommunityInput.value || "").trim();
      if (!isLikelyUrl(url)){
        proofStatusCommunityEl.textContent = "Please enter a valid URL.";
        return;
      }
      submitProofCommunityBtn.disabled = true;
      proofStatusCommunityEl.textContent = "Verifying";
      try{
        const listRef = ref(db, "submissions_community");
        const newRef = push(listRef);
        const payload = { url, status: "Verifying", submitted_at: new Date().toISOString() };
        await set(newRef, payload);
        proofStatusCommunityEl.textContent = "Verifying";
        proofUrlCommunityInput.value = "";
      }catch(e){
        console.error("Submit community proof error:", e);
        proofStatusCommunityEl.textContent = "Failed to submit. Please try again.";
      }finally{
        submitProofCommunityBtn.disabled = false;
      }
    });

    onValue(ref(db, "submissions_community"), (snap) => {
      const items = Object.entries(snap.val() || {}).map(([id, v]) => ({ id, ...(v||{}) }));
      if (applicantsCountCommunityEl) applicantsCountCommunityEl.textContent = String(items.length);
    });

    // Program 3: Mention Task (cooldown without login/graphs)
    const MENTION_COOLDOWN_MIN = 20; // minutes
    const MENTION_COOLDOWN_KEY = "mention_last_ts";

    function getMentionLastTs(){
      const v = Number(localStorage.getItem(MENTION_COOLDOWN_KEY) || 0);
      return Number.isFinite(v) ? v : 0;
    }
    function setMentionLastTs(ms){
      localStorage.setItem(MENTION_COOLDOWN_KEY, String(ms));
    }
    function secondsLeftForMention(){
      const last = getMentionLastTs();
      if (!last) return 0;
      const elapsed = Date.now() - last;
      const total = MENTION_COOLDOWN_MIN * 60 * 1000;
      const left = Math.ceil((total - elapsed)/1000);
      return Math.max(0, left);
    }
    function fmtTime(sec){
      const m = Math.floor(sec/60).toString().padStart(2, "0");
      const s = Math.floor(sec%60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    let mentionTimerId = null;
    function startMentionCooldownTimer(){
      const leftInit = secondsLeftForMention();
      if (leftInit <= 0){
        mentionCooldownWrap.classList.add("hidden");
        generateMentionBtn.disabled = false;
        return;
      }
      generateMentionBtn.disabled = true;
      mentionCooldownWrap.classList.remove("hidden");
      setText(mentionCooldownTimer, fmtTime(leftInit));

      clearInterval(mentionTimerId);
      let left = leftInit;
      mentionTimerId = setInterval(() => {
        left -= 1;
        if (left <= 0){
          clearInterval(mentionTimerId);
          mentionCooldownWrap.classList.add("hidden");
          generateMentionBtn.disabled = false;
          return;
        }
        setText(mentionCooldownTimer, fmtTime(left));
      }, 1000);
    }

    // Mention: event handlers
    generateMentionBtn?.addEventListener("click", async () => {
      // Cooldown gate
      const left = secondsLeftForMention();
      if (left > 0){
        // Show/refresh cooldown timer and block generation
        startMentionCooldownTimer();
        return;
      }

      statusMentionEl.textContent = "Fetching groups...";
      generateMentionBtn.disabled = true;
      copyMentionBtn.disabled = true;
      postMentionBtn.disabled = true;
      tweetBlockMention.classList.remove("hidden");
      tweetTextMention.value = "";

      const claimed = await fetchAndClaimTwoGroups("mention_task");
      if (claimed.length < 2){
        statusMentionEl.textContent = "Not enough available groups right now. Please try again later.";
        generateMentionBtn.disabled = false;
        return;
      }

      const allUsernames = formatUsernames(claimed);
      const tweet = `Hello, ${allUsernames} I have mentioned you to claim 5B free $NFTFAN token by @nftfanstoken at this link: https://www.nftfanstoken.com/nftzz/ I used this url to invite you: https://www.nftfanstoken.com/tasks`;

      statusMentionEl.textContent = "Generating tweet...";
      await typeText(tweetTextMention, tweet, 12);
      statusMentionEl.textContent = "Tweet ready.";

      // Enable copy/post, keep generation disabled while cooldown runs
      copyMentionBtn.disabled = false;
      postMentionBtn.disabled = false;

      // Start cooldown
      setMentionLastTs(Date.now());
      startMentionCooldownTimer();
    });

    copyMentionBtn?.addEventListener("click", async () => {
      const txt = tweetTextMention.value.trim();
      if (!txt) return;
      try{
        await navigator.clipboard.writeText(txt);
        copyMentionBtn.textContent = "Copied!";
        setTimeout(()=> copyMentionBtn.textContent = "Copy Text", 1200);
      }catch{
        tweetTextMention.select();
        document.execCommand("copy");
        copyMentionBtn.textContent = "Copied!";
        setTimeout(()=> copyMentionBtn.textContent = "Copy Text", 1200);
      }
    });

    postMentionBtn?.addEventListener("click", () => {
      const txt = tweetTextMention.value.trim();
      if (!txt) return;
      const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(txt)}`;
      window.open(url, "_blank", "noopener");
    });

    // Initial render with fallbacks
    (function primeUI(){
      setText("#activePools", formatNumber(FALLBACK.ACTIVE_POOLS));

      // Funds and headers
      (function(){
        const usd = FALLBACK.FUNDS_TOKEN_AVAILABLE * FALLBACK.TOKEN_TO_USD;
        setText("#fundsAvailable", formatMoney(usd));
        setText("#fundsAvailableToken", `= ${formatNumber(FALLBACK.FUNDS_TOKEN_AVAILABLE)} NFTFAN`);
      })();

      (function(){
        setText("#earnUpTo", formatNumber(FALLBACK.EARN_UP_TO_TOKENS));
        setText("#earnUnit", "NFTFAN");
        setText("#earnUpToCommunity", formatNumber(FALLBACK.EARN_UP_TO_TOKENS_COMMUNITY));
        setText("#earnUnitCommunity", "NFTFAN");
      })();

      try {
        const d1 = new Date(FALLBACK.DEADLINE_ISO);
        setText("#deadline", d1.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" }));
        const d2 = new Date(FALLBACK.DEADLINE_COMMUNITY_ISO);
        setText("#deadlineCommunity", d2.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" }));
      } catch {}

      // Prime mention cooldown UI on load
      startMentionCooldownTimer();
    })();
  </script>
</body>
</html>
