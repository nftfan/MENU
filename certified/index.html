<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NFTFANS CERTIFIED WALLETS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="icon" href="https://i.imgur.com/ODP45iQ.png" type="image/png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --background: #181B22;
      --card-bg: #222630;
      --input-bg: #232733;
      --accent: #86A8E7;
      --accent2: #91EAE4;
      --accent3: #4F5B77;
      --text: #F3F6FB;
      --muted: #A2A9B7;
      --error: #FF6565;
      --success: #65FF9B;
      
      /* Certification level colors */
      --diamond: #B9F2FF;
      --platinum: #E5E4E2;
      --gold: #FFD700;
      --silver: #C0C0C0;
      --bronze: #CD7F32;
      --super: #FFA500;
      --active: #9370DB;
      --basic: #708090;
      
      --radius: 8px;
      --shadow: 0 2px 8px 0 rgba(20,24,36,0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--background);
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
      width: 100%;
      font-size: 10px;
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.8rem 0.5rem;
    }

    .container {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 0.7rem;
      max-width: 320px;
      width: 100%;
      margin-bottom: 0.7rem;
      text-align: center;
    }

    .logo {
      width: 18px;
      height: 18px;
      display: block;
      margin: 0 auto 0.2rem;
      border-radius: 50%;
    }

    h1 {
      font-size: 10px;
      font-weight: 700;
      margin: 0.2rem 0 0.6rem;
      letter-spacing: 0.02em;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
    }

    .certification-form {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-bottom: 0.7rem;
    }

    .input-row {
      display: flex;
      gap: 0.4rem;
      align-items: center;
    }

    input[type="text"] {
      background: var(--input-bg);
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.5rem;
      color: var(--text);
      font-size: 9px;
      outline: none;
      flex: 1;
      min-width: 0;
      transition: background 0.2s;
    }

    input[type="text"]:focus {
      background: #262b3a;
    }

    button {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color: #181B22;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.5rem;
      font-weight: 700;
      font-size: 9px;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: filter 0.18s;
      box-shadow: 0 1px 3px 0 rgba(134,168,231,0.10);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
    }

    button:active {
      filter: brightness(0.95);
    }

    .material-icons {
      font-size: 9px;
    }

    #result {
      margin-top: 0.4rem;
      font-size: 8px;
      min-height: 1.2rem;
      word-break: break-all;
      padding: 0.3rem;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .error {
      color: var(--error) !important;
      background-color: rgba(255, 101, 101, 0.1);
    }

    .success {
      color: var(--success) !important;
      background-color: rgba(101, 255, 155, 0.1);
    }

    .table-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 0.7rem;
      max-width: 320px;
      width: 100%;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 10px;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .table-wrapper {
      overflow-x: auto;
      max-width: 100%;
      margin-bottom: 0.3rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    th, td {
      padding: 0.4rem 0.3rem;
      text-align: left;
      border-bottom: 1px solid rgba(145, 234, 228, 0.08);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    th {
      font-weight: 700;
      color: var(--accent2);
      cursor: pointer;
      user-select: none;
      position: relative;
      font-size: 8px;
      letter-spacing: -0.02em;
    }

    td {
      font-size: 8px;
      letter-spacing: -0.01em;
    }

    th:hover {
      background-color: rgba(145, 234, 228, 0.05);
    }

    th .material-icons {
      font-size: 7px;
      vertical-align: middle;
      margin-left: 0.1rem;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background-color: rgba(145, 234, 228, 0.05);
    }

    .wallet-address {
      font-family: monospace;
      font-size: 7px;
      width: 30%;
    }

    .level-badge {
      display: flex;
      align-items: center;
      gap: 0.15rem;
      width: 22%;
    }

    .level-badge .material-icons {
      font-size: 7px;
      min-width: 7px;
    }
    
    .level-badge span:last-child {
      font-size: 7px;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .level-diamond { color: var(--diamond); }
    .level-platinum { color: var(--platinum); }
    .level-gold { color: var(--gold); }
    .level-silver { color: var(--silver); }
    .level-bronze { color: var(--bronze); }
    .level-super { color: var(--super); }
    .level-active { color: var(--active); }
    .level-basic { color: var(--basic); }

    .balance {
      font-weight: 700;
      color: var(--accent2);
      width: 23%;
      text-align: right;
      padding-right: 0.5rem;
    }

    .timestamp {
      color: var(--muted);
      width: 25%;
      font-size: 7px;
    }

    .empty-table {
      padding: 0.8rem;
      text-align: center;
      color: var(--muted);
      font-size: 8px;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    .loading {
      animation: pulse 1.5s infinite;
    }

    .search-box {
      position: relative;
      max-width: 110px;
      flex: 1;
    }

    .search-box input {
      padding-left: 1.6rem;
      width: 100%;
    }

    .search-box .material-icons {
      position: absolute;
      left: 0.4rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 7px;
      color: var(--muted);
      margin-top: 0.3rem;
      background: rgba(145, 234, 228, 0.03);
      padding: 0.25rem 0.4rem;
      border-radius: 4px;
    }

    .user-info span {
      display: flex;
      align-items: center;
      gap: 0.2rem;
    }
    
    .user-info .material-icons {
      font-size: 7px;
    }

    .certification-levels {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.2rem 0.1rem;
      margin: 0.4rem 0;
      padding: 0.35rem 0.3rem;
      background: rgba(145, 234, 228, 0.03);
      border-radius: 4px;
    }

    .level-item {
      display: flex;
      align-items: center;
      gap: 0.15rem;
      font-size: 6px;
      padding: 0.1rem 0.15rem;
      border-radius: 3px;
    }
    
    .level-item .material-icons {
      font-size: 6px;
    }

    /* Table row styling based on certification level */
    tr.row-diamond { background-color: rgba(185, 242, 255, 0.03); }
    tr.row-platinum { background-color: rgba(229, 228, 226, 0.03); }
    tr.row-gold { background-color: rgba(255, 215, 0, 0.03); }
    tr.row-silver { background-color: rgba(192, 192, 192, 0.02); }
    tr.row-bronze { background-color: rgba(205, 127, 50, 0.02); }

    /* Sparkle animation for diamond level */
    @keyframes sparkle {
      0% { opacity: 0.4; }
      50% { opacity: 1; }
      100% { opacity: 0.4; }
    }

    .sparkle {
      position: relative;
    }

    .sparkle::after {
      content: "âœ¦";
      position: absolute;
      top: -2px;
      right: -2px;
      font-size: 6px;
      animation: sparkle 1.5s infinite;
      color: var(--diamond);
    }
    
    .kt-unit {
      color: var(--muted);
      font-size: 6px;
      margin-left: 1px;
    }
    
    .footer-note {
      font-size: 6px;
      color: var(--muted);
      text-align: center;
      margin-top: 0.3rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="logo" src="https://i.imgur.com/ODP45iQ.png" alt="NFTFAN Logo" />
    <h1>
      <span>NFTFANS CERTIFICATION</span>
      <span class="material-icons">verified</span>
    </h1>

    <div class="certification-form">
      <div class="input-row">
        <input type="text" id="wallet" placeholder="Enter your wallet address (0x...)" maxlength="42" autocomplete="off" inputmode="text"/>
      </div>
      <button type="button" id="certify-btn" onclick="certifyWallet()">
        <span class="material-icons">shield</span>
        <span>CERTIFY WALLET</span>
      </button>
    </div>
    <div id="result"></div>
    <div class="user-info">
      <span>
        <span class="material-icons">person</span>
        NFTFANS TOKEN HOLDERS
      </span>
      <span>
        <span class="material-icons">schedule</span>
        2025-08-12 19:13:34
      </span>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h2>CERTIFIED WALLETS</h2>
      <div class="search-box">
        <span class="material-icons">search</span>
        <input type="text" id="search" placeholder="Search..." oninput="filterWallets()" inputmode="text">
      </div>
    </div>
    
    <div class="certification-levels">
      <div class="level-item level-diamond">
        <span class="material-icons">diamond</span> Diamond (100+ KT)
      </div>
      <div class="level-item level-platinum">
        <span class="material-icons">auto_awesome</span> Platinum (50-100 KT)
      </div>
      <div class="level-item level-gold">
        <span class="material-icons">stars</span> Gold (10-50 KT)
      </div>
      <div class="level-item level-silver">
        <span class="material-icons">star</span> Silver (5-10 KT)
      </div>
      <div class="level-item level-bronze">
        <span class="material-icons">workspace_premium</span> Bronze (1-5 KT)
      </div>
    </div>
    
    <div class="table-wrapper">
      <table id="wallets-table">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Wallet <span class="material-icons">unfold_more</span></th>
            <th onclick="sortTable(1)">Level</th>
            <th onclick="sortTable(2)" style="text-align:right">Balance <span class="material-icons">unfold_more</span></th>
            <th onclick="sortTable(3)">Date</th>
          </tr>
        </thead>
        <tbody id="wallets-tbody">
          <tr>
            <td colspan="4" class="empty-table">
              <div class="loading">Loading certified wallets...</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="footer-note">1 KT = 1,000,000,000,000,000 NFTFAN tokens</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCYSOx_niWPHLDisCjAQzK8UJSe5TfwtLI",
      authDomain: "nftfanactive.firebaseapp.com",
      databaseURL: "https://nftfanactive-default-rtdb.firebaseio.com",
      projectId: "nftfanactive",
      storageBucket: "nftfanactive.appspot.com",
      messagingSenderId: "311309982791",
      appId: "1:311309982791:web:3e55bba6b78feb57ea6562",
      measurementId: "G-3TRDL9749N"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Constants
    const tokenAddress = "0x2017Fcaea540d2925430586DC92818035Bfc2F50";
    const apiKey = "3AFN3ZU4ANK3XEUJQ6BRJCBCITAFHKFVTV";
    let certifiedWallets = [];
    let currentSortColumn = 2; // Default sort by balance
    let currentSortDirection = "desc"; // Default sort direction
    
    // KT conversion constant
    const KT_VALUE = 1000000000000000; // 1 KT = 10^15
    
    // Certification levels thresholds (in KT)
    const LEVELS = {
      DIAMOND: { min: 100, icon: 'diamond', name: 'Diamond' },
      PLATINUM: { min: 50, icon: 'auto_awesome', name: 'Platinum' },
      GOLD: { min: 10, icon: 'stars', name: 'Gold' },
      SILVER: { min: 5, icon: 'star', name: 'Silver' },
      BRONZE: { min: 1, icon: 'workspace_premium', name: 'Bronze' },
      SUPER: { min: 0.5, icon: 'moving', name: 'Super' },
      ACTIVE: { min: 0.001, icon: 'bolt', name: 'Active' },
      BASIC: { min: 0, icon: 'person', name: 'Basic' }
    };

    // Prevent zoom on input focus for iOS
    document.addEventListener('touchstart', function(event) {
      if (event.target.tagName === 'INPUT') {
        event.target.style.fontSize = '16px';
      }
    });
    
    document.addEventListener('touchend', function(event) {
      if (event.target.tagName === 'INPUT') {
        event.target.style.fontSize = '';
      }
    });

    // Validate ETH address format
    function validateEthAddress(addr) {
      return /^0x[a-fA-F0-9]{40}$/.test(addr);
    }

    // Format KT with proper decimal places
    function formatKT(tokens) {
      const kt = tokens / KT_VALUE;
      
      if (kt >= 1000) {
        return kt.toLocaleString(undefined, {maximumFractionDigits: 1});
      } else if (kt >= 100) {
        return kt.toLocaleString(undefined, {maximumFractionDigits: 2});
      } else if (kt >= 10) {
        return kt.toLocaleString(undefined, {maximumFractionDigits: 3});
      } else if (kt >= 1) {
        return kt.toLocaleString(undefined, {maximumFractionDigits: 4});
      } else {
        return kt.toLocaleString(undefined, {maximumSignificantDigits: 3});
      }
    }

    // Shorten wallet address for display
    function shortenAddress(address) {
      return address.substring(0, 4) + "..." + address.substring(address.length - 4);
    }

    // Format timestamp to readable date
    function formatDate(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleDateString('en-US', {
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }).replace(',', '');
    }

    // Get current timestamp in UTC
    function getCurrentTimestamp() {
      return new Date().toISOString();
    }
    
    // Get certification level based on balance in KT
    function getCertificationLevel(balanceKT) {
      if (balanceKT >= LEVELS.DIAMOND.min) return LEVELS.DIAMOND;
      if (balanceKT >= LEVELS.PLATINUM.min) return LEVELS.PLATINUM;
      if (balanceKT >= LEVELS.GOLD.min) return LEVELS.GOLD;
      if (balanceKT >= LEVELS.SILVER.min) return LEVELS.SILVER;
      if (balanceKT >= LEVELS.BRONZE.min) return LEVELS.BRONZE;
      if (balanceKT >= LEVELS.SUPER.min) return LEVELS.SUPER;
      if (balanceKT >= LEVELS.ACTIVE.min) return LEVELS.ACTIVE;
      return LEVELS.BASIC;
    }

    // Check wallet balance and certify
    async function certifyWallet() {
      const wallet = document.getElementById("wallet").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.className = "";
      
      // Validate wallet address
      if (!wallet) {
        resultDiv.textContent = "Please enter a wallet address.";
        resultDiv.className = "error";
        return;
      }
      
      if (!validateEthAddress(wallet)) {
        resultDiv.textContent = "Invalid wallet address format.";
        resultDiv.className = "error";
        return;
      }
      
      // Show loading state
      const certifyBtn = document.getElementById("certify-btn");
      const originalBtnText = certifyBtn.innerHTML;
      certifyBtn.innerHTML = `<span class="material-icons">hourglass_top</span><span>Processing...</span>`;
      certifyBtn.disabled = true;
      resultDiv.textContent = "Checking balance...";
      resultDiv.className = "loading";
      
      try {
        // Check token balance via Polygonscan API
        const url = `https://api.polygonscan.com/api?module=account&action=tokenbalance&contractaddress=${tokenAddress}&address=${wallet}&tag=latest&apikey=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === "1") {
          const decimals = 18;
          const balance = Number(data.result) / 10 ** decimals;
          const balanceKT = balance / KT_VALUE;
          const timestamp = getCurrentTimestamp();
          const level = getCertificationLevel(balanceKT);
          
          // Save wallet data to Firebase
          const walletRef = db.ref('certified-wallets/' + wallet.toLowerCase());
          
          walletRef.once('value').then((snapshot) => {
            // Check if wallet already exists
            if (snapshot.exists()) {
              // Update existing wallet
              walletRef.update({
                balance: balance,
                balanceKT: balanceKT,
                level: level.name,
                lastUpdated: timestamp
              }).then(() => {
                resultDiv.textContent = `Re-certified as ${level.name}! Balance: ${formatKT(balance)} KT`;
                resultDiv.className = "success";
                loadCertifiedWallets(); // Reload table
              });
            } else {
              // Create new wallet entry
              walletRef.set({
                address: wallet.toLowerCase(),
                balance: balance,
                balanceKT: balanceKT,
                level: level.name,
                certified: true,
                certifiedAt: timestamp,
                lastUpdated: timestamp
              }).then(() => {
                resultDiv.textContent = `Certified as ${level.name}! Balance: ${formatKT(balance)} KT`;
                resultDiv.className = "success";
                loadCertifiedWallets(); // Reload table
              });
            }
          }).catch(error => {
            console.error("Firebase error:", error);
            resultDiv.textContent = `Error: ${error.message}`;
            resultDiv.className = "error";
          });
        } else {
          resultDiv.textContent = "Error fetching token balance.";
          resultDiv.className = "error";
        }
      } catch (error) {
        console.error("API error:", error);
        resultDiv.textContent = "Network error. Please try again.";
        resultDiv.className = "error";
      } finally {
        // Restore button state
        certifyBtn.innerHTML = originalBtnText;
        certifyBtn.disabled = false;
      }
    }
    
    // Load certified wallets from Firebase
    function loadCertifiedWallets() {
      const walletsRef = db.ref('certified-wallets');
      const tbody = document.getElementById("wallets-tbody");
      
      // Show loading state
      tbody.innerHTML = `
        <tr>
          <td colspan="4" class="empty-table">
            <div class="loading">Loading certified wallets...</div>
          </td>
        </tr>
      `;
      
      walletsRef.once('value').then((snapshot) => {
        certifiedWallets = [];
        
        snapshot.forEach((childSnapshot) => {
          const walletData = childSnapshot.val();
          
          // Calculate balanceKT if not already set
          if (!walletData.balanceKT) {
            walletData.balanceKT = walletData.balance / KT_VALUE;
          }
          
          // Calculate level if not already set
          if (!walletData.level) {
            walletData.level = getCertificationLevel(walletData.balanceKT).name;
          }
          
          certifiedWallets.push(walletData);
        });
        
        if (certifiedWallets.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="4" class="empty-table">
                No certified wallets found yet
              </td>
            </tr>
          `;
        } else {
          // Sort wallets by default (balance desc)
          sortTable(currentSortColumn, true);
        }
      }).catch(error => {
        console.error("Error loading wallets:", error);
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="empty-table error">
              Error loading wallets
            </td>
          </tr>
        `;
      });
    }
    
    // Sort the wallets table
    function sortTable(columnIndex, skipDirectionToggle = false) {
      if (!skipDirectionToggle) {
        // Toggle sort direction if clicking the same column
        if (currentSortColumn === columnIndex) {
          currentSortDirection = currentSortDirection === "asc" ? "desc" : "asc";
        } else {
          currentSortColumn = columnIndex;
          currentSortDirection = "desc"; // Default to descending
        }
      }
      
      // Sort the wallets array based on column and direction
      certifiedWallets.sort((a, b) => {
        let valueA, valueB;
        
        switch (columnIndex) {
          case 0: // Wallet address
            valueA = a.address.toLowerCase();
            valueB = b.address.toLowerCase();
            break;
          case 1: // Level
            // Order by level priority
            const levelOrder = {
              'Diamond': 8,
              'Platinum': 7,
              'Gold': 6,
              'Silver': 5,
              'Bronze': 4,
              'Super': 3,
              'Active': 2,
              'Basic': 1
            };
            valueA = levelOrder[a.level] || 0;
            valueB = levelOrder[b.level] || 0;
            break;
          case 2: // Balance
            valueA = parseFloat(a.balanceKT || a.balance / KT_VALUE);
            valueB = parseFloat(b.balanceKT || b.balance / KT_VALUE);
            break;
          case 3: // Certified date
            valueA = new Date(a.certifiedAt).getTime();
            valueB = new Date(b.certifiedAt).getTime();
            break;
          default:
            return 0;
        }
        
        if (currentSortDirection === "asc") {
          return valueA > valueB ? 1 : valueA < valueB ? -1 : 0;
        } else {
          return valueA < valueB ? 1 : valueA > valueB ? -1 : 0;
        }
      });
      
      // Update table with sorted data
      renderWalletsTable(certifiedWallets);
      
      // Update sorting indicators in table headers
      const headers = document.querySelectorAll('th');
      headers.forEach((header, index) => {
        if (index === columnIndex) {
          const icon = currentSortDirection === "asc" ? "arrow_upward" : "arrow_downward";
          header.querySelector('.material-icons').textContent = icon;
        } else if (header.querySelector('.material-icons')) {
          header.querySelector('.material-icons').textContent = "unfold_more";
        }
      });
    }
    
    // Get level details by name
    function getLevelDetails(levelName) {
      for (const key in LEVELS) {
        if (LEVELS[key].name === levelName) {
          return LEVELS[key];
        }
      }
      return LEVELS.BASIC; // Default to basic if not found
    }
    
    // Render the wallets table
    function renderWalletsTable(wallets) {
      const tbody = document.getElementById("wallets-tbody");
      tbody.innerHTML = "";
      
      wallets.forEach(wallet => {
        const tr = document.createElement("tr");
        const balanceKT = wallet.balanceKT || wallet.balance / KT_VALUE;
        const level = wallet.level || getCertificationLevel(balanceKT).name;
        const levelDetails = getLevelDetails(level);
        
        // Add class based on level
        tr.className = `row-${level.toLowerCase()}`;
        
        // Wallet address
        const tdAddress = document.createElement("td");
        tdAddress.className = "wallet-address";
        tdAddress.textContent = shortenAddress(wallet.address);
        tdAddress.title = wallet.address;
        
        // Level
        const tdLevel = document.createElement("td");
        tdLevel.className = `level-badge level-${level.toLowerCase()}`;
        
        // Special styling for diamond level
        if (level === 'Diamond') {
          tdLevel.classList.add('sparkle');
        }
        
        tdLevel.innerHTML = `
          <span class="material-icons">${levelDetails.icon}</span>
          <span>${level}</span>
        `;
        
        // Balance (in KT)
        const tdBalance = document.createElement("td");
        tdBalance.className = "balance";
        tdBalance.innerHTML = `${formatKT(wallet.balance)}<span class="kt-unit">KT</span>`;
        
        // Timestamp
        const tdTimestamp = document.createElement("td");
        tdTimestamp.className = "timestamp";
        tdTimestamp.textContent = formatDate(wallet.certifiedAt);
        tdTimestamp.title = new Date(wallet.certifiedAt).toLocaleString();
        
        tr.appendChild(tdAddress);
        tr.appendChild(tdLevel);
        tr.appendChild(tdBalance);
        tr.appendChild(tdTimestamp);
        tbody.appendChild(tr);
      });
    }
    
    // Filter wallets by search term
    function filterWallets() {
      const searchTerm = document.getElementById("search").value.toLowerCase();
      
      if (!searchTerm) {
        // If search is empty, show all wallets
        renderWalletsTable(certifiedWallets);
        return;
      }
      
      // Filter wallets by address or level
      const filteredWallets = certifiedWallets.filter(wallet => 
        wallet.address.toLowerCase().includes(searchTerm) ||
        (wallet.level && wallet.level.toLowerCase().includes(searchTerm))
      );
      
      if (filteredWallets.length === 0) {
        const tbody = document.getElementById("wallets-tbody");
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="empty-table">
              No results for "${searchTerm}"
            </td>
          </tr>
        `;
      } else {
        renderWalletsTable(filteredWallets);
      }
    }
    
    // Handle Enter key in wallet input
    document.getElementById("wallet").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        certifyWallet();
      }
    });
    
    // Load wallets when page loads
    document.addEventListener("DOMContentLoaded", function() {
      loadCertifiedWallets();
    });
  </script>
</body>
</html>
