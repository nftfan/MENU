<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFTFan Token Sale</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.5.0/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff41;
            min-height: 100vh;
            font-size: 10px;
            line-height: 1.4;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 65, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 150, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 150, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 100%;
            padding: 10px;
            margin: 0;
        }

        .title {
            text-align: center;
            font-size: 18px;
            margin-bottom: 5px;
            color: #ff0080;
            text-shadow: 0 0 10px #ff0080, 0 0 20px #ff0080;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .subtitle {
            text-align: center;
            color: #00ccff;
            margin-bottom: 15px;
            font-size: 10px;
            text-shadow: 0 0 5px #00ccff;
        }

        .card {
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid #00ff41;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 
                0 0 10px rgba(0, 255, 65, 0.3),
                inset 0 0 10px rgba(0, 255, 65, 0.1);
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, #00ff41, #ff0080, #00ccff, #00ff41);
            border-radius: 8px;
            z-index: -1;
            opacity: 0.3;
            animation: borderGlow 3s linear infinite;
        }

        @keyframes borderGlow {
            0% { opacity: 0.3; }
            50% { opacity: 0.7; }
            100% { opacity: 0.3; }
        }

        @keyframes neonPulse {
            0%, 100% { 
                box-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
            }
            50% { 
                box-shadow: 0 0 2px currentColor, 0 0 5px currentColor, 0 0 8px currentColor;
            }
        }

        .balance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(0, 255, 65, 0.05);
            border-left: 2px solid #00ff41;
            font-size: 10px;
        }

        .balance-label {
            font-weight: bold;
            color: #00ccff;
        }

        .balance-value {
            font-weight: bold;
            color: #ff0080;
            text-shadow: 0 0 5px #ff0080;
        }

        .button {
            width: 100%;
            padding: 12px;
            border: 1px solid;
            border-radius: 6px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            position: relative;
            background: rgba(0, 0, 0, 0.8);
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .button:hover:not(:disabled) {
            animation: neonPulse 1s infinite;
            transform: translateY(-1px);
        }

        .button:active:not(:disabled) {
            transform: translateY(1px);
        }

        .button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            animation: none;
        }

        .connect-btn {
            color: #ff0080;
            border-color: #ff0080;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .switch-btn {
            color: #00ccff;
            border-color: #00ccff;
            box-shadow: 0 0 10px rgba(0, 204, 255, 0.3);
        }

        .send-btn {
            color: #00ff41;
            border-color: #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
        }

        .refresh-btn {
            color: #ffaa00;
            border-color: #ffaa00;
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }

        .input-group {
            margin-bottom: 10px;
        }

        .input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #00ccff;
            font-size: 10px;
            text-shadow: 0 0 5px #00ccff;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #00ff41;
            border-radius: 4px;
            background: rgba(0, 20, 40, 0.9);
            color: #00ff41;
            font-size: 10px;
            font-family: 'Courier New', monospace;
            box-shadow: 
                0 0 5px rgba(0, 255, 65, 0.3),
                inset 0 0 5px rgba(0, 255, 65, 0.1);
        }

        .input-field::placeholder {
            color: rgba(0, 255, 65, 0.5);
        }

        .input-field:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
        }

        .contract-info {
            text-align: center;
            background: rgba(0, 204, 255, 0.1);
            border: 1px solid #00ccff;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 9px;
            color: #00ccff;
        }

        .contract-address {
            font-family: 'Courier New', monospace;
            color: #ff0080;
            font-weight: bold;
            word-break: break-all;
            margin: 5px 0;
            text-shadow: 0 0 5px #ff0080;
        }

        .status {
            text-align: center;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 10px;
            border: 1px solid;
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }

        .success {
            background: rgba(0, 255, 65, 0.1);
            color: #00ff41;
            border-color: #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
        }

        .info {
            background: rgba(0, 204, 255, 0.1);
            color: #00ccff;
            border-color: #00ccff;
            box-shadow: 0 0 10px rgba(0, 204, 255, 0.3);
        }

        .network-warning {
            background: rgba(255, 165, 0, 0.1);
            color: #ffaa00;
            border-color: #ffaa00;
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(0, 255, 65, 0.3);
            border-radius: 50%;
            border-top-color: #00ff41;
            animation: spin 1s linear infinite;
            margin-right: 5px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .processing-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .processing-content {
            background: rgba(0, 20, 40, 0.95);
            border: 2px solid #00ff41;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
            max-width: 90%;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 65, 0.3);
            border-radius: 50%;
            border-top-color: #00ff41;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .processing-content h3 {
            color: #ff0080;
            font-size: 12px;
            margin-bottom: 5px;
            text-shadow: 0 0 10px #ff0080;
        }

        .processing-content p {
            color: #00ccff;
            font-size: 10px;
        }

        .hidden {
            display: none;
        }

        .wallet-address {
            font-size: 9px;
            word-break: break-all;
            color: #00ff41;
        }

        .section-title {
            color: #ff0080;
            font-size: 12px;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 5px #ff0080;
        }

        .glitch {
            position: relative;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch::before {
            animation: glitch-1 0.5s infinite;
            color: #ff0080;
        }

        .glitch::after {
            animation: glitch-2 0.5s infinite;
            color: #00ccff;
        }

        @keyframes glitch-1 {
            0%, 100% {
                transform: translateX(0);
            }
            20% {
                transform: translateX(-1px);
            }
            40% {
                transform: translateX(1px);
            }
            60% {
                transform: translateX(-1px);
            }
            80% {
                transform: translateX(1px);
            }
        }

        @keyframes glitch-2 {
            0%, 100% {
                transform: translateX(0);
            }
            20% {
                transform: translateX(1px);
            }
            40% {
                transform: translateX(-1px);
            }
            60% {
                transform: translateX(1px);
            }
            80% {
                transform: translateX(-1px);
            }
        }

        .rate-display {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid #ffaa00;
            color: #ffaa00;
            text-align: center;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 9px;
        }

        @media (max-width: 360px) {
            .container {
                padding: 8px;
            }
            
            .card {
                padding: 10px;
            }
            
            .title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title glitch" data-text="NFTFan Token Sale">NFTFan Token Sale</h1>
        <p class="subtitle">// Send POL to receive NFTFan tokens //</p>

        <div id="status" class="status hidden"></div>

        <!-- Wallet Connection Section -->
        <div class="card">
            <button id="connectWallet" class="button connect-btn">
                > Connect Wallet
            </button>
            
            <div id="walletInfo" class="hidden">
                <div class="balance-item">
                    <span class="balance-label">Wallet:</span>
                    <span id="walletAddress" class="balance-value wallet-address"></span>
                </div>
            </div>
        </div>

        <!-- Network Section -->
        <div id="networkSection" class="card hidden">
            <div class="section-title">NETWORK STATUS</div>
            <button id="switchNetwork" class="button switch-btn">
                > Switch to Polygon Network
            </button>
        </div>

        <!-- Balances Section -->
        <div id="balanceSection" class="card hidden">
            <div class="section-title">WALLET BALANCES</div>
            <div class="balance-item">
                <span class="balance-label">POL Balance:</span>
                <span id="polBalance" class="balance-value">0.0000</span>
            </div>
            <div class="balance-item">
                <span class="balance-label">NFTFan Balance:</span>
                <span id="nftfanBalance" class="balance-value">0.00</span>
            </div>
            <button id="refreshBalances" class="button refresh-btn">
                > Refresh Balances
            </button>
        </div>

        <!-- Transfer Section -->
        <div id="transferSection" class="card hidden">
            <div class="section-title">SEND POL FOR NFTFAN</div>
            
            <div class="contract-info">
                <strong>Contract Address:</strong>
                <div class="contract-address">0xaf2d132C8773bca3821C24EcF64e844E202A12e8</div>
            </div>

            <div class="rate-display">
                <strong>AUTOMATIC EXCHANGE:</strong><br>
                Send POL → Receive NFTFan tokens instantly
            </div>
            
            <div class="input-group">
                <label class="input-label" for="polAmount">POL Amount to Send:</label>
                <input 
                    type="number" 
                    id="polAmount" 
                    class="input-field" 
                    placeholder="0.000" 
                    step="0.001"
                    min="0"
                >
            </div>
            
            <button id="sendPol" class="button send-btn" disabled>
                > Send POL
            </button>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div id="processingOverlay" class="processing-overlay">
        <div class="processing-content">
            <div class="processing-spinner"></div>
            <h3>PROCESSING TRANSACTION</h3>
            <p>// Sending POL to contract... //</p>
        </div>
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = '0xaf2d132C8773bca3821C24EcF64e844E202A12e8';
        const TOKEN_ADDRESS = '0x YOUR_TOKEN_ADDRESS'; // Replace with actual NFTFan token address
        const POLYGON_CHAIN_ID = '0x89'; // 137 in decimal

        // Contract ABIs (simplified)
        const ERC20_ABI = [
            {
                "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "decimals",
                "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Global variables
        let web3;
        let userAccount;
        let tokenContract;

        // DOM elements
        const connectWalletBtn = document.getElementById('connectWallet');
        const switchNetworkBtn = document.getElementById('switchNetwork');
        const sendPolBtn = document.getElementById('sendPol');
        const refreshBalancesBtn = document.getElementById('refreshBalances');
        const polAmountInput = document.getElementById('polAmount');
        const walletInfo = document.getElementById('walletInfo');
        const networkSection = document.getElementById('networkSection');
        const balanceSection = document.getElementById('balanceSection');
        const transferSection = document.getElementById('transferSection');
        const processingOverlay = document.getElementById('processingOverlay');

        // Initialize
        async function init() {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                
                // Check if already connected
                const accounts = await web3.eth.getAccounts();
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    await handleWalletConnected();
                }
            } else {
                showStatus('// MetaMask not detected - Please install MetaMask //', 'error');
            }
        }

        // Connect wallet
        async function connectWallet() {
            try {
                showStatus('// Establishing connection... //', 'info');
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                userAccount = accounts[0];
                await handleWalletConnected();
                showStatus('// Connection established successfully //', 'success');
            } catch (error) {
                console.error('Error connecting wallet:', error);
                showStatus('// Connection failed - Access denied //', 'error');
            }
        }

        // Handle wallet connected
        async function handleWalletConnected() {
            // Update UI
            document.getElementById('walletAddress').textContent = 
                userAccount.substring(0, 8) + '...' + userAccount.substring(34);
            walletInfo.classList.remove('hidden');
            connectWalletBtn.textContent = '> Wallet Connected';
            connectWalletBtn.disabled = true;

            // Check network
            const chainId = await web3.eth.getChainId();
            if (chainId.toString() !== '137') {
                networkSection.classList.remove('hidden');
                showStatus('// Network mismatch - Switch to Polygon required //', 'network-warning');
            } else {
                await handleCorrectNetwork();
            }
        }

        // Switch to Polygon network
        async function switchToPolygon() {
            try {
                showStatus('// Switching network protocol... //', 'info');
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: POLYGON_CHAIN_ID }],
                });
                await handleCorrectNetwork();
            } catch (error) {
                if (error.code === 4902) {
                    // Network not added, add it
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: POLYGON_CHAIN_ID,
                                chainName: 'Polygon Mainnet',
                                nativeCurrency: {
                                    name: 'POL',
                                    symbol: 'POL',
                                    decimals: 18
                                },
                                rpcUrls: ['https://polygon-rpc.com/'],
                                blockExplorerUrls: ['https://polygonscan.com/']
                            }]
                        });
                        await handleCorrectNetwork();
                    } catch (addError) {
                        console.error('Error adding network:', addError);
                        showStatus('// Network addition failed //', 'error');
                    }
                } else {
                    console.error('Error switching network:', error);
                    showStatus('// Network switch failed //', 'error');
                }
            }
        }

        // Handle correct network
        async function handleCorrectNetwork() {
            networkSection.classList.add('hidden');
            balanceSection.classList.remove('hidden');
            transferSection.classList.remove('hidden');
            
            // Initialize token contract if address is provided
            if (TOKEN_ADDRESS !== '0x YOUR_TOKEN_ADDRESS') {
                tokenContract = new web3.eth.Contract(ERC20_ABI, TOKEN_ADDRESS);
            }
            
            await updateBalances();
            showStatus('// System ready - Send POL to receive NFTFan //', 'success');
        }

        // Update balances
        async function updateBalances() {
            try {
                showStatus('// Updating balances... //', 'info');
                
                // Get POL balance
                const polBalance = await web3.eth.getBalance(userAccount);
                const polFormatted = web3.utils.fromWei(polBalance, 'ether');
                document.getElementById('polBalance').textContent = 
                    parseFloat(polFormatted).toFixed(4) + ' POL';

                // Get NFTFan balance if contract is available
                if (tokenContract) {
                    const tokenBalance = await tokenContract.methods.balanceOf(userAccount).call();
                    const decimals = await tokenContract.methods.decimals().call();
                    const tokenFormatted = (tokenBalance / Math.pow(10, decimals)).toFixed(2);
                    document.getElementById('nftfanBalance').textContent = 
                        tokenFormatted + ' NFTFan';
                } else {
                    document.getElementById('nftfanBalance').textContent = 'Connect token contract';
                }
                
                showStatus('// Balances updated successfully //', 'success');
            } catch (error) {
                console.error('Error updating balances:', error);
                showStatus('// Balance update failed //', 'error');
            }
        }

        // Validate POL amount
        function validatePolAmount() {
            const polAmount = parseFloat(polAmountInput.value) || 0;
            sendPolBtn.disabled = polAmount <= 0;
        }

        // Send POL to contract
        async function sendPol() {
            const polAmount = parseFloat(polAmountInput.value);
            
            if (!polAmount || polAmount <= 0) {
                showStatus('// Invalid amount - Enter valid POL value //', 'error');
                return;
            }

            try {
                showProcessing(true);
                showStatus('// Sending POL to contract... //', 'info');

                const amountWei = web3.utils.toWei(polAmount.toString(), 'ether');
                
                const transaction = await web3.eth.sendTransaction({
                    from: userAccount,
                    to: CONTRACT_ADDRESS,
                    value: amountWei,
                    gas: 200000
                });

                showStatus('// POL sent successfully - NFTFan tokens received //', 'success');
                
                // Clear input and update balances after delay
                polAmountInput.value = '';
                validatePolAmount();
                
                setTimeout(async () => {
                    await updateBalances();
                    showProcessing(false);
                }, 3000);

            } catch (error) {
                console.error('Transaction error:', error);
                showStatus('// Transaction failed: ' + error.message.substring(0, 40) + '... //', 'error');
                showProcessing(false);
            }
        }

        // Show/hide processing overlay
        function showProcessing(show) {
            if (show) {
                processingOverlay.classList.add('active');
            } else {
                processingOverlay.classList.remove('active');
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            // Auto-hide after 5 seconds for success messages
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 5000);
            }
        }

        // Event listeners
        connectWalletBtn.addEventListener('click', connectWallet);
        switchNetworkBtn.addEventListener('click', switchToPolygon);
        sendPolBtn.addEventListener('click', sendPol);
        refreshBalancesBtn.addEventListener('click', updateBalances);
        polAmountInput.addEventListener('input', validatePolAmount);

        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else {
                    userAccount = accounts[0];
                    handleWalletConnected();
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                location.reload();
            });
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
