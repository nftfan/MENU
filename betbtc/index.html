<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BTC Pro: Bank, Life, Trading</title>
<meta name="viewport" content="width=420, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; background: #0B0E11; color: #EAECEF; margin:0; padding:7px; font-size:9px;}
.container { max-width: 370px; margin: auto; background: #181A20; border-radius: 11px; padding: 10px; box-shadow: 0 4px 14px rgba(0,0,0,0.4);}
h1 { font-size: 11px; text-align: center; color: #FCD535; margin-bottom: 4px; font-weight:bold; }
.tabs { display: flex; gap: 2px; margin-bottom: 7px; border-bottom: 1px solid #333; }
.tab { flex: 1; padding: 6px; text-align: center; cursor: pointer; color: #848E9C; font-weight:bold; font-size: 9px;}
.tab.active { color: #FCD535; border-bottom: 2px solid #FCD535;}
.bold-balance { font-size:16px; font-weight:900; letter-spacing:1px; color:#2ebd85; display:inline-block;}
.card-bank {border-radius:13px;background:linear-gradient(120deg,#FCD53533 0%,#242731 100%); box-shadow:0 2px 10px #0004; display:flex;flex-direction:column;align-items:center; margin-bottom:9px;padding:11px;}
.card-bank .material-icons {font-size:28px;color:#2ebd85;margin-bottom:5px;}
.card-bank-title {color:#FCD535;font-size:10px;font-weight:bold;margin-left:2px;}
#bank-limits {font-size:8.5px;color:#eee; margin-bottom:2px;}
.transfer-row {margin-top:6px;margin-bottom:6px;display:flex;align-items:center;justify-content:center;}
.input-funds { width:60px; font-size:9px; border-radius:4px; padding:2.5px 2px;border:1px solid #333; background:#1e2329; color:#FCD535;}
.switch-btn { background: #23262f; color:#FCD535; border:none; border-radius:2px; font-weight:bold; font-size:8.5px; padding:2px 6px; margin:0 5px; cursor:pointer;}
.btn { border: none; border-radius: 3px; padding: 6px 12px; font-weight: bold; cursor: pointer; width: unset; font-size: 9px; transition: 0.17s;}
.btn-connect { background: #FCD535; color: #000;}
.btn-up { background: #2ebd85; color: white;}
.btn-down { background: #f6465d; color: white;}
.btn-buy {background:#5ca6ef;color:#fff;}
.btn-disabled { opacity: 0.3; pointer-events: none;}
.grid-life {display:grid; grid-template-columns:repeat(2,1fr); gap:7px; margin-bottom:7px;}
.grid-life .item-card {background:#21262d; border-radius:7px; padding:10px 5px 6px 5px; text-align:center;position:relative;}
.grid-life .item-name {font-size:8.7px;font-weight:bold;margin-bottom:2px; color:#FCD535;}
.grid-life .material-icons {font-size:25px;margin-bottom:2px;}
.grid-life .item-price {font-size:8.2px; color:#2ebd85;margin:1px;}
.grid-life .btn-buy, .grid-life .btn-own {font-size:8.2px;}
.grid-life .btn-own { background: #333; color: #aaa; cursor:default;}
.grid-life .btn-buy {padding:4px 6px; margin-top:1.5px;}
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; margin-bottom: 7px; }
.stat-card { background: #22252b; padding: 7px; border-radius: 6px; text-align: center; }
.stat-label { font-size: 8px; color: #848E9C; text-transform: uppercase;}
.stat-value { font-size: 10px; font-weight:bold; display:block; margin-top: 3px;}
#btc-price { font-size: 12px; font-weight:bold; text-align:center; margin:7px 0; color:#FCD535;}
.stats-box {background:#181a20;padding:7px 5px;margin-bottom:5px;}
#controls {margin-bottom:5px;}
.btn-row { display: flex; gap: 8px; width:100%; margin-bottom:5px;}
.slider-value { color:#FCD535;font-weight:bold;font-size:9px;min-width:22px;display:inline-block;text-align:right;}
.leverage-row, .amount-row { display: flex; align-items: center; margin-bottom: 4px; justify-content: space-between; }
.leverage-label, .amount-label { font-size:9px; color:#FCD535; }
#leverageSlider, #amountSlider { width: 60%; margin-left: 4px; margin-right:4px; }
#leverageSlider:disabled, #amountSlider:disabled { opacity:0.4;}
#betAmountSummary { font-size:8.3px;color:#FCD535; margin-bottom: 3px;}
#tradeUpDown {font-size:10px; font-weight:bold;margin-top:2px;margin-bottom:2px;}
#tradeUpDown .material-icons{font-size:16px;vertical-align:bottom;}
#timerBarContainer { width:100%; height: 15px; background:#23262f; border-radius:7px; overflow:hidden; margin-bottom:3px; position:relative;}
#timerBar { height:100%; background:linear-gradient(90deg,#FCD535 0,#fcb535 100%); transition:width 1s linear;}
#timeRemainText { position:absolute; left:50%; top:1.5px; transform:translateX(-50%); font-size:9.7px; color:#23262f; font-weight:bold; pointer-events:none; line-height:1;}
.reward-info { font-size:7.5px; color:#848E9C; background:#1e2329; padding:7px; border-radius:5px; margin-top:9px; border-left: 2px solid #FCD535;}
</style>
</head>
<body>
<div class="container">
    <h1>BTC TRADER PRO</h1>
    <div id="auth-section">
        <button id="connectBtn" class="btn btn-connect"><span class="material-icons" style="font-size:13px;vertical-align:-2px">account_balance_wallet</span> CONNECT</button>
    </div>
    <div id="app-content" style="display:none;">
        <div class="tabs">
            <div id="tab-bank" class="tab active" onclick="switchTab('bank')">BANK ACC</div>
            <div id="tab-life" class="tab" onclick="switchTab('life')">MY LIFE</div>
            <div id="tab-trade" class="tab" onclick="switchTab('trade')">TRADE</div>
        </div>
        <!-- BANK TAB -->
        <div id="view-bank">
            <div class="card-bank">
                <span class="material-icons" style="font-size:32px;">account_balance</span>
                <span class="card-bank-title">BANK ACCOUNT</span>
                <span class="bold-balance" id="bankBalance">$10.00</span>
                <div id="bank-limits">Top-up every 15 days | Cannot exceed $10.00</div>
            </div>
            <!-- PAIR 1: BANK ⟷ MAIN -->
            <div class="transfer-row">
                <input class="input-funds" id="bankMainAmount" pattern="[0-9]*" inputmode="numeric" type="number" min="1" step="1" value="1">
                <button class="switch-btn" onclick="switchBankMain()">Bank⇄Main</button>
            </div>
            <!-- PAIR 2: MAIN ⟷ TRADING -->
            <div class="transfer-row">
                <input class="input-funds" id="mainTradingAmount" pattern="[0-9]*" inputmode="numeric" type="number" min="1" step="1" value="1">
                <button class="switch-btn" onclick="switchMainTrading()">Main⇄Trading</button>
            </div>
            <div class="stats-grid" style="margin-bottom:0;">
                <div class="stat-card">
                    <span class="stat-label">MAIN</span>
                    <span id="userMain" class="stat-value">$0.00</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">TRADING</span>
                    <span id="userTrading" class="stat-value">$0.00</span>
                </div>
            </div>
        </div>
        <!-- LIFE TAB -->
        <div id="view-life" style="display:none;">
            <div style="font-size:9px;color:#FCD535;font-weight:bold;text-align:center;margin:4px 0;">
                What could you buy? Show off your "owns"! <span class="material-icons" style="font-size:13px;vertical-align:-2.5px;">star</span>
            </div>
            <div class="grid-life" id="lifeGrid"></div>
        </div>
        <!-- TRADE TAB -->
        <div id="view-trade" style="display:none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-label">TRADING</span>
                    <span id="balanceUSD" class="stat-value">$0.00</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">MAIN</span>
                    <span id="userMain2" class="stat-value" style="color:#fff">$0.00</span>
                </div>
            </div>
            <div class="stats-box">
                <div id="btc-price">--.---</div>
                <canvas id="btcChart" width="340" height="55"></canvas>
                <div class="amount-row">
                    <span class="amount-label">Bet:</span>
                    <input type="range" min="1" max="100" value="10" id="amountSlider" oninput="onBetAmountSet(this.value)">
                    <span id="amountValue" class="slider-value">10</span>
                </div>
                <div id="betAmountSummary">(Bal after: <span id="betAmountRemain">$0.00</span>)</div>
                <div class="leverage-row">
                    <span class="leverage-label">Lev:</span>
                    <input type="range" min="1" max="10" value="1" id="leverageSlider" oninput="onLeverageSet(this.value)">
                    <span id="leverageValue" class="slider-value">1x</span>
                </div>
            </div>
            <div id="tradeUpDown"></div>
        </div>
    </div>
    <div class="reward-info">
        <span class="material-icons" style="font-size:11px;vertical-align:-2.5px;">info</span> $10 bank, refilled every 15 days.<br>
        Move money between all wallets (bank, main, trading). <br>
        Buy luxury demo items ("My Life") are permanently remembered in your account. All balances formatted M, B, T!
    </div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getDatabase, ref, onValue, set, update, push, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
const firebaseConfig = {
  apiKey: "AIzaSyA6w6auszWRniQfZCjb4nXE_bq9Mzt9dOs",
  authDomain: "betbtc-6d881.firebaseapp.com",
  databaseURL: "https://betbtc-6d881-default-rtdb.firebaseio.com",
  projectId: "betbtc-6d881",
  storageBucket: "betbtc-6d881.firebasestorage.app",
  messagingSenderId: "962176232122",
  appId: "1:962176232122:web:a277d922543c3378033083",
  measurementId: "G-V4XNB7K1E0"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function toScaled(n) {
    n = +n;
    if (n >= 1_000_000_000_000) return (n/1_000_000_000_000).toFixed(2).replace(/\.00$/,"")+'T';
    if (n >= 1_000_000_000)    return (n/1_000_000_000).toFixed(2).replace(/\.00$/,"")+'B';
    if (n >= 1_000_000)        return (n/1_000_000).toFixed(2).replace(/\.00$/,"")+'M';
    return "$" + n.toLocaleString("en",{minimumFractionDigits:2});
}

function toUsd(x) { x=+x; return toScaled(x) || "$0"; }

function demoItems() {
    let icons = ["villa","directions_car","diamond","sailing","flight","image","house","commute"];
    let names = [
        "Luxury Villa", "Lamborghini", "Rare Diamond", "Super Yacht", "Private Jet", "Mona Lisa NFT", "Dream Home", "Hypercar"
    ];
    let items = [];
    for (let i = 0; i < 8; ++i) {
        let price = 1000 + Math.round((9000 * i) / 7); // spreads $1000 to $10,000 evenly
        items.push({ k: "i" + i, n: names[i], p: price, icon: icons[i % icons.length] });
    }
    return items;
}

let userWallet = null, main = 0, trading = 0, bank = 10, bankDate = "", myItems={};

function switchTab(tab) {
    document.getElementById('view-bank').style.display = tab==="bank"?"block":"none";
    document.getElementById('view-life').style.display = tab==="life"?"block":"none";
    document.getElementById('view-trade').style.display = tab==="trade"?"block":"none";
    document.getElementById('tab-bank').className = "tab" + (tab=='bank'?' active':'');
    document.getElementById('tab-life').className = "tab" + (tab=='life'?' active':'');
    document.getElementById('tab-trade').className = "tab" + (tab=='trade'?' active':'');
    if(tab==="life") drawLifeTab();
}
window.switchTab = switchTab;

document.getElementById('connectBtn').onclick = async () => {
    if (window.ethereum) {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        userWallet = accounts[0].toLowerCase();
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('app-content').style.display = 'block';
        initUser();
    } else { alert("Install MetaMask"); }
};

function checkAndRefillBankIfNeeded(node) {
    let now = new Date();
    now.setHours(0,0,0,0);
    let bankDateS = node?.bankDate || "";
    let last = bankDateS ? new Date(bankDateS) : new Date(0);
    last.setHours(0,0,0,0);
    const ms15d = 15*24*3600*1000;
    let nextTopup = new Date(last.getTime()+ms15d);
    document.getElementById('bank-limits').textContent = "Top-up every 15 days | Next: "+nextTopup.toISOString().slice(0,10);
    let toUpdate = {};
    if(now >= nextTopup){
        toUpdate.bank = 10;
        toUpdate.bankDate = now.toISOString().slice(0,10);
    }
    if(Object.keys(toUpdate).length) update(ref(db,`users/${userWallet}`), toUpdate);
}

function initUser() {
    onValue(ref(db, `users/${userWallet}`), snap => {
        let node = snap.val()||{};
        main = Number(node?.main)||0;
        trading = Number(node?.trading)||0;
        bank = typeof node?.bank === "number" ? node.bank : 10;
        bankDate = node?.bankDate||"";
        myItems = node?.myItems||{};
        document.getElementById('userMain').textContent = toUsd(main);
        document.getElementById('userTrading').textContent = toUsd(trading);
        document.getElementById('balanceUSD').textContent = toUsd(trading);
        document.getElementById('userMain2').textContent = toUsd(main);
        document.getElementById('bankBalance').textContent = toUsd(bank);
        drawLifeTab();
    });
    checkAndRefillBankIfNeeded(null);
}

window.switchBankMain = async function() {
    let amt = parseFloat(document.getElementById('bankMainAmount').value);
    if (!amt || amt < 1) return alert("Enter a valid amount.");
    if (amt > bank && amt > main) return alert("Insufficient funds.");

    // Try to move Bank→Main, if enough bank
    if (bank >= amt) {
        await update(ref(db,`users/${userWallet}`), {bank: bank-amt, main: main+amt});
        bank -= amt; main += amt;
    }
    // else try Main→Bank
    else if (main >= amt) {
        await update(ref(db,`users/${userWallet}`), {main: main-amt, bank: bank+amt});
        main -= amt; bank += amt;
    } else return alert("Insufficient funds.");
};

window.switchMainTrading = async function() {
    let amt = parseFloat(document.getElementById('mainTradingAmount').value);
    if (!amt || amt < 1) return alert("Enter a valid amount.");
    if (amt > main && amt > trading) return alert("Insufficient funds.");

    // Try to move Main→Trading, if enough main
    if (main >= amt) {
        await update(ref(db,`users/${userWallet}`), {main: main-amt, trading: trading+amt});
        main -= amt; trading += amt;
    }
    // else try Trading→Main
    else if (trading >= amt) {
        await update(ref(db,`users/${userWallet}`), {trading: trading-amt, main: main+amt});
        trading -= amt; main += amt;
    } else return alert("Insufficient funds.");
};

function drawLifeTab() {
    let grid = document.getElementById("lifeGrid");
    let items = demoItems();
    grid.innerHTML="";
    items.forEach(it=>{
        let own = (myItems&&(myItems[it.k]));
        grid.innerHTML += `<div class="item-card">
            <span class="material-icons">${it.icon}</span>
            <div class="item-name">${it.n}</div>
            <div class="item-price">${toUsd(it.p)}</div>
            ${own?('<button class="btn btn-own" disabled>Own <span class="material-icons" style="font-size:11px;vertical-align:-2px;">check</span></button>')
                :(`<button class="btn btn-buy" onclick="buyItem('${it.k}')">Buy <span class="material-icons" style="font-size:11px;vertical-align:-2px;">shopping_cart</span></button>`)}
        </div>`;
    });
}
window.buyItem= async function(k) {
    let items = demoItems();
    let item = items.find(x=>x.k===k);
    if(!item) return;
    if(bank<item.p) { alert("Insufficient bank account balance!"); return; }
    let snapshot = await get(ref(db,`users/${userWallet}/myItems`));
    let ni = (snapshot.exists() ? snapshot.val() : {});
    ni = ni || {};
    ni[k] = true;
    await update(ref(db,`users/${userWallet}`), {bank: bank-item.p, myItems:ni});
};

window.onLeverageSet = function(val) {
    document.getElementById('leverageValue').textContent = val+'x';
};
window.onBetAmountSet = function(val) {
    document.getElementById('amountValue').textContent = val;
    let futureBalance = trading - (+val);
    document.getElementById('betAmountRemain').textContent = toUsd(futureBalance);
};

// BTC PRICE + CHART
let btcPrice = 0;
async function fetchPrice() {
    try {
        const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        const data = await res.json();
        btcPrice = parseFloat(data.price);
    } catch { }
    document.getElementById('btc-price').textContent = toUsd(btcPrice);
}
setInterval(fetchPrice, 2000);
const ctx = document.getElementById('btcChart').getContext('2d');
let priceHistory = [];
let chart = new Chart(ctx, {
    type: 'line',
    data: {labels:Array(20).fill(''),datasets:[{data:priceHistory, borderColor:'#FCD535', tension:.4, pointRadius: 0, borderWidth: 1.1, fill:false}]},
    options: {animation:false,scales:{x:{display:false},y:{display:false}},plugins:{legend:{display:false}}}
});
setInterval(() => {priceHistory.push(btcPrice); if(priceHistory.length>20) priceHistory.shift(); chart.data.datasets[0].data=priceHistory.slice();chart.update();},3000);

window.buyItem = window.buyItem;
window.switchTab = window.switchTab;
window.switchBankMain = window.switchBankMain;
window.switchMainTrading = window.switchMainTrading;
window.onLeverageSet = window.onLeverageSet;
window.onBetAmountSet = window.onBetAmountSet;
</script>
</body>
</html>
