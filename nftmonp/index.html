<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>monP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #020205;
      --card: #0a0a10;
      --text: #e0e0e0;
      --yellow: #fcee0a;
      --cyan: #00f0ff;
      --red: #ff003c;
      --border: #333;
      --panel: #111;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: "Rajdhani", sans-serif;
      background:
        linear-gradient(rgba(10,10,16,0.9), rgba(10,10,16,0.9)),
        repeating-linear-gradient(0deg, transparent, transparent 1px, #111 1px, #111 2px);
      color: var(--text);
      min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      padding: 16px;
      font-size: 10px;
    }
    .wrap { width: min(1100px, 100%); display: grid; gap: 12px; }
    .card {
      background: var(--card);
      border: 1px solid var(--yellow);
      box-shadow: 0 0 15px rgba(252, 238, 10, 0.15);
      padding: 16px;
      position: relative;
    }
    .card::before {
      content: ""; position: absolute; top: -1px; left: -1px; width: 8px; height: 8px;
      background: var(--yellow); box-shadow: 0 0 10px var(--yellow);
    }
    .card::after {
      content: ""; position: absolute; bottom: -1px; right: -1px; width: 8px; height: 8px;
      background: var(--yellow); box-shadow: 0 0 10px var(--yellow);
    }
    h1 {
      margin: 0 0 8px;
      font-family: "Orbitron", sans-serif;
      font-size: 12px;
      color: var(--yellow);
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 0 5px var(--yellow);
      border-bottom: 1px solid #222;
      padding-bottom: 6px;
    }
    p.sub { margin: 0 0 12px; color: #888; font-size: 9px; line-height: 1.3; }
    label {
      display: block; margin: 8px 0 3px; font-weight: 700; font-size: 9px;
      color: var(--cyan); text-transform: uppercase; letter-spacing: 0.5px;
    }
    input {
      width: 100%; padding: 8px; border: 1px solid var(--border);
      background: #050508; color: var(--cyan);
      font-family: "Rajdhani", sans-serif; font-size: 10px;
      outline: none; transition: all 0.2s;
    }
    input:focus { border-color: var(--cyan); box-shadow: 0 0 8px rgba(0, 240, 255, 0.3); background: #001012; }
    input::placeholder { color: #444; }

    .actions { display: flex; gap: 8px; margin-top: 14px; }
    button {
      flex: 1; padding: 10px; border: none; cursor: pointer;
      font-family: "Orbitron", sans-serif; font-weight: 700; font-size: 10px;
      text-transform: uppercase; letter-spacing: 1px;
      clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
      transition: all 0.2s;
    }
    #submitBtn { background: var(--yellow); color: #000; }
    #submitBtn:hover { background: #fff; box-shadow: 0 0 15px var(--yellow); }
    #resetBtn { background: transparent; border: 1px solid var(--red); color: var(--red); flex: 0 0 60px; }
    #resetBtn:hover { background: rgba(255, 0, 60, 0.1); box-shadow: 0 0 10px var(--red); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .status { margin-top: 8px; font-size: 9px; min-height: 14px; font-weight: 700; letter-spacing: 0.5px; }
    .status.ok { color: var(--cyan); }
    .status.err { color: var(--red); }

    .preview {
      margin-top: 12px; border: 1px dashed #333; padding: 6px;
      text-align: center; color: #555; font-size: 9px;
    }
    .preview img {
      max-width: 100%; border: 1px solid #333; display: block; margin: 4px auto 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    /* List */
    .list-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    .item-card {
      background: var(--panel);
      border: 1px solid #222;
      padding: 8px;
      display: grid;
      gap: 6px;
      position: relative;
    }
    .thumb {
      width: 100%; aspect-ratio: 1/1; background: #000; border: 1px solid #333;
      display: flex; align-items: center; justify-content: center;
    }
    .thumb img { width: 100%; height: 100%; object-fit: contain; }
    .item-title { font-weight: 700; color: var(--yellow); font-size: 10px; }
    .item-price { color: var(--cyan); font-size: 9px; }
    .row-actions { display: flex; gap: 6px; }
    .btn-sm {
      flex: 1;
      padding: 6px;
      font-size: 9px;
      text-transform: uppercase;
      border: 1px solid var(--yellow);
      background: transparent;
      color: var(--yellow);
      cursor: pointer;
    }
    .btn-sm.edit { border-color: var(--cyan); color: var(--cyan); }
    .btn-sm.delete { border-color: var(--red); color: var(--red); }
    .btn-sm:hover { box-shadow: 0 0 8px currentColor; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>NFT Data Entry</h1>
      <p class="sub">Secure uplink to Firebase Database.</p>

      <input type="hidden" id="editingId" value="">

      <label for="title">Asset Name</label>
      <input id="title" type="text" placeholder="NEURO-X #01" autocomplete="off" />

      <label for="price">Price (MON)</label>
      <input id="price" type="number" placeholder="50" autocomplete="off" />

      <label for="img">Visual Data URL</label>
      <input id="img" type="url" placeholder="https://..." autocomplete="off" />

      <div class="actions">
        <button id="submitBtn">UPLOAD</button>
        <button id="resetBtn" type="button">CLR</button>
      </div>

      <div class="status" id="status"></div>

      <div class="preview" id="previewBox">
        <div>NO SIGNAL</div>
        <img id="previewImg" alt="" style="display:none;" />
      </div>
    </div>

    <div class="card">
      <h1>Posted Items</h1>
      <div id="listStatus" class="status">Loading...</div>
      <div id="itemsGrid" class="list-grid"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBuBB-Cha7eLG1O7SxOTfFt8e6hVAWjkxI",
      authDomain: "tokentransfer-4a9b3.firebaseapp.com",
      databaseURL: "https://tokentransfer-4a9b3-default-rtdb.firebaseio.com",
      projectId: "tokentransfer-4a9b3",
      storageBucket: "tokentransfer-4a9b3.firebasestorage.app",
      messagingSenderId: "205455490321",
      appId: "1:205455490321:web:9919f5dde059316c9320b0",
      measurementId: "G-Y6CVEDL9XH"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const titleEl = document.getElementById('title');
    const priceEl = document.getElementById('price');
    const imgEl = document.getElementById('img');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');
    const resetBtn = document.getElementById('resetBtn');
    const previewImg = document.getElementById('previewImg');
    const previewBox = document.getElementById('previewBox');
    const editingIdEl = document.getElementById('editingId');

    const itemsGrid = document.getElementById('itemsGrid');
    const listStatus = document.getElementById('listStatus');

    // UPDATED: write/read from new folder
    const NFT_ROOT = "monadnfts";

    function setStatus(msg, cls = "") {
      statusEl.className = `status ${cls}`;
      statusEl.textContent = msg ? `> ${msg}` : "";
    }
    function setListStatus(msg, cls = "") {
      listStatus.className = `status ${cls}`;
      listStatus.textContent = msg || "";
    }

    function resetForm(clearEditing = true) {
      titleEl.value = "";
      priceEl.value = "";
      imgEl.value = "";
      previewImg.style.display = "none";
      previewImg.src = "";
      previewBox.firstElementChild.style.display = "block";
      setStatus("");
      if (clearEditing) editingIdEl.value = "";
      submitBtn.textContent = "UPLOAD";
    }

    imgEl.addEventListener('input', () => {
      const url = imgEl.value.trim();
      if (url) {
        previewImg.src = url;
        previewImg.style.display = "block";
        previewBox.firstElementChild.style.display = "none";
      } else {
        previewImg.style.display = "none";
        previewImg.src = "";
        previewBox.firstElementChild.style.display = "block";
      }
    });

    async function saveItem() {
      const title = titleEl.value.trim();
      const price = priceEl.value.trim();
      const imgUrl = imgEl.value.trim();

      if (!title) return setStatus("MISSING NAME", "err");
      if (!price) return setStatus("MISSING PRICE", "err");
      if (!imgUrl) return setStatus("MISSING URL", "err");

      submitBtn.disabled = true;
      setStatus(editingIdEl.value ? "UPDATING..." : "UPLOADING...", "ok");

      try {
        if (editingIdEl.value) {
          await db.ref(`${NFT_ROOT}/${editingIdEl.value}`).update({
            title, price, imageUrl: imgUrl
          });
          setStatus("UPDATE COMPLETE", "ok");
        } else {
          const ref = db.ref(NFT_ROOT).push();
          await ref.set({ title, price, imageUrl: imgUrl, createdAt: Date.now() });
          setStatus("UPLOAD COMPLETE", "ok");
        }
        setTimeout(() => setStatus("READY"), 1500);
        resetForm();
      } catch (err) {
        console.error(err);
        setStatus("SAVE FAILED", "err");
      } finally {
        submitBtn.disabled = false;
      }
    }

    submitBtn.addEventListener('click', saveItem);
    resetBtn.addEventListener('click', () => resetForm(true));

    function renderItem(id, data) {
      const card = document.createElement('div');
      card.className = 'item-card';

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      const img = document.createElement('img');
      img.src = data.imageUrl || '';
      thumb.appendChild(img);
      card.appendChild(thumb);

      const title = document.createElement('div');
      title.className = 'item-title';
      title.textContent = data.title || 'UNTITLED';
      card.appendChild(title);

      const price = document.createElement('div');
      price.className = 'item-price';
      price.textContent = data.price ? `${data.price} MON` : "? MON";
      card.appendChild(price);

      const row = document.createElement('div');
      row.className = 'row-actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'btn-sm edit';
      editBtn.textContent = 'EDIT';
      editBtn.onclick = () => {
        editingIdEl.value = id;
        titleEl.value = data.title || "";
        priceEl.value = data.price || "";
        imgEl.value = data.imageUrl || "";
        imgEl.dispatchEvent(new Event('input'));
        submitBtn.textContent = "UPDATE";
        setStatus(`EDITING ${id}`);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      row.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.className = 'btn-sm delete';
      delBtn.textContent = 'DEL';
      delBtn.onclick = async () => {
        if (!confirm("Delete this item?")) return;
        try {
          await db.ref(`${NFT_ROOT}/${id}`).remove();
          setStatus("DELETED", "ok");
        } catch (e) {
          console.error(e);
          setStatus("DELETE FAILED", "err");
        }
      };
      row.appendChild(delBtn);

      card.appendChild(row);
      return card;
    }

    function loadItems() {
      setListStatus("Loading...");
      db.ref(NFT_ROOT).orderByChild("createdAt").on("value", (snapshot) => {
        itemsGrid.innerHTML = "";
        const val = snapshot.val();
        if (!val) {
          setListStatus("No items", "");
          return;
        }
        const entries = Object.entries(val).sort((a, b) => (b[1].createdAt || 0) - (a[1].createdAt || 0));
        entries.forEach(([id, data]) => {
          itemsGrid.appendChild(renderItem(id, data));
        });
        setListStatus(`Loaded ${entries.length} item(s)`, "ok");
      }, (err) => {
        console.error(err);
        setListStatus("DB READ ERROR", "err");
      });
    }

    loadItems();
  </script>
</body>
</html>
