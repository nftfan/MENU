<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>BTCUSD Guess App</title>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-database-compat.js"></script>
  <!-- Chart.js 4.x -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    html, body { margin: 0; padding: 0; font-family: 'Share Tech Mono', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(120deg, #181d23 0%, #255257 100%);
      color: #f9fafb; font-size: 10px; min-height: 100svh; box-sizing: border-box; user-select: none;}
    .container { max-width: 400px; margin: 14px auto 0 auto; padding: 12px 8px 18px 8px; background: #1a232bfc;
      border-radius: 24px; box-shadow: 0 2px 12px #0002; border:1.5px solid #32434c; position:relative;}
    /* .top-right-timer { ... } REMOVED */
    .btc-price-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 0.7em;
      margin-left: 2px;
      margin-top: 2px;
      min-height: 36px;
    }
    .btc-icon {
      width: 29px; height: 29px; display: block; border-radius: 50%;
      background: #f6ad42 linear-gradient(145deg,#fad880 37%,#ffc046 100%);
      box-shadow: 0 1px 3px #0002;
      border: 1.2px solid #eda42e;
      object-fit: contain;
    }
    .price { font-size: 2em; font-weight: bold; letter-spacing: 1.2px;
      color: #36cbe3; background: #1b2932; padding: 5px 13px 2px 13px; border-radius: 11px; transition: color 0.23s;
      margin-bottom: 0; text-align:left; min-width:70px;
      display: inline-block;
      line-height: 33px;
    }
    .chart-wrap { background:linear-gradient(90deg, #181d23 60%, #16253b 100%);
      border-radius: 13px; margin: 0px 0 12px 0; padding: 5px 0 0 0; display: flex;
      align-items: center; justify-content: center; min-height: 120px; border: 1px solid #27323F;}
    #btcChart { display: block; width:99% !important; min-width:255px; height:88px; margin:0 auto; }
    .timers-row {
      display: flex;
      justify-content: space-between;
      margin: 5px 0 8px 0;
      gap: 7px;
    }
    .timer-box {
      background: #202e38;
      border-radius: 10px;
      color: #44f7de;
      border: 1.5px solid #27323F;
      font-size: 10px;
      font-weight: bold;
      margin: 0; padding: 7px 6px 6px 9px;
      min-width: 120px;
      display: flex; flex-direction: column;
      align-items: flex-start;
    }
    .timer-title { font-size: 9px; color: #9befff; font-weight: bold; letter-spacing: 0.7px;}
    .timer-val { font-size: 1.03em; font-weight: bold;}
    .timer-bar-bg { width:100%; height:10px; background:#232d3540; border-radius:6px; overflow:hidden; position:relative; margin:0 0 3px 0;}
    .timer-bar-fill { height:100%; background: linear-gradient(90deg, #25ecd6 5%, #4e79fa 65%, #ff9f4d 100%); transition: width 0.3s cubic-bezier(.86,.13,.31,.98);}
    .timer-labels { display:flex; justify-content:space-between; width:100%; font-size:9.7px; color:#a0e9f6; margin-top: 1.5px; font-family: inherit;}
    .timer { width:100%; text-align: center; color: #43fa9d; margin-bottom: 6.5px; font-weight: 700; letter-spacing: 1px;
      font-size: 1.08em; padding: 0; transition: color 0.29s;}
    .form { display:flex; flex-direction:column; gap:7px; margin-bottom:10px; background:#202e38; padding:12px 10px 12px 10px; border-radius:13px; border:1.5px solid #27323F;}
    input[type="text"], input[type="number"] { font-size:10px; padding:7px 10px; border:1.3px solid #333b43; border-radius:7px; background:#161d22; color:#b3ecfd;
      outline:none; transition: border 0.17s, background .2s; width:100%; box-sizing:border-box; font-family: inherit; caret-color: #20f5b8;}
    input[type="text"]:focus, input[type="number"]:focus { border:1.4px solid #2ed7ce; background:#194249;}
    button { padding:10px 0 7px 0; font-size:10px; background:linear-gradient(90deg, #0be6d3 0%, #227fdc 100%);
      color:#171d28; font-weight:700; border:none; border-radius:7px; margin-top:2px; cursor:pointer; transition: background 0.14s, color 0.19s, transform .17s; letter-spacing:1.1px; font-family:inherit;}
    button:active { background:linear-gradient(90deg, #227fdc 10%, #0be6d3 90%); color: #161a20; transform:scale(.96);}
    .disabled, button:disabled { opacity:0.37; pointer-events:none;}
    .results-meta-bar { width:100%; margin: 10px 0 2px 0; }
    .results-meta {display:flex;align-items:center;justify-content:space-between;font-size:9.5px;color:#b8f2fc;}
    .results-meta strong { color:#1fe8e0;}
    .entries-table { width:100%; border-collapse:collapse; background:#172026; border-radius:9px; overflow:hidden; margin-top:10px; font-size:10px; border:1.3px solid #2a323a;}
    .entries-table th, .entries-table td { padding:5px 4px; text-align:left; border-bottom:0.6px solid #242C33; font-size:10px; font-family:inherit;}
    .entries-table th { background:#212F36; color:#81eaf7; font-weight:700; border-bottom:1.2px solid #27323F;}
    .entries-table tr:last-child td { border-bottom:none;}
    .winner { background:#1be4c7 !important; color:#171832 !important;}
    .closed-msg { text-align:center; color: #2779c4; background: #232c3a; border-radius:9px; padding:7px 8px 8px 8px; margin-bottom:12px; margin-top:7px; font-weight:600; font-size:11px; letter-spacing:0.5px; border:1.5px solid #223249;}
    .info { font-size:9px; color:#44f7de; margin-top:3px; text-align:center; letter-spacing:0px; font-family:inherit; padding:1px 0;}
    .pnl { font-weight:bold; font-family:inherit; font-size:10px; padding-left:5px; transition:color 0.23s;}
    .pnl-pos { color: #38d48e;}
    .pnl-neg { color: #e1465b;}
    .pnl-zero{ color: #e5dc4c;}
    .percent-close { font-weight:bold; font-size:10px; margin-left:5px;}
    .percent-good { color: #41f09c;}
    .percent-bad { color: #e56369;}
    .percent-med { color: #f7e423;}
    tr:hover { filter:brightness(1.12) saturate(1.18); background:#19424933 !important; transition:.2s;}
    ::-webkit-scrollbar { width:0 !important; display:none;}
    @media (max-width:440px){ .container{max-width:99vw;} .btc-price-row{min-width:0;}}
  </style>
</head>
<body>
  <div class="container">
    <!-- top-right-timer removed -->
    <div class="btc-price-row">
      <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png?v=026" class="btc-icon" alt="btc">
      <span id="price" class="price">...</span>
    </div>
    <div class="chart-wrap">
      <canvas id="btcChart" width="365" height="120" style="pointer-events:none;width:99%;height:100px;"></canvas>
    </div>
    <div class="timers-row">
      <div class="timer-box">
        <div class="timer-title">Entries close</div>
        <div class="timer-val" id="entryCloseTimer">...</div>
      </div>
      <div class="timer-box">
        <div class="timer-title">Results in</div>
        <div class="timer-val" id="resultsMainTimer">...</div>
      </div>
    </div>
    <form class="form" id="guessForm" autocomplete="off">
      <input autocomplete="off" autocorrect="off" spellcheck="false" inputmode="text" pattern="^@.+" id="xUsername" type="text" placeholder="Your X username, e.g. @xyzzz" required maxlength="24" style="ime-mode:disabled;">
      <input autocomplete="off" autocorrect="off" spellcheck="false" inputmode="decimal" pattern="^[\d\.]+$" min="0" max="999999" maxlength="7" id="usdGuess" type="number" placeholder="Guess price after 24h (USD)" required>
      <button type="submit" id="guessBtn">Submit Guess</button>
    </form>
    <div class="results-meta-bar">
      <div class="results-meta">
        <span><strong>End BTC:</strong> <span id="resultsBTC"></span></span>
        <span><strong>Time Remaining:</strong> <span id="resultsTimer"></span></span>
      </div>
    </div>
    <div id="closedMsg" class="closed-msg" style="display:none;">
      Entries are closed.<br>Wait for results!
    </div>
    <div class="info">(Entries close after 12h. Winner(s) list will show after 24h)<br>
      PNL = (BTC Live - Your Guess), % = distance/price
    </div>
    <div id="winnersSection" style="display:none;margin-top:10px;">
      <h3 style="font-size:10px;margin:0 0 4px 0;font-weight:bold;color:#44f7de;">Winners</h3>
      <table class="entries-table" id="winnersTable"></table>
    </div>
    <div id="tableSection" style="margin-top:10px;">
      <h3 style="font-size:10px;margin:0 0 4px 0;font-weight:bold;color:#44f7de;">Guesses</h3>
      <table class="entries-table" id="entriesTable"></table>
    </div>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6w6auszWRniQfZCjb4nXE_bq9Mzt9dOs",
      authDomain: "betbtc-6d881.firebaseapp.com",
      databaseURL: "https://betbtc-6d881-default-rtdb.firebaseio.com",
      projectId: "betbtc-6d881",
      storageBucket: "betbtc-6d881.appspot.com",
      messagingSenderId: "962176232122",
      appId: "1:962176232122:web:a277d922543c3378033083",
      measurementId: "G-V4XNB7K1E0"
    };

    const firebaseApp = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const SESSION_PATH = '/btc24h_session';
    const ENTRIES_PATH = '/btc24h_entries';
    let session = { start: null, close: null, end: null, closePrice: null, endPrice: null };
    let intervalTimers = [];
    let showWinnerTimer = null;

    async function getOrCreateSession() {
      return new Promise((resolve) => {
        db.ref(SESSION_PATH).once('value').then(async snap => {
          if (snap.exists()) {
            session = {...session, ...snap.val()};
            resolve(session);
          } else {
            const now = Date.now();
            const start = now - (now % 60000);
            const close = start + 12 * 60 * 60 * 1000;
            const end = start + 24 * 60 * 60 * 1000;
            session = { start, close, end, closePrice: null, endPrice: null };
            await db.ref(SESSION_PATH).set(session);
            resolve(session);
          }
        });
      });
    }

    // --- BTC PRICE & HISTORY/CHART ---
    let lastBTC = null;
    let btcHistory = [];
    let btcChart = null;
    const MAX_POINTS = 36;
    async function fetchBTC() {
      try {
        const r = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        const { price } = await r.json();
        lastBTC = +price;
        return lastBTC.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
      } catch {
        return '???.??';
      }
    }
    function addToHistory(price) {
      const now = Date.now();
      btcHistory.push({time: now, price: +price});
      if (btcHistory.length > MAX_POINTS) btcHistory = btcHistory.slice(-MAX_POINTS);
    }
    async function updateBTC() {
      const priceStr = await fetchBTC();
      document.getElementById('price').textContent = priceStr;
      addToHistory(lastBTC || 0);
      if(btcHistory.length>2 && lastBTC){
        let p0 = btcHistory[btcHistory.length-2].price;
        let elem = document.getElementById('price');
        elem.style.transition = "color 0.25s";
        if(lastBTC>p0) elem.style.color="#53eb99";
        else if(lastBTC<p0) elem.style.color="#e35e8f";
        else elem.style.color="#36cbe3";
        setTimeout(()=>{elem.style.color="#36cbe3"},350);
      }
      if (btcChart) renderChartFinal();
      renderEntries();
    }
    function renderChartFinal() {
      if (!btcChart) return;
      if (btcHistory.length < 2) return;
      let data = btcHistory.map(d => d.price);
      let labels = btcHistory.map(d => (new Date(d.time)).toLocaleTimeString([], {minute:'2-digit',second:'2-digit'}));
      let segColors = [];
      for(let i=0; i<data.length; i++) 
        if (i>0) segColors.push(data[i] > data[i-1] ? "#38d48e" : (data[i]<data[i-1]?"#e1465b":"#666d7a"));
      // Only one dot (circle) at the last value, rest are not visible
      let pColors = Array(data.length).fill('rgba(0,0,0,0)');
      pColors[pColors.length-1] = data.length>1
        ? (data[data.length-1] > data[data.length-2] ? "#23d977" : (data[data.length-1] < data[data.length-2] ? "#eb4f69" : "#bbbbbb"))
        : "#bbbbbb";
      let pRadii = Array(data.length).fill(0);
      pRadii[pRadii.length-1] = 4.7;
      let gradient = btcChart.ctx.createLinearGradient(0, 0, btcChart.width, btcChart.height);
      gradient.addColorStop(0, "#132e3e77");
      gradient.addColorStop(1, "#39317033");
      btcChart.data.labels = labels;
      btcChart.data.datasets[0].data = data;
      btcChart.data.datasets[0].pointBackgroundColor = pColors;
      btcChart.data.datasets[0].pointRadius = pRadii;
      btcChart.data.datasets[0].segment = {
        borderColor: ctx => segColors[ctx.p1DataIndex-1] || "#bbbbbb",
        borderWidth: ctx => 2.5
      };
      btcChart.data.datasets[0].fill = true;
      btcChart.data.datasets[0].backgroundColor = gradient;
      btcChart.update('active');
    }
    function initChart() {
      const ctx = document.getElementById('btcChart').getContext('2d');
      btcChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'BTCUSD',
            data: [],
            pointBackgroundColor: [],
            pointRadius: [],
            fill: true,
            backgroundColor: "#134",
            borderColor: '#31bfdc',
            tension: 0.42,
            pointBorderWidth: 0,
            borderWidth:2.0,
          }]
        },
        options: {
          responsive: false,
          interaction: {mode:'index',intersect:false},
          scales: {
            x: {
              display: false,
              min: 0,
              max: MAX_POINTS-1,
              ticks: {display:false}, grid:{display:false},border:{display:false}
            },
            y: {
              ticks: { display: false }, grid: { display: false }, border: { display: false }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              enabled: true,
              callbacks: { label: ctx => ctx.parsed.y }
            }
          },
          animation: { duration: 950, easing: 'easeInOutCirc' }
        }
      });
    }
    function prettyTime(ms, short=true) {
      if (ms<0) return "0s";
      const d = Math.floor(ms/86400000);
      const h = Math.floor(ms/3600000)%24;
      const m = Math.floor(ms/60000)%60;
      const s = Math.floor(ms/1000)%60;
      if (short) {
        if (d>0) return `${d}d ${h}h`;
        if (h>0) return `${h}h ${m}m`;
        if (m>0) return `${m}m ${s}s`;
        return `${s}s`;
      }
      let parts = [];
      if (d) parts.push(d + ' day' + (d === 1 ? '' : 's'));
      if (h) parts.push(h + ' hour' + (h === 1 ? '' : 's'));
      if (m) parts.push(m + ' min' + (m === 1 ? '' : 's'));
      if (s) parts.push(s + ' sec');
      return parts.join(', ');
    }
    function agoStr(ts) {
      const now = Date.now();
      let ms = now - ts;
      if (ms<60000) return "Just now";
      let h = Math.floor(ms/3600000);
      let m = Math.floor((ms%3600000)/60000);
      let str = "";
      if (h>0) str += `${h}h `;
      str += `${m}min ago`;
      return str;
    }
    function updateEntryAndResultTimers() {
      const now = Date.now();
      let entryTime = session.close ? session.close-now : 0;
      let resultsTime = session.end ? session.end-now : 0;
      document.getElementById("entryCloseTimer").textContent = (entryTime > 0)
        ? prettyTime(entryTime,false)
        : "Closed";
      document.getElementById("resultsMainTimer").textContent = (resultsTime > 0)
        ? prettyTime(resultsTime,false)
        : "Finalizing...";
      // No longer call updateCornerTimer
      updateMetaBar();
    }
    // updateCornerTimer removed
    function updateMetaBar() {
      // Update results bar (live under submit)
      const now = Date.now();
      let btcTxt = session.endPrice
        ? session.endPrice
        : lastBTC ? lastBTC : "...";
      let tleft = "";
      if (session.end && now<session.end)
        tleft = prettyTime(session.end-now,false);
      else if (session.end && now > session.end)
        tleft = "00s";
      document.getElementById('resultsBTC').textContent = btcTxt;
      document.getElementById('resultsTimer').textContent = tleft;
    }
    function updateFormState() {
      const now = Date.now();
      if (session.close && now >= session.close) {
        document.getElementById('closedMsg').style.display = '';
        document.getElementById('guessForm').classList.add('disabled');
        document.getElementById('guessBtn').disabled = true;
        Array.from(document.querySelectorAll('.form input')).forEach(e=>e.disabled=true);
      } else {
        document.getElementById('closedMsg').style.display = 'none';
        document.getElementById('guessForm').classList.remove('disabled');
        document.getElementById('guessBtn').disabled = false;
        Array.from(document.querySelectorAll('.form input')).forEach(e=>e.disabled=false);
      }
    }
    // --- SUBMIT GUESS ---
    document.getElementById('guessForm').addEventListener('submit', async function(e){
      e.preventDefault();
      let username = document.getElementById('xUsername').value.trim();
      let guess = document.getElementById('usdGuess').value.trim();
      if (!/^@[\w\.]{2,22,25}$|@[\w]{2,23}$/.test(username)) {
        alert("Invalid X username. Example: @xyzzz");
        return;
      }
      let guessNum = +guess;
      if (isNaN(guessNum) || guessNum < 1000 || guessNum > 999999) {
        alert("Guess must be a number in USD (1000-999999).");
        return;
      }
      const userKey = username.replace(/[^a-zA-Z0-9_\.]/g,"_");
      const entryPath = ENTRIES_PATH + '/' + session.start + '/' + userKey;
      let existing = (await db.ref(entryPath).once('value')).val();
      if (!existing) {
        await db.ref(entryPath).set({
          x: username,
          guess: guessNum,
          ts: Date.now()
        });
        alert('Guess submitted!');
        document.getElementById('guessForm').reset();
      } else {
        alert("You've already entered!");
      }
      renderEntries();
    });
    // --- RENDER ENTRIES TABLE WITH LIVE PNL & % CLOSE ---
    function pctStr(dist, price) {
      if(!price || isNaN(price) || price === 0) return '';
      let pct = Math.abs(dist)/price*100;
      let colorClass = pct<0.21?'percent-good' : (pct < 0.9?'percent-med':'percent-bad');
      return `<span class="percent-close ${colorClass}">${(100-Math.min(100,pct)).toFixed(2)}%</span>`;
    }
    async function renderEntries() {
      const snap = await db.ref(ENTRIES_PATH + '/' + session.start).once('value');
      const entriesObj = snap.val() || {};
      let arr = Object.values(entriesObj);
      arr.sort((a,b)=>a.ts-b.ts);
      const table = document.getElementById('entriesTable');
      let html = `<tr>
        <th>X Username</th>
        <th>Guess ($)</th>
        <th>PNL (Live)</th>
        <th>% Close</th>
        <th>When</th>
      </tr>`;
      if (arr.length)
        html += arr.map(e => {
          if (!e.x || typeof e.guess !== 'number' && typeof e.guess !== 'string') return '';
          const pnl = (lastBTC != null && !isNaN(e.guess)) ? (+lastBTC - e.guess) : null;
          let pnlDisp = '';
          let pctDisp = '';
          if (pnl != null && lastBTC) {
            const sign = pnl > 0 ? '+' : (pnl < 0 ? '-' : '±');
            const absPnl = Math.abs(pnl).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            let colorClass = pnl > 0 ? 'pnl-pos' : (pnl < 0 ? 'pnl-neg':'pnl-zero');
            pnlDisp = `<span class="pnl ${colorClass}">${sign}${absPnl}</span>`;
            pctDisp = pctStr(pnl, lastBTC);
          }
          return `
            <tr>
              <td style="color:#45caf7;font-family:inherit;">${e.x}</td>
              <td>${String(e.guess)}</td>
              <td>${pnlDisp}</td>
              <td>${pctDisp}</td>
              <td>${agoStr(e.ts)}</td>
            </tr>`;
      }).join("");
      else
        html += "<tr><td colspan=5 style='text-align:center'>No guesses yet</td></tr>";
      table.innerHTML = html;
    }
    // --- RECORD CLOSE/END PRICES (auto) ---
    async function checkAndSetPrices() {
      const now = Date.now();
      if (!session.closePrice && session.close && now>session.close && now<(session.end-1000)) {
        const cp = await fetchBTC();
        session.closePrice = +cp.replace(/,/g,"");
        await db.ref(SESSION_PATH + "/closePrice").set(session.closePrice);
      }
      if (!session.endPrice && session.end && now>session.end) {
        const ep = await fetchBTC();
        session.endPrice = +ep.replace(/,/g,"");
        await db.ref(SESSION_PATH + "/endPrice").set(session.endPrice);
      }
    }
    // --- WINNERS TABLE with % close ---
    function renderWinnersTimer() {
      if(!session.end) return;
      const now = Date.now();
      const tleft = session.end-now;
      if (tleft>0){
        document.getElementById('resultsTimer').textContent = prettyTime(tleft);
      } else {
        document.getElementById('resultsTimer').textContent = '00s';
      }
    }
    async function renderWinners() {
      if (!session.endPrice) return;
      document.getElementById('resultsBTC').textContent = session.endPrice?session.endPrice: '...';
      if(showWinnerTimer) clearInterval(showWinnerTimer);
      showWinnerTimer = setInterval(renderWinnersTimer, 1000);
      renderWinnersTimer();
      const snap = await db.ref(ENTRIES_PATH + '/' + session.start).once('value');
      const entriesObj = snap.val() || {};
      let arr = Object.values(entriesObj);
      if (!arr.length) return;
      arr.forEach(e => {
        e.dist = Math.abs(e.guess - session.endPrice);
        e.pct = (100-Math.min(100,Math.abs(e.guess-session.endPrice)/session.endPrice*100));
      });
      arr.sort((a, b) => a.dist - b.dist);
      const table = document.getElementById('winnersTable');
      let html = `<tr>
        <th>Rank</th>
        <th>X Username</th>
        <th>Guess ($)</th>
        <th>Δ</th>
        <th>% End</th>
      </tr>`;
      arr.forEach((e, i) => {
        let colorClass = e.pct > 99.8 ? 'percent-good' : (e.pct > 99 ? 'percent-med' : 'percent-bad');
        html += `<tr class="${i==0?'winner':''}">
          <td>${i+1}</td>
          <td style="font-family:inherit;">${e.x}</td>
          <td>${String(e.guess)}</td>
          <td>${Math.abs(e.guess - session.endPrice)}</td>
          <td><span class="percent-close ${colorClass}">${e.pct.toFixed(2)}%</span></td>
        </tr>`;
      });
      table.innerHTML = html;
      document.getElementById('winnersSection').style.display = '';
      document.getElementById('tableSection').style.display = 'none';
    }
    // --- MAIN ---
    async function main() {
      await getOrCreateSession();
      initChart();
      let preload = [];
      for(let i=MAX_POINTS-1; i>=0; --i) preload.push({time: Date.now()-i*5000, price: lastBTC??43500});
      btcHistory = preload;
      for(let i=0;i<preload.length;i++) btcChart.data.labels.push('');
      btcChart.data.datasets[0].data = btcHistory.map(d=>d.price);
      renderChartFinal();
      await updateBTC();
      updateEntryAndResultTimers();
      updateFormState();
      renderEntries();
      intervalTimers = [
        setInterval(updateEntryAndResultTimers, 1000),
        setInterval(updateFormState, 1500),
        setInterval(async ()=> {
          await checkAndSetPrices();
          if (session.end && Date.now() > session.end) {
            await db.ref(SESSION_PATH).once('value').then(snap=>session={...session, ...snap.val()});
            if (session.endPrice) renderWinners();
          }
        }, 12*1000)
      ];
      if (session.end && Date.now()>session.end) {
        await db.ref(SESSION_PATH).once('value').then(snap=>session={...session, ...snap.val()});
        if (session.endPrice) renderWinners();
      }
    }
    main();
    setInterval(updateBTC, 5000);

    // Prevent zoom on input focus on mobile
    document.querySelectorAll('input').forEach(function(input){
      input.addEventListener('touchstart', function(){
        document.body.style.fontSize = '10px';
        document.documentElement.style.fontSize='10px';
      });
    });
  </script>
</body>
</html>
