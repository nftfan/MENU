<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="https://raw.githubusercontent.com/nftfan/MENU/refs/heads/main/play/Copy%20of%20Copy%20of%20Copy%20of%20Untitled%20Design.png" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Personal Delivery</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Personal Delivery">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/nftfan/MENU/refs/heads/main/play/Copy%20of%20Copy%20of%20Copy%20of%20Untitled%20Design.png">
    
    <style>
        /* All your styles as before... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .app-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .video-container {
            position: relative;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        #videoPlayer {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
        }

        .controls-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            color: white;
            font-family: 'Roboto', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .control-btn.secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .control-btn.accent {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
        }

        .bookmarks-section {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bookmarks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .bookmark-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .bookmark-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .bookmark-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bookmark-name {
            font-weight: 500;
            font-size: 1rem;
        }

        .bookmark-url {
            font-size: 0.8rem;
            opacity: 0.7;
            word-break: break-all;
        }

        .bookmark-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .status-bar.show {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }

        .empty-state .material-icons {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .app-title {
                font-size: 2rem;
            }
            
            #videoPlayer {
                height: 250px;
            }
            
            .controls-section {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }

        /* Custom scrollbar */
        .bookmarks-list::-webkit-scrollbar {
            width: 6px;
        }

        .bookmarks-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .bookmarks-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .bookmarks-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="app-title">IPTV Player</h1>
            <p class="app-subtitle">Stream thousands of channels worldwide</p>
        </div>

        <div class="video-container">
            <video id="videoPlayer" class="video-js vjs-default-skin" controls>
                Your browser does not support the video tag.
            </video>
        </div>

        <div class="controls-section">
            <button class="control-btn primary" onclick="loadRandomChannel()">
                <span class="material-icons">shuffle</span>
                Random Channel
            </button>
            <button class="control-btn secondary" onclick="bookmarkCurrentChannel()" id="bookmarkBtn" disabled>
                <span class="material-icons">bookmark_add</span>
                Bookmark
            </button>
            <button class="control-btn accent" onclick="playAllBookmarks()" id="playAllBtn">
                <span class="material-icons">playlist_play</span>
                Play Bookmarks
            </button>
        </div>

        <div class="bookmarks-section">
            <h2 class="section-title">
                <span class="material-icons">bookmarks</span>
                Favorite Channels
            </h2>
            <div class="bookmarks-list" id="bookmarksList">
                <div class="empty-state">
                    <div class="material-icons">tv_off</div>
                    <p>No bookmarks yet. Start watching and bookmark your favorite channels!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar" id="statusBar"></div>

    <!-- Video.js library -->
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

    <script>
        let currentChannelUrl = '';
        let currentChannelName = '';
        let channels = [];
        let bookmarks = [];
        let bookmarkPlayIndex = 0;
        let player = null;

        // Use localStorage for bookmarks persistence
        const BOOKMARKS_STORAGE_KEY = 'iptv_bookmarks';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayer();
            loadBookmarks();
            updateBookmarksList();
        });

        // Initialize Video.js player
        function initializePlayer() {
            player = videojs('videoPlayer', {
                fluid: true,
                responsive: true,
                playbackRates: [0.5, 1, 1.25, 1.5, 2]
            });
        }

        // Show status message
        function showStatus(message, duration = 3000) {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            statusBar.classList.add('show');
            setTimeout(() => {
                statusBar.classList.remove('show');
            }, duration);
        }

        // Fetch and parse M3U file
        async function fetchChannels() {
            try {
                showStatus('Loading channels...');
                const response = await fetch('https://iptv-org.github.io/iptv/index.m3u');
                const data = await response.text();
                
                const lines = data.split('\n');
                channels = [];
                let currentName = '';
                
                lines.forEach(line => {
                    if (line.startsWith('#EXTINF:')) {
                        // Extract channel name from EXTINF line
                        const nameMatch = line.match(/,(.+)$/);
                        currentName = nameMatch ? nameMatch[1].trim() : 'Unknown Channel';
                    } else if (line.startsWith('http')) {
                        channels.push({
                            name: currentName,
                            url: line.trim()
                        });
                        currentName = '';
                    }
                });
                
                showStatus(`Loaded ${channels.length} channels`);
                return channels;
            } catch (error) {
                showStatus('Error loading channels');
                console.error('Error fetching channels:', error);
                return [];
            }
        }

        // Load random channel
        async function loadRandomChannel() {
            if (channels.length === 0) {
                channels = await fetchChannels();
            }
            
            if (channels.length === 0) {
                showStatus('No channels available');
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * channels.length);
            const randomChannel = channels[randomIndex];
            
            loadChannel(randomChannel.url, randomChannel.name);
        }

        // Load specific channel
        function loadChannel(url, name) {
            currentChannelUrl = url;
            currentChannelName = name;
            
            player.src({
                type: 'application/x-mpegURL',
                src: url
            });
            
            player.play().catch(error => {
                console.log('Play failed:', error);
                showStatus('Failed to play channel');
            });
            
            document.getElementById('bookmarkBtn').disabled = false;
            showStatus(`Now playing: ${name}`);
        }

        // Bookmark current channel
        function bookmarkCurrentChannel() {
            if (!currentChannelUrl) {
                showStatus('No channel is currently playing');
                return;
            }
            
            // Check if already bookmarked
            const existingBookmark = bookmarks.find(b => b.url === currentChannelUrl);
            if (existingBookmark) {
                showStatus('Channel already bookmarked');
                return;
            }
            
            const bookmark = {
                id: Date.now(),
                name: currentChannelName,
                url: currentChannelUrl,
                timestamp: new Date().toISOString()
            };
            
            bookmarks.push(bookmark);
            saveBookmarks();
            updateBookmarksList();
            showStatus('Channel bookmarked!');
        }

        // Load bookmarks from localStorage
        function loadBookmarks() {
            try {
                const stored = localStorage.getItem(BOOKMARKS_STORAGE_KEY);
                bookmarks = stored ? JSON.parse(stored) : [];
            } catch(e) {
                bookmarks = [];
            }
        }

        // Save bookmarks to localStorage
        function saveBookmarks() {
            try {
                localStorage.setItem(BOOKMARKS_STORAGE_KEY, JSON.stringify(bookmarks));
            } catch(e) {
                showStatus('Could not save bookmarks. Storage may be full or unavailable.');
            }
        }

        // Update bookmarks list display
        function updateBookmarksList() {
            const bookmarksList = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="empty-state">
                        <div class="material-icons">tv_off</div>
                        <p>No bookmarks yet. Start watching and bookmark your favorite channels!</p>
                    </div>
                `;
                return;
            }
            
            bookmarksList.innerHTML = bookmarks.map(bookmark => `
                <div class="bookmark-item">
                    <div class="bookmark-info">
                        <span class="material-icons">tv</span>
                        <div>
                            <div class="bookmark-name">${bookmark.name}</div>
                            <div class="bookmark-url">${bookmark.url.substring(0, 50)}...</div>
                        </div>
                    </div>
                    <div class="bookmark-actions">
                        <button class="icon-btn" onclick="loadChannel('${bookmark.url.replace(/'/g, "\\'")}', '${bookmark.name.replace(/'/g, "\\'")}')" title="Play">
                            <span class="material-icons">play_arrow</span>
                        </button>
                        <button class="icon-btn" onclick="deleteBookmark(${bookmark.id})" title="Delete">
                            <span class="material-icons">delete</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Delete bookmark
        function deleteBookmark(id) {
            bookmarks = bookmarks.filter(b => b.id !== id);
            saveBookmarks();
            updateBookmarksList();
            showStatus('Bookmark deleted');
        }

        // Play all bookmarks in sequence
        function playAllBookmarks() {
            if (bookmarks.length === 0) {
                showStatus('No bookmarks to play');
                return;
            }
            
            bookmarkPlayIndex = 0;
            playNextBookmark();
        }

        // Play next bookmark in sequence
        function playNextBookmark() {
            if (bookmarkPlayIndex >= bookmarks.length) {
                bookmarkPlayIndex = 0; // Loop back to start
                showStatus('Playlist finished, restarting...');
            }
            
            const bookmark = bookmarks[bookmarkPlayIndex];
            loadChannel(bookmark.url, bookmark.name);
            bookmarkPlayIndex++;
            
            // Auto-play next bookmark after 30 seconds (you can adjust this)
            setTimeout(() => {
                if (bookmarks.length > 1) {
                    playNextBookmark();
                }
            }, 30000);
        }
    </script>
</body>
</html>
