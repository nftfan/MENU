<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TokenTransfer Links</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      padding: 24px;
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
    }

    p.subtitle {
      text-align: center;
      margin-top: 0;
      color: #9ca3af;
      font-size: 0.95rem;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 24px;
      box-shadow:
        0 10px 25px rgba(15, 23, 42, 0.7),
        0 0 0 1px rgba(148, 163, 184, 0.07);
      margin-bottom: 24px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 700px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
    }

    input, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      padding: 10px 12px;
      font-size: 0.95rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input:focus, textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background: #020617;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    button {
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-weight: 600;
      padding: 10px 20px;
      font-size: 0.95rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    button:hover {
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(22, 163, 74, 0.35);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .status.error {
      color: #f97373;
    }

    .status.success {
      color: #4ade80;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 12px;
    }

    .post-card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.15), transparent 55%),
                  #020617;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.18);
      display: flex;
      flex-direction: column;
      min-height: 100%;
      position: relative;
    }

    .post-image-wrapper {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      overflow: hidden;
    }

    .post-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .post-card:hover .post-image {
      transform: scale(1.05);
    }

    .post-content {
      padding: 16px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .post-title {
      font-size: 1.0rem;
      font-weight: 600;
      margin: 0;
      color: #f9fafb;
    }

    .post-title a {
      color: inherit;
      text-decoration: none;
    }

    .post-title a:hover {
      text-decoration: underline;
    }

    .post-description {
      font-size: 0.9rem;
      color: #cbd5f5;
      margin: 0;
    }

    .empty-state {
      text-align: center;
      padding: 32px 16px;
      color: #6b7280;
      font-size: 0.9rem;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.6);
      margin-top: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>TokenTransfer Links</h1>
    <p class="subtitle">Post a title, URL, description and image. Only complete entries are shown below.</p>

    <!-- Form Card -->
    <div class="card">
      <form id="postForm">
        <div class="form-grid">
          <div>
            <label for="title">Title</label>
            <input id="title" type="text" required placeholder="e.g. My awesome project" />
          </div>
          <div>
            <label for="url">URL</label>
            <input id="url" type="url" required placeholder="https://example.com" />
          </div>
          <div>
            <label for="imageUrl">Image URL</label>
            <input id="imageUrl" type="url" required placeholder="https://example.com/image.png" />
          </div>
          <div>
            <label for="description">Description</label>
            <textarea id="description" required placeholder="Short description of the link..."></textarea>
          </div>
        </div>

        <button type="submit">
          <span>Publish</span>
          <span>âžœ</span>
        </button>
        <div id="status" class="status"></div>
      </form>
    </div>

    <!-- Cards List -->
    <div class="card">
      <h2 style="margin-top: 0; font-size: 1.1rem;">Latest posts</h2>
      <div id="postsContainer" class="cards-grid"></div>
      <div id="emptyState" class="empty-state" style="display:none;">
        No valid posts yet. Add one above.
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    // Import Firebase v9 (modular)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      onValue,
      query,
      orderByChild
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- Firebase config (yours) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBuBB-Cha7eLG1O7SxOTfFt8e6hVAWjkxI",
      authDomain: "tokentransfer-4a9b3.firebaseapp.com",
      databaseURL: "https://tokentransfer-4a9b3-default-rtdb.firebaseio.com",
      projectId: "tokentransfer-4a9b3",
      storageBucket: "tokentransfer-4a9b3.firebasestorage.app",
      messagingSenderId: "205455490321",
      appId: "1:205455490321:web:9919f5dde059316c9320b0",
      measurementId: "G-Y6CVEDL9XH"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // References
    const postsRef = ref(db, "posts");

    const postForm = document.getElementById("postForm");
    const statusEl = document.getElementById("status");
    const postsContainer = document.getElementById("postsContainer");
    const emptyState = document.getElementById("emptyState");

    // Handle form submit (write: only title, url, description, imageUrl)
    postForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status";

      const title = document.getElementById("title").value.trim();
      const url = document.getElementById("url").value.trim();
      const description = document.getElementById("description").value.trim();
      const imageUrl = document.getElementById("imageUrl").value.trim();

      if (!title || !url || !description || !imageUrl) {
        statusEl.textContent = "Please fill in all fields.";
        statusEl.classList.add("error");
        return;
      }

      try {
        // Only store these 4 fields
        await push(postsRef, {
          title,
          url,
          description,
          imageUrl
        });

        statusEl.textContent = "Post published!";
        statusEl.classList.add("success");
        postForm.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Failed to publish. Check console for details.";
        statusEl.classList.add("error");
      }
    });

    // Render posts (read: only entries that HAVE all 4 fields)
    function renderPosts(snapshot) {
      postsContainer.innerHTML = "";

      const data = snapshot.val();
      if (!data) {
        emptyState.style.display = "block";
        return;
      }

      // Convert into array
      const postsArr = Object.entries(data)
        .map(([id, value]) => ({ id, ...value }))
        // Filter: only show posts that have ALL required fields
        .filter(post =>
          typeof post.title === "string" && post.title.trim() !== "" &&
          typeof post.url === "string" && post.url.trim() !== "" &&
          typeof post.description === "string" && post.description.trim() !== "" &&
          typeof post.imageUrl === "string" && post.imageUrl.trim() !== ""
        );

      if (postsArr.length === 0) {
        emptyState.style.display = "block";
        return;
      } else {
        emptyState.style.display = "none";
      }

      for (const post of postsArr) {
        const card = document.createElement("article");
        card.className = "post-card";

        // Image
        const imageWrapper = document.createElement("div");
        imageWrapper.className = "post-image-wrapper";

        const img = document.createElement("img");
        img.className = "post-image";
        img.src = post.imageUrl;
        img.alt = post.title || "Post image";
        img.onerror = () => {
          img.src = "https://via.placeholder.com/600x338/020617/64748b?text=Image+Error";
        };

        imageWrapper.appendChild(img);

        // Content
        const content = document.createElement("div");
        content.className = "post-content";

        // Title (with link)
        const titleEl = document.createElement("h3");
        titleEl.className = "post-title";
        const link = document.createElement("a");
        link.href = post.url;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = post.title || "Untitled";
        titleEl.appendChild(link);

        // Description
        const descEl = document.createElement("p");
        descEl.className = "post-description";
        descEl.textContent = post.description || "";

        // Only append title + description (no date, no extra metadata)
        content.appendChild(titleEl);
        content.appendChild(descEl);

        card.appendChild(imageWrapper);
        card.appendChild(content);

        postsContainer.appendChild(card);
      }
    }

    // Listen for changes in Realtime Database
    const postsQuery = query(postsRef, orderByChild("title"));
    onValue(postsQuery, renderPosts);
  </script>
</body>
</html>
